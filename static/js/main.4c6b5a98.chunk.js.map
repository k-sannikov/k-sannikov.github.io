{"version":3,"sources":["cardMaker/header/toolbar/toolbarText/selectFontFamily/SelectFontFamily.module.css","cardMaker/modal/Modal.module.css","cardMaker/header/toolbar/toolbarBackground/ToolbarBackground.module.css","cardMaker/canvas/img/Img.module.css","cardMaker/canvas/artObj/ArtObj.module.css","cardMaker/header/toolbar/toolbarCanvas/ToolbarCanvas.module.css","cardMaker/header/toolbar/toolbarText/ToolbarText.module.css","cardMaker/header/toolbar/toolbarObject/ToolbarObject.module.css","cardMaker/header/navbar/navButton/NavFileButton/NavFileButton.module.css","cardMaker/dropdownMenu/DropdownMenu.module.css","cardMaker/header/toolbar/toolbarImg/addImgButtonFile/AddImgButtonFile.module.css","cardMaker/header/toolbar/toolbarFilter/ToolbarFilter.module.css","cardMaker/header/toolbar/toolbarBackground/FileImgButton/FileImgButton.module.css","cardMaker/header/toolbar/toolbarImg/ToolbarImg.module.css","cardMaker/header/Header.module.css","cardMaker/header/navbar/navButton/NavButton/NavButton.module.css","cardMaker/header/toolbar/toolbarText/buttonEditText/ButtonEditText.module.css","cardMaker/header/toolbar/toolbarImg/addImgButton/AddImgButton.module.css","cardMaker/header/toolbar/button/Button.module.css","cardMaker/header/toolbar/toolbarArea/ToolbarArea.module.css","cardMaker/canvas/text/Text.module.css","cardMaker/CardMaker.module.css","cardMaker/header/navbar/Navbar.module.css","cardMaker/header/toolbar/Toolbar.module.css","cardMaker/header/toolbar/toolbarText/colorPicker/ColorPicker.module.css","cardMaker/header/toolbar/toolbarText/inputNumber/InputNumber.module.css","cardMaker/header/toolbar/toolbarImg/previewArtObj/PreviewArtObj.module.css","cardMaker/header/toolbar/colorPicker/ColorPicker.module.css","cardMaker/canvas/Canvas.module.css","cardMaker/canvas/filter/Filter.module.css","cardMaker/canvas/deleteArea/DeleteArea.module.css","cardMaker/canvas/areaSelection/AreaSelection.module.css","cardMaker/header/navbar/navButton/NavButton/NavButton.tsx","cardMaker/header/navbar/navButton/NavFileButton/NavFileButton.tsx","utils/files.ts","utils/elementList.ts","utils/permisions.ts","store/reducers/BackgroundReducer.ts","store/reducers/FilterReducer.ts","store/reducers/HeightCanvasReducer.ts","store/types.ts","utils/guid.ts","store/reducers/ListBlockReducer.ts","store/reducers/WidthCanvasReducer.ts","store/reducers/CanvasReducer.ts","store/reducers/SelectBlockReducer.ts","store/reducers/HistoryReducer.ts","store/reducers/ViewModelReducer.ts","store/initialState.ts","store/store.ts","store/reducers/CardMakerReducer.ts","store/actionCreators/historyActionCreators.ts","cardMaker/modal/Modal.tsx","cardMaker/header/navbar/navButton/NewProjectButton/NewProjectButton.tsx","store/actionCreators/cardMakerActionCreators.ts","utils/exportImg.ts","cardMaker/header/navbar/navButton/ExportImgButton/ExportImgButton.tsx","cardMaker/header/navbar/Navbar.tsx","cardMaker/header/navbar/useStateHistory.ts","cardMaker/header/navbar/useExportFileProject.ts","cardMaker/header/navbar/useImportFileProject.ts","store/actionCreators/textBlockActionCreators.ts","cardMaker/header/toolbar/toolbarText/buttonEditText/ButtonEditText.tsx","cardMaker/header/toolbar/toolbarText/buttonEditText/useEditStateText.ts","cardMaker/header/toolbar/toolbarText/colorPicker/ColorPicker.tsx","cardMaker/header/toolbar/toolbarText/colorPicker/useEditColorText.ts","cardMaker/header/toolbar/toolbarText/inputNumber/InputNumber.tsx","cardMaker/header/toolbar/toolbarText/inputNumber/useEditFontSize.ts","cardMaker/header/toolbar/toolbarText/selectFontFamily/SelectFontFamily.tsx","cardMaker/header/toolbar/toolbarText/selectFontFamily/useSelectFont.ts","cardMaker/header/toolbar/toolbarText/ToolbarText.tsx","cardMaker/dropdownMenu/DropdownMenu.tsx","cardMaker/header/toolbar/toolbarImg/addImgButton/AddImgButton.tsx","cardMaker/header/toolbar/toolbarImg/addImgButtonFile/AddImgButtonFile.tsx","cardMaker/header/toolbar/toolbarImg/previewArtObj/PreviewArtObj.tsx","store/actionCreators/artObjBlockActionCreators.ts","cardMaker/header/toolbar/toolbarImg/previewArtObj/useCreateArtObj.ts","cardMaker/header/toolbar/toolbarImg/ToolbarImg.tsx","store/actionCreators/imgBlockActionCreators.ts","cardMaker/header/toolbar/toolbarImg/useCreateImg.ts","cardMaker/header/toolbar/colorPicker/ColorPicker.tsx","store/actionCreators/canvasActionCreators.ts","cardMaker/header/toolbar/toolbarFilter/ToolbarFilter.tsx","cardMaker/header/toolbar/toolbarFilter/useStateFilter.ts","cardMaker/header/toolbar/toolbarBackground/FileImgButton/FileImgButton.tsx","cardMaker/header/toolbar/toolbarBackground/useBackgroungImg.ts","cardMaker/header/toolbar/button/Button.tsx","cardMaker/header/toolbar/toolbarBackground/ToolbarBackground.tsx","cardMaker/header/toolbar/toolbarBackground/useBackgroungColor.ts","cardMaker/header/toolbar/toolbarArea/ToolbarArea.tsx","cardMaker/header/toolbar/toolbarArea/useDeleteArea.ts","store/actionCreators/blockActionCreators.ts","cardMaker/header/toolbar/toolbarObject/ToolbarObject.tsx","cardMaker/header/toolbar/toolbarObject/useBlockLevel.ts","cardMaker/header/toolbar/toolbarObject/useBlockDelete.ts","cardMaker/header/toolbar/toolbarCanvas/ToolbarCanvas.tsx","cardMaker/header/toolbar/toolbarCanvas/useStateCanvasSize.ts","cardMaker/header/toolbar/Toolbar.tsx","cardMaker/header/Header.tsx","cardMaker/canvas/useStateBlock.ts","cardMaker/canvas/useDragAndDrop.ts","cardMaker/canvas/useResize.ts","cardMaker/canvas/img/Img.tsx","cardMaker/canvas/text/Text.tsx","cardMaker/canvas/text/useEditText.ts","cardMaker/canvas/artObj/ArtObj.tsx","cardMaker/canvas/filter/Filter.tsx","cardMaker/canvas/deleteArea/DeleteArea.tsx","cardMaker/canvas/areaSelection/AreaSelection.tsx","cardMaker/canvas/Canvas.tsx","cardMaker/canvas/useAreaSelection.ts","cardMaker/CardMaker.tsx","index.tsx"],"names":["module","exports","NavButton","forwardRef","props","ref","onClick","className","styles","button","icon","label","button__text","connect","NavFileButton","htmlFor","inputFile","type","id","getImgInformationFromFile","fileImg","a","fileImgPromise","Promise","resolve","reject","reader","FileReader","readAsDataURL","onload","result","onerror","img","Image","src","decode","width","height","getProjectFromFile","file","filePromise","readAsText","json","JSON","parse","setComponentFields","listBlock","modifiableFields","newlistBlock","forEach","component","push","getIndexById","foundIndex","block","index","verify","value","Error","background","action","color","filter","opacity","heightCanvas","BlockTypes","SetOfArtObject","createGUID","gen","join","count","out","i","Math","random","toString","substring","text","x","y","size","bold","italic","underline","fontFamily","isBold","isItalic","isUnderline","artObj","copyListBlock","Boolean","isSelectedBlock","splice","newListBlock","length","isShiftUpAvailable","flipValue","isShiftDownAvailable","widthCanvas","canvas","deleteArea","area","selectBlock","history","listState","currentIndex","newListState","newCanvas","newCurrentIndex","isUndoAvailable","isRedoAvailable","areaSelection","cardMaker","viewModel","bgColor","bgImg","canvasSize","list","defState","tempColor","tempSize","testArtObj","testCanvas","testCardMaker","exceptions","valid","store","createStore","project","initialState","applyMiddleware","next","oldState","getState","newState","includes","stringify","console","log","dispatch","visible","title","content","footer","onClose","useEffect","onKeydown","key","document","addEventListener","removeEventListener","modal","modalDialog","e","stopPropagation","modalHeader","modalTitle","modalClose","faTimes","modalBody","modalContent","modalFooter","newCardMaker","useState","isModal","setModal","faPiedPiperSquare","exportImg","elements","deleteAreas","createElement","ctx","getContext","crossOrigin","imgWidth","imgHeight","drawImage","fillStyle","fillRect","renderBlock","convertColor","r","g","b","element","dataURL","toDataURL","link","href","download","click","defShiftX","lineHeight","style","getStyle","textBlock","innerHTML","shift","Array","from","children","str","font","weight","family","fillText","innerText","textWidth","measureText","chars","rgbColor","parseInt","downloadImg","useRef","faImage","undo","redo","applyFileProject","buttonUndo","buttonRedo","btnUndo","current","btnRedo","handlerClickUndo","handlerClickRedo","handlerKeydown","event","code","ctrlKey","metaKey","useStateHistory","downloadButton","downloadFile","input","handlerChangeInputFile","target","files","useImportFileProject","handlerClickSaveToJson","Blob","URL","createObjectURL","navbar","faFolderOpen","faFileExport","faClone","faUndo","faRedo","setBoldText","setItalicText","setUnderlineText","enabled","modifyFn","param","btn","handleClickButton","preventDefault","useEditStateText","active","state","setColorText","inputColorText","colorPicker","inputColor","handleInput","handleChange","handleClick","stopImmediatePropagation","useEditColorText","setSizeText","inputSizeText","inputNumber","fieldSize","Number","handleBlur","String","input__number","min","max","step","setFontFamilyText","select","selectFontFamily","useSelectFont","fontFamilies","class","fantazyor","piroucyrillic","phenomena","sunday","kurale","sensei","borsok","summer","underdog","montserrat","openSans","comfortaa","rubik","marta","map","currentStyle","selected","name","createTextBlock","toolbar","toolbar__row","faFont","faBold","faItalic","faUnderline","colorPickerBox","toolbar__label","dropdown","dropbtn","sizeIcon","dropdown_text","dropdown_content","minWidth","AddImgButton","createArtObjBlock","artObjPreview","handleClickArtObj","alt","sticker","createImgBlock","srcList","Object","values","imgList","fieldFile","handlerChangeInput","imgInfo","useCreateImg","button_box","AddImgButtonFile","faDownload","faGlobe","faStickyNote","ColorPicker","input__color","setCanvasSize","inputFilter","setFilter","inputRange","fieldColor","fieldRange","handleInputFilter","handleChangeFilter","useStateFilter","input_range","inputBackgroundImg","setBackgroundImg","handlerChange","useBackgroungImg","bg","Button","textAlign","button_text","resetBackground","inputBackgroundColor","setBackgroundColor","buttonReset","handlerClickResetColor","handlerInputColor","handleerChangeColor","useBackgroungColor","toolbar__col1","button_container","FileImgButton","toolbar__col2","faRetweet","deleteAreaSelection","resetAreaSelection","buttonDelete","handleMousedownButton","useDeleteArea","faEraser","setSelectedBlock","setSizeBlock","deleteBlock","setPositionBlock","shiftUpBlock","shiftDownBlock","buttonUp","buttonDown","btnUp","btnDown","handlerClickShiftUp","handlerClickShiftDown","useBlockLevel","handlerClickDelete","useBlockDelete","faArrowUp","faArrowDown","toolbar__col","faTrash","inputCanvasSize","inputWidth","inputHeight","fieldWidth","fieldHeight","handleChangeSize","handleBlurSize","useStateCanvasSize","input_number","header","panel","useStateBlock","blockId","resetSelectedBlock","currentBlock","handleMousedownBlock","setTimeout","handleClickDocument","isDefPrev","defaultPrevented","isSelectedID","useDragAndDrop","defPos","startPos","newPos","handleMousedown","pageX","pageY","handleMouseMove","handleMouseUp","delta","left","top","useResize","LT","RT","LB","RB","defSize","point","pointLT","pointRT","pointLB","pointRB","offsetX","offsetY","newWidth","newHeight","prevWidth","prevHeight","moving","calculateSize","imgStyle","imgBlock","onDragStart","pointTopLeft","pointTopRight","pointBottomLeft","pointBottomRight","setTextInTextBlock","clickOnText","setTextIncurrentBlock","handleClickBlock","handleDblclickBlock","setAttribute","focus","getAttribute","handlerPaste","clipboardData","getData","execCommand","handlerInput","textStyle","fontSize","fontWeight","textDecoration","fontStyle","contentEditable","suppressContentEditableWarning","dangerouslySetInnerHTML","__html","artObjBlock","artObjStyle","filterStyle","DeleteAreaStyle","AreaSelection","areaSelectionStyle","setPositionAreaSelection","canvasStyle","getListBlock","startOffsetPos","field","selectArea","div","border","appendChild","abs","offsetWidth","offsetHeight","offsetLeft","offsetTop","remove","handleMousedownDocument","handleMousedownArea","position","zIndex","pointerEvents","useAreaSelection","main","subscribe","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.4c6b5a98.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"select\":\"SelectFontFamily_select__1Hv9D\",\"fantazyor\":\"SelectFontFamily_fantazyor__1YuH3\",\"piroucyrillic\":\"SelectFontFamily_piroucyrillic__2APyX\",\"phenomena\":\"SelectFontFamily_phenomena__3L0pA\",\"sunday\":\"SelectFontFamily_sunday__3-2n9\",\"kurale\":\"SelectFontFamily_kurale__-1mws\",\"sensei\":\"SelectFontFamily_sensei__1zzQ5\",\"borsok\":\"SelectFontFamily_borsok__2Wuhd\",\"summer\":\"SelectFontFamily_summer__1jEjL\",\"underdog\":\"SelectFontFamily_underdog__2MpfH\",\"montserrat\":\"SelectFontFamily_montserrat__3seoV\",\"openSans\":\"SelectFontFamily_openSans__tiuJF\",\"comfortaa\":\"SelectFontFamily_comfortaa__3IxgG\",\"rubik\":\"SelectFontFamily_rubik__3nd8M\",\"marta\":\"SelectFontFamily_marta__1T-z5\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"modal\":\"Modal_modal__3Ldwj\",\"appear\":\"Modal_appear__1oVsi\",\"modalDialog\":\"Modal_modalDialog__3Du5z\",\"animatetop\":\"Modal_animatetop__2MHhu\",\"slide-in\":\"Modal_slide-in__1_LpD\",\"modalHeader\":\"Modal_modalHeader__1ppBy\",\"modalFooter\":\"Modal_modalFooter__lSAfT\",\"modalClose\":\"Modal_modalClose__3GnIC\",\"modalBody\":\"Modal_modalBody__12nPW\",\"modalContent\":\"Modal_modalContent__35CCy\",\"modalTitle\":\"Modal_modalTitle__bNkET\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"toolbar\":\"ToolbarBackground_toolbar__MQ_48\",\"toolbar__label\":\"ToolbarBackground_toolbar__label__1I8R8\",\"toolbar__col1\":\"ToolbarBackground_toolbar__col1__3BwVD\",\"toolbar__col2\":\"ToolbarBackground_toolbar__col2__12hzd\",\"toolbar__row\":\"ToolbarBackground_toolbar__row__3lf-3\",\"button_container\":\"ToolbarBackground_button_container__1ir_S\",\"colorPickerBox\":\"ToolbarBackground_colorPickerBox__2npIL\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"block\":\"Img_block__r3fmB\",\"img\":\"Img_img__3Hans\",\"selected\":\"Img_selected__vEyvs\",\"pointBottomRight\":\"Img_pointBottomRight__1Z-pj\",\"pointTopLeft\":\"Img_pointTopLeft__3ZXB8\",\"pointTopRight\":\"Img_pointTopRight__2cXMJ\",\"pointBottomLeft\":\"Img_pointBottomLeft__x6rWq\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"block\":\"ArtObj_block__1DyCD\",\"img\":\"ArtObj_img__3ltZN\",\"selected\":\"ArtObj_selected__1oJ2Z\",\"pointBottomRight\":\"ArtObj_pointBottomRight__3og1x\",\"pointTopLeft\":\"ArtObj_pointTopLeft__2iQK4\",\"pointTopRight\":\"ArtObj_pointTopRight__19xjD\",\"pointBottomLeft\":\"ArtObj_pointBottomLeft__1BMY1\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"toolbar\":\"ToolbarCanvas_toolbar__2lemH\",\"toolbar__button\":\"ToolbarCanvas_toolbar__button__2LRIf\",\"toolbar__label\":\"ToolbarCanvas_toolbar__label__1lbBA\",\"toolbar__button_text\":\"ToolbarCanvas_toolbar__button_text__Fo0b_\",\"input_number\":\"ToolbarCanvas_input_number__kQeBA\",\"toolbar__row\":\"ToolbarCanvas_toolbar__row__fR0UK\",\"input_range\":\"ToolbarCanvas_input_range__2BdY0\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"toolbar\":\"ToolbarText_toolbar__L36Xy\",\"toolbar__row\":\"ToolbarText_toolbar__row__1n6YO\",\"toolbar__label\":\"ToolbarText_toolbar__label__XASo7\",\"button\":\"ToolbarText_button__34F-S\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"toolbar\":\"ToolbarObject_toolbar__1wNU-\",\"toolbar__label\":\"ToolbarObject_toolbar__label__GzSLz\",\"toolbar__col\":\"ToolbarObject_toolbar__col__33gVZ\",\"toolbar__row\":\"ToolbarObject_toolbar__row__3n9uD\",\"input__color\":\"ToolbarObject_input__color__3PxWa\",\"button_container\":\"ToolbarObject_button_container__2CKtQ\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"button\":\"NavFileButton_button__31bRb\",\"button__text\":\"NavFileButton_button__text__2WzyS\",\"inputFile\":\"NavFileButton_inputFile__3SOw7\",\"icon\":\"NavFileButton_icon__1R6pk\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"dropbtn\":\"DropdownMenu_dropbtn__2-JiC\",\"dropdown\":\"DropdownMenu_dropdown__2_ubm\",\"dropdown_content\":\"DropdownMenu_dropdown_content__iSef_\",\"dropdown_text\":\"DropdownMenu_dropdown_text__2gbo8\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"button\":\"AddImgButtonFile_button__2N8CC\",\"button__text\":\"AddImgButtonFile_button__text__34fFe\",\"inputFile\":\"AddImgButtonFile_inputFile__4uOdL\",\"icon\":\"AddImgButtonFile_icon__3xQsK\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"toolbar\":\"ToolbarFilter_toolbar__CEBoi\",\"toolbar__label\":\"ToolbarFilter_toolbar__label__3pgyB\",\"input_color\":\"ToolbarFilter_input_color__1hKXO\",\"input_range\":\"ToolbarFilter_input_range__2mQc9\",\"colorPickerBox\":\"ToolbarFilter_colorPickerBox__3-g1H\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"button\":\"FileImgButton_button__2-G8o\",\"button__text\":\"FileImgButton_button__text__ilBCY\",\"inputFile\":\"FileImgButton_inputFile__nu7Na\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"toolbar\":\"ToolbarImg_toolbar__1U8h2\",\"button_box\":\"ToolbarImg_button_box__1ADxG\",\"toolbar__label\":\"ToolbarImg_toolbar__label__3zwm8\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"header\":\"Header_header__1rLmw\",\"panel\":\"Header_panel__29H5m\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"button\":\"NavButton_button__UL2Cr\",\"button__text\":\"NavButton_button__text__C4Sqv\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"button\":\"ButtonEditText_button__JsKq3\",\"active\":\"ButtonEditText_active__1z4H3\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"button\":\"AddImgButton_button__2zBC1\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"button\":\"Button_button__3s58t\",\"button_text\":\"Button_button_text__2xGDG\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"toolbar\":\"ToolbarArea_toolbar__17QU7\",\"toolbar__label\":\"ToolbarArea_toolbar__label__25frT\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"block\":\"Text_block__Fvt_5\",\"selected\":\"Text_selected__2uNOO\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"main\":\"CardMaker_main__qNuoq\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"navbar\":\"Navbar_navbar__2UjT7\",\"input\":\"Navbar_input__1lW6o\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"toolbar\":\"Toolbar_toolbar__hCIIv\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"input\":\"ColorPicker_input__Kiwid\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"input__number\":\"InputNumber_input__number__2kkQW\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"sticker\":\"PreviewArtObj_sticker__twuA7\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"input__color\":\"ColorPicker_input__color__3EGb4\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"canvas\":\"Canvas_canvas__Ak89z\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"filter\":\"Filter_filter__16erS\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"deleteArea\":\"DeleteArea_deleteArea__2KQym\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"areaSelection\":\"AreaSelection_areaSelection__1Syux\"};","import styles from './NavButton.module.css';\nimport { IconDefinition } from '@fortawesome/fontawesome-svg-core';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { ForwardedRef, forwardRef } from 'react';\nimport { connect } from 'react-redux';\n\ntype NavButtonProps = {\n  label: string,\n  icon: IconDefinition,\n  onClick: null | (() => void),\n}\n\nconst NavButton = forwardRef((props: NavButtonProps, ref: ForwardedRef<HTMLButtonElement>) => {\n  return (\n    <button\n      onClick={props.onClick ? props.onClick : ()=>{}}\n      className={styles.button}\n      ref={ref}>\n      <FontAwesomeIcon icon={props.icon} />\n      {props.label !== '' &&\n        <span className={styles.button__text}>{props.label}</span>\n      }\n    </button>\n  )\n});\n\nexport default connect(null, null, null, { forwardRef: true })(NavButton);","import styles from './NavFileButton.module.css';\nimport { IconDefinition } from '@fortawesome/fontawesome-svg-core';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { ForwardedRef, forwardRef } from 'react';\nimport { connect } from 'react-redux';\n\ntype NavFileButtonProps = {\n  label: string,\n  icon: IconDefinition,\n}\n\nconst NavFileButton = forwardRef((props: NavFileButtonProps, ref: ForwardedRef<HTMLInputElement>) => (\n  <button className={styles.button}>\n    <label htmlFor=\"input-file\" className={styles.icon}>\n      <FontAwesomeIcon icon={props.icon} />\n    </label>\n    <input\n      className={styles.inputFile}\n      type=\"file\"\n      ref={ref}\n      id=\"input-file\"\n    />\n    {props.label !== '' &&\n      <label className={styles.button__text}\n        htmlFor=\"input-file\">\n        {props.label}\n      </label>\n    }\n  </button>\n));\n\nexport default connect(null, null, null, { forwardRef: true })(NavFileButton);","import { CardMaker } from '../store/types';\n\n// конвертирование файла изображения в src стоку base64\ntype ImgInfo = {\n  width: number,\n  height: number,\n  src: string,\n}\n\nexport async function getImgInformationFromFile(fileImg: File): Promise<ImgInfo> {\n  const fileImgPromise = new Promise((resolve, reject) => {\n    let reader = new FileReader();\n    reader.readAsDataURL(fileImg);\n    reader.onload = () => resolve(reader.result);\n    reader.onerror = reject;\n  });\n  const img = new Image();\n  img.src = await fileImgPromise as string;\n  await img.decode();\n  return {\n    width: img.width,\n    height: img.height,\n    src: img.src,\n  }\n}\n\nexport async function getProjectFromFile(file: File): Promise<CardMaker> {\n  const filePromise = new Promise((resolve, reject) => {\n    let reader = new FileReader();\n    reader.readAsText(file);\n    reader.onload = () => resolve(reader.result);\n    reader.onerror = reject;\n  });\n  const json = await filePromise as string;\n  return await JSON.parse(json) as CardMaker;\n}","import { Block } from '../store/types';\n\n// проверка выделен ли блок\nexport function isSelectedBlock(id: string | null): boolean {\n  return Boolean(id)\n}\n\n// установка значений полю/полям одного элемента из списка элементов\nexport function setComponentFields(listBlock: Block[], id: string, modifiableFields: object): Block[] {\n  let newlistBlock: Block[] = [];\n  listBlock.forEach((component: Block) => {\n    if (component.id === id) {\n      newlistBlock.push({\n        ...component,\n        ...modifiableFields,\n      });\n    } else {\n      newlistBlock.push(component);\n    }\n  });\n  return newlistBlock;\n}\n\n// получить индекс элемента по id\nexport function getIndexById(listBlock: Block[], id: string): number {\n  let foundIndex: number = -1;\n  listBlock.forEach((block: Block, index: number) => {\n    if (block.id === id) {\n      foundIndex = index;\n    }\n  });\n  return foundIndex;\n}\n\n\n\n","import { ActionHistory, Block } from '../store/types';\nimport { getIndexById } from './elementList';\n\n// провера доступности операции undo\nexport function isUndoAvailable(history: ActionHistory): boolean {\n  let length = history.listState.length;\n  let index = history.currentIndex;\n  return length > 1 && index > 0;\n}\n\n// проверка доступности операции redo\nexport function isRedoAvailable(history: ActionHistory): boolean {\n  let length = history.listState.length;\n  let index = history.currentIndex;\n  return index + 1 < length;\n}\n\n// проверка доступности операции перемещения слоя вверх\nexport function isShiftUpAvailable(id: string | null, listBlock: Block[]): boolean {\n  const length: number = listBlock.length;\n  return Boolean(id && getIndexById(listBlock, id) < length - 1)\n}\n\n// проверка доступности операции перемещения слоя вниз\nexport function isShiftDownAvailable(id: string | null, listBlock: Block[]): boolean {\n  return Boolean(id && getIndexById(listBlock, id) > 0)\n}\n\n// проверка на !null значение\nexport function verify<T>(value: T | null | undefined): T {\n  if (!value) {\n    throw new Error('Assertion failed');\n  }\n  return value;\n}","import { Background } from '../types';\n\nexport type BackgroundAction = {\n  type: 'NEW_CARD_MAKER',\n} | {\n  type: 'RESET_BACKGROUND',\n} | {\n  type: 'SET_BACKGROUND_COLOR',\n  color: string,\n} | {\n  type: 'SET_BACKGROUND_IMG',\n  src: string,\n}\n\nfunction background(background: Background, action: BackgroundAction): Background {\n  switch (action.type) {\n\n    case 'NEW_CARD_MAKER':\n      return {\n        color: '#ffffff',\n        src: null,\n      };\n\n    case 'RESET_BACKGROUND':\n      return {\n        color: '#ffffff',\n        src: null,\n      };\n\n    case 'SET_BACKGROUND_COLOR':\n      return {\n        color: action.color,\n        src: null,\n      };\n\n    case 'SET_BACKGROUND_IMG':\n      return {\n        color: null,\n        src: action.src,\n      };\n\n    default:\n      return background;\n  }\n}\n\nexport default background;","import { Filter } from '../types';\n\nexport type FilterAction = {\n  type: 'NEW_CARD_MAKER',\n} | {\n  type: 'SET_FILTER',\n  color: string,\n  opacity: number,\n}\n\nfunction filter(filter: Filter, action: FilterAction): Filter {\n  switch (action.type) {\n\n    case 'NEW_CARD_MAKER':\n      return {\n        color: '#ffffff',\n        opacity: 0,\n      };\n\n    case 'SET_FILTER':\n      return {\n        color: action.color,\n        opacity: action.opacity,\n      };\n\n    default:\n      return filter;\n  }\n}\n\nexport default filter;","export type HeightAction = {\n  type: 'NEW_CARD_MAKER',\n} | {\n  type: 'SET_CANVAS_SIZE',\n  height: number,\n}\n\nfunction heightCanvas(height: number, action: HeightAction): number {\n  switch (action.type) {\n\n    case 'NEW_CARD_MAKER':\n      return 600;\n\n    case 'SET_CANVAS_SIZE':\n      return action.height;\n\n    default:\n      return height;\n  }\n}\n\nexport default heightCanvas;","export enum BlockTypes {\n  img,\n  artObj,\n  text\n}\n\nexport const templates = {\n  template_1: {\n    name: 'Шаблон 1',\n    json: './templates/template_1.json',\n    preview: './templates/template_1.png',\n  },\n  template_2: {\n    name: 'Шаблон 2',\n    json: './templates/template_2.json',\n    preview: './templates/template_2.png',\n  },\n  template_3: {\n    name: 'Шаблон 3',\n    json: './templates/template_3.json',\n    preview: './templates/template_3.png',\n  },\n  template_4: {\n    name: 'Шаблон 4',\n    json: './templates/template_4.json',\n    preview: './templates/template_4.png',\n  },\n  template_5: {\n    name: 'Шаблон 5',\n    json: './templates/template_5.json',\n    preview: './templates/template_5.png',\n  },\n}\n\nexport enum SetOfArtObject {\n  boy = \"./img/artObj/boy.png\",\n  frog = \"./img/artObj/frog.png\",\n  girl = \"./img/artObj/girl.png\",\n  loupe = \"./img/artObj/loupe.png\",\n  palette = \"./img/artObj/palette.png\",\n  pencil = \"./img/artObj/pencil.png\",\n  rainbow = \"./img/artObj/rainbow.png\",\n  snail = \"./img/artObj/snail.png\",\n}\n\nexport type ActionHistory = Readonly<{\n  listState: Canvas[],\n  currentIndex: number,\n}>\n\nexport type Position = Readonly<{\n  x: number,\n  y: number,\n}>\n\nexport type UnifiedBlock = Readonly<{\n  id: string,\n  // type: string,\n}> & Position\n\nexport type ArtObj = Readonly<{\n  src: string,\n  type: BlockTypes.artObj\n}> & UnifiedBlock & Size\n\nexport type Img = Readonly<{\n  src: string,\n  type: BlockTypes.img\n}> & UnifiedBlock & Size\n\nexport type Text = Readonly<{\n  text: string,\n  color: string,\n  size: number,\n  bold: boolean,\n  italic: boolean,\n  underline: boolean,\n  fontFamily: string,\n  type: BlockTypes.text\n}> & UnifiedBlock\n\nexport type Block = Text | Img | ArtObj;\n\nexport type Background = Readonly<{\n  color: string | null,\n  src: string | null,\n}>\n\nexport type Filter = Readonly<{\n  color: string,\n  opacity: number,\n}>\n\nexport type Area = Readonly<{\n  x: number,\n  y: number,\n}> & Size\n\nexport type Canvas = Readonly<{\n  filter: Filter,\n  listBlock: Block[];\n  deleteArea: Area[],\n  background: Background,\n}> & Size\n\nexport type Size = Readonly<{\n  width: number,\n  height: number,\n}>\n\nexport type ViewModelText = {\n  color: string | null,\n  size: number | null,\n  bold: boolean | null,\n  italic: boolean | null,\n  underline: boolean | null,\n  fontFamily: string | null,\n  tempColor: string | null,\n  tempSize: number | null,\n}\n\nexport type ViewModelBgImg = {\n  width: number,\n  height: number,\n  src: string,\n}\n\nexport type ViewModel = Readonly<{\n  bgColor: string | null,\n  bgImg: ViewModelBgImg | null,\n  canvasSize: Size | null,\n  filter: Filter | null,\n  text: ViewModelText,\n  areaSelection: Area | null,\n}>\n\nexport type CardMaker = Readonly<{\n  canvas: Canvas,\n  selectBlock: string | null,\n  history: ActionHistory,\n  viewModel: ViewModel,\n}>\n","export function createGUID() {\n  return [gen(2), gen(1), gen(1), gen(1), gen(3)].join(\"-\");\n}\n\nfunction gen(count: number) {\n  let out = \"\";\n  for (let i: number = 0; i < count; i++) {\n    out += (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);\n  }\n  return out;\n}","import { Block, BlockTypes } from '../types';\nimport { setComponentFields, getIndexById, isSelectedBlock } from '../../utils/elementList'\nimport { isShiftUpAvailable, isShiftDownAvailable } from '../../utils/permisions'\nimport { createGUID } from '../../utils/guid';\n\nexport type ListBlockAction = {\n  type: 'NEW_CARD_MAKER',\n} | {\n  type: 'CREATE_TEXT_BLOCK',\n  x: number,\n  y: number,\n} | {\n  type: 'SET_SIZE_BLOCK',\n  id: string,\n  width: number,\n  height: number,\n} | {\n  type: 'SET_TEXT_IN_TEXT_BLOCK',\n  id: string,\n  text: string,\n} | {\n  type: 'SET_FONT_FAMILY_TEXT',\n  id: string,\n  fontFamily: string,\n} | {\n  type: 'SET_BOLD_TEXT',\n  id: string,\n  isBold: boolean,\n} | {\n  type: 'SET_ITALIC_TEXT',\n  id: string,\n  isItalic: boolean,\n} | {\n  type: 'SET_UNDERLINE_TEXT',\n  id: string,\n  isUnderline: boolean,\n} | {\n  type: 'SET_SIZE_TEXT',\n  id: string,\n  size: number,\n} | {\n  type: 'SET_COLOR_TEXT',\n  id: string,\n  color: string,\n} | {\n  type: 'CREATE_IMG_BLOCK',\n  width: number,\n  height: number,\n  src: string,\n  x: number,\n  y: number,\n} | {\n  type: 'CREATE_ART_OBJ_BLOCK',\n  src: string,\n  x: number,\n  y: number,\n} | {\n  type: 'DELETE_BLOCK',\n  id: string,\n} | {\n  type: 'SET_POSITION_BLOCK',\n  id: string,\n  x: number,\n  y: number,\n} | {\n  type: 'SHIFT_UP_BLOCK',\n  id: string,\n} | {\n  type: 'SHIFT_DOWN_BLOCK',\n  id: string,\n}\n\nfunction listBlock(listBlock: Block[], action: ListBlockAction): Block[] {\n  switch (action.type) {\n\n    case 'NEW_CARD_MAKER':\n      return [];\n\n    case 'CREATE_TEXT_BLOCK':\n      return [\n        ...listBlock,\n        {\n          id: createGUID(),\n          type: BlockTypes.text,\n          color: '#898989',\n          x: action.x - 45,\n          y: action.y - 25,\n          text: '<div>Текст<br></div>',\n          size: 50,\n          bold: false,\n          italic: false,\n          underline: false,\n          fontFamily: 'OpenSans',\n        }\n      ];\n\n    case 'SET_SIZE_BLOCK':\n      return setComponentFields(listBlock, action.id, {\n        width: action.width,\n        height: action.height,\n      });\n\n    case 'SET_TEXT_IN_TEXT_BLOCK':\n      return setComponentFields(listBlock, action.id, {\n        text: action.text,\n      });\n\n    case 'SET_FONT_FAMILY_TEXT':\n      return setComponentFields(listBlock, action.id, {\n        fontFamily: action.fontFamily,\n      });\n\n    case 'SET_BOLD_TEXT':\n      return setComponentFields(listBlock, action.id, {\n        bold: action.isBold,\n      });\n\n    case 'SET_ITALIC_TEXT':\n      return setComponentFields(listBlock, action.id, {\n        italic: action.isItalic,\n      });\n\n    case 'SET_UNDERLINE_TEXT':\n      return setComponentFields(listBlock, action.id, {\n        underline: action.isUnderline,\n      });\n\n    case 'SET_SIZE_TEXT':\n      return setComponentFields(listBlock, action.id, {\n        size: action.size,\n      });\n\n    case 'SET_COLOR_TEXT':\n      return setComponentFields(listBlock, action.id, {\n        color: action.color,\n      });\n\n    case 'CREATE_IMG_BLOCK':\n      return [\n        ...listBlock,\n        {\n          id: createGUID(),\n          type: BlockTypes.img,\n          width: action.width,\n          height: action.height,\n          x: action.x,\n          y: action.y,\n          src: action.src,\n        }\n      ];\n\n    case 'CREATE_ART_OBJ_BLOCK':\n      return [\n        ...listBlock,\n        {\n          id: createGUID(),\n          type: BlockTypes.artObj,\n          width: 150,\n          height: 150,\n          x: action.x,\n          y: action.y,\n          src: action.src,\n        }\n      ];\n\n    case 'DELETE_BLOCK':\n      let copyListBlock: Block[] = [...listBlock];\n      if (isSelectedBlock(action.id)) {\n        copyListBlock.forEach((component, index) => {\n          if (component.id === action.id) {\n            copyListBlock.splice(index, 1);\n            return false;\n          }\n        });\n      }\n      return copyListBlock;\n\n    case 'SET_POSITION_BLOCK':\n      return setComponentFields(listBlock, action.id, {\n        x: action.x,\n        y: action.y,\n      });\n\n    case 'SHIFT_UP_BLOCK':\n      {\n        let newListBlock: Block[] = [...listBlock];\n        if (isShiftUpAvailable(action.id, listBlock)) {\n          const id: string = action.id as string;\n          const index: number = getIndexById(newListBlock, id);\n          const flipValue: Block[] = [newListBlock[index + 1], newListBlock[index]];\n          newListBlock.splice(index, 2, ...flipValue);\n        }\n        return newListBlock;\n      }\n\n    case 'SHIFT_DOWN_BLOCK':\n      {\n        let newListBlock: Block[] = [...listBlock];\n        if (isShiftDownAvailable(action.id, listBlock)) {\n          const id: string = action.id as string;\n          const index: number = getIndexById(newListBlock, id);\n          const flipValue: Block[] = [newListBlock[index], newListBlock[index - 1]];\n          newListBlock.splice(index - 1, 2, ...flipValue);\n        }\n        return newListBlock;\n      }\n\n    default:\n      return listBlock;\n  }\n}\n\nexport default listBlock;","export type WidthAction = {\n  type: 'NEW_CARD_MAKER',\n} | {\n  type: 'SET_CANVAS_SIZE',\n  width: number,\n}\n\nfunction widthCanvas(width: number, action: WidthAction): number {\n  switch (action.type) {\n\n    case 'NEW_CARD_MAKER':\n      return 800;\n\n    case 'SET_CANVAS_SIZE':\n      return action.width;\n\n    default:\n      return width;\n  }\n}\nexport default widthCanvas;","import { Canvas, Area } from '../types';\nimport background, { BackgroundAction } from './BackgroundReducer';\nimport filter, { FilterAction } from './FilterReducer';\nimport heightCanvas, { HeightAction } from './HeightCanvasReducer';\nimport listBlock, { ListBlockAction } from './ListBlockReducer';\nimport widthCanvas, { WidthAction } from './WidthCanvasReducer';\n\nexport type CanvasAction = WidthAction | HeightAction | FilterAction | ListBlockAction | BackgroundAction | DeleteAreaAction;\n\nfunction canvas(canvas: Canvas, action: CanvasAction): Canvas {\n  return {\n    width: widthCanvas(canvas.width, action as WidthAction),\n    height: heightCanvas(canvas.height, action as HeightAction),\n    filter: filter(canvas.filter, action as FilterAction),\n    listBlock: listBlock(canvas.listBlock, action as ListBlockAction),\n    background: background(canvas.background, action as BackgroundAction),\n    deleteArea: deleteArea(canvas.deleteArea, action as DeleteAreaAction),\n  };\n}\n\nexport default canvas;\n\ntype DeleteAreaAction = {\n  type: 'DELETE_AREA_SELECTION',\n  area: Area | null\n} | {\n  type: 'NEW_CARD_MAKER',\n}\n\nfunction deleteArea(deleteArea: Area[], action: DeleteAreaAction): Area[] {\n  switch (action.type) {\n    case 'DELETE_AREA_SELECTION':\n      if (action.area) {\n        return [\n          ...deleteArea,\n          action.area as Area,\n        ];\n      } else {\n        return deleteArea;\n      }\n    case 'NEW_CARD_MAKER':\n      return [];\n  \n    default:\n      return deleteArea;\n  }\n}","export type SelectBlockAction = {\n  type: 'NEW_CARD_MAKER',\n} | {\n  type: 'RESET_SELECTED_BLOCK',\n  width: number,\n} | {\n  type: 'SET_SELECTED_BLOCK',\n  id: string,\n}\n\nfunction selectBlock(selectBlock: null | string, action: SelectBlockAction): string | null {\n  switch (action.type) {\n\n    case 'NEW_CARD_MAKER':\n      return null;\n\n    case 'RESET_SELECTED_BLOCK':\n      return null;\n\n    case 'SET_SELECTED_BLOCK':\n      return action.id;\n\n    default:\n      return selectBlock;\n  }\n}\n\nexport default selectBlock;","import { Canvas as CanvasType, ActionHistory as ActionHistoryType } from '../types';\nimport { isUndoAvailable, isRedoAvailable } from '../../utils/permisions'\nimport canvas from './CanvasReducer';\n\nexport type HistoryAction = {\n  type: 'NEW_CARD_MAKER',\n} | {\n  type: 'ADD_HISTORY',\n  newCanvas: CanvasType,\n} | {\n  type: 'UNDO',\n} | {\n  type: 'REDO',\n}\n\nfunction history(history: ActionHistoryType, action: HistoryAction): ActionHistoryType {\n  switch (action.type) {\n\n    case 'NEW_CARD_MAKER':\n      return {\n        listState: [canvas({} as CanvasType, action)],\n        currentIndex: 0,\n      };\n\n    case 'ADD_HISTORY':\n      {\n        const listState: CanvasType[] = history.listState;\n        const currentIndex: number = history.currentIndex;\n        let newListState: CanvasType[] = [...history.listState];\n        if (currentIndex !== listState.length - 1) {\n          newListState.splice(currentIndex + 1, listState.length - currentIndex + 1);\n        }\n        newListState.push(action.newCanvas);\n        return {\n          currentIndex: currentIndex + 1,\n          listState: newListState,\n        };\n      }\n\n    case 'UNDO':\n      {\n        const currentIndex: number = history.currentIndex;\n        const newCurrentIndex: number = isUndoAvailable(history) ? currentIndex - 1 : currentIndex;\n        return {\n          ...history,\n          currentIndex: newCurrentIndex,\n        }\n      }\n\n    case 'REDO':\n      {\n        const currentIndex: number = history.currentIndex;\n        const newCurrentIndex: number = isRedoAvailable(history) ? currentIndex + 1 : currentIndex;\n        return {\n          ...history,\n          currentIndex: newCurrentIndex,\n        }\n      }\n\n    default:\n      return history;\n  }\n}\n\nexport default history;","import { CardMaker, Size, Filter, ViewModelText, Block, Text, Area } from \"../types\";\nimport { getIndexById } from '../../utils/elementList';\n\nexport type ViewModelAction = BgColorAction | BgImgAction | CanvasSizeAction | FilterAction | TextAction;\n\nfunction viewModel(cardMaker: CardMaker = {} as CardMaker, action: ViewModelAction) {\n  return {\n    bgColor: bgColor(cardMaker, action as BgColorAction),\n    bgImg: bgImg(cardMaker, action as BgImgAction),\n    canvasSize: canvasSize(cardMaker, action as CanvasSizeAction),\n    filter: filter(cardMaker, action as FilterAction),\n    text: text(cardMaker, action as TextAction),\n    areaSelection: areaSelection(cardMaker, action as AreaSelectionAction),\n  }\n}\n\ntype AreaSelectionAction = {\n  type: 'AREA_SELECTION',\n  x: number,\n  y: number,\n  width: number,\n  height: number,\n} | {\n  type: 'RESET_AREA_SELECTION',\n} | {\n  type: 'SET_POSITION_AREA_SELECTION',\n  x: number,\n  y: number,\n} | {\n  type: 'UNDO',\n} | {\n  type: 'REDO'\n}\n\nfunction areaSelection(cardMaker: CardMaker, action: AreaSelectionAction): Area | null {\n  switch (action.type) {\n    case 'AREA_SELECTION':\n      return {\n        x: action.x,\n        y: action.y,\n        width: action.width,\n        height: action.height,\n      }\n    case 'SET_POSITION_AREA_SELECTION':\n      return {\n        ...cardMaker.viewModel.areaSelection as Area,\n        x: action.x,\n        y: action.y,\n      };\n    case 'RESET_AREA_SELECTION': return null;\n    case 'UNDO': return null;\n    case 'REDO': return null;\n    default: return cardMaker.viewModel.areaSelection;\n  }\n}\n\ntype BgColorAction = {\n  type: 'INPUT_BACKGROUND_COLOR',\n  color: string,\n} | {\n  type: 'UNDO',\n} | {\n  type: 'REDO'\n}\n\nfunction bgColor(cardMaker: CardMaker, action: BgColorAction): string | null {\n  switch (action.type) {\n    case 'INPUT_BACKGROUND_COLOR': return action.color;\n    case 'UNDO': return null;\n    case 'REDO': return null;\n    default: return cardMaker.canvas.background.color;\n  }\n}\n\ntype BgImgAction = {\n  type: 'INPUT_BACKGROUND_IMG',\n  width: number,\n  height: number,\n  src: string,\n} | {\n  type: 'UNDO',\n} | {\n  type: 'REDO'\n}\n\nfunction bgImg(cardMaker: CardMaker, action: BgImgAction): Size & { src: string } | null {\n  switch (action.type) {\n    case 'INPUT_BACKGROUND_IMG':\n      return {\n        width: action.width,\n        height: action.height,\n        src: action.src,\n      };\n    case 'UNDO': return null;\n    case 'REDO': return null;\n    default: return null;\n  }\n}\n\ntype CanvasSizeAction = {\n  type: 'INPUT_CANVAS_SIZE',\n  width: number,\n  height: number,\n} | {\n  type: 'UNDO',\n} | {\n  type: 'REDO'\n}\n\nfunction canvasSize(cardMaker: CardMaker, action: CanvasSizeAction): Size | null {\n  switch (action.type) {\n    case 'INPUT_CANVAS_SIZE':\n      return {\n        width: action.width,\n        height: action.height,\n      };\n    case 'UNDO': return null;\n    case 'REDO': return null;\n    default:\n      return cardMaker.viewModel.canvasSize\n  }\n}\n\ntype FilterAction = {\n  type: 'INPUT_FILTER',\n  color: string,\n  opacity: number,\n} | {\n  type: 'UNDO',\n} | {\n  type: 'REDO'\n}\n\nfunction filter(cardMaker: CardMaker, action: FilterAction): Filter | null {\n  switch (action.type) {\n    case 'INPUT_FILTER':\n      return {\n        color: action.color,\n        opacity: action.opacity,\n      };\n    case 'UNDO': return null;\n    case 'REDO': return null;\n    default:\n      return cardMaker.viewModel.filter\n  }\n}\n\ntype TextAction = {\n  type: 'CLICK_ON_TEXT',\n  id: string,\n} | {\n  type: 'RESET_SELECTED_BLOCK',\n} | {\n  type: 'SET_SELECTED_BLOCK',\n  id: string,\n} | {\n  type: 'SET_FONT_FAMILY_TEXT',\n  id: string,\n  fontFamily: string,\n} | {\n  type: 'INPUT_COLOR_TEXT',\n  color: string,\n} | {\n  type: 'INPUT_SIZE_TEXT',\n  size: number,\n} | {\n  type: 'SET_BOLD_TEXT',\n  id: string,\n  isBold: boolean,\n} | {\n  type: 'SET_ITALIC_TEXT',\n  id: string,\n  isItalic: boolean,\n} | {\n  type: 'SET_UNDERLINE_TEXT',\n  id: string,\n  isUnderline: boolean,\n} | {\n  type: 'UNDO',\n} | {\n  type: 'REDO'\n}\n\nfunction text(cardMaker: CardMaker, action: TextAction): ViewModelText {\n  const defState: ViewModelText = {\n    color: null,\n    size: null,\n    bold: null,\n    italic: null,\n    underline: null,\n    fontFamily: null,\n    tempColor: null,\n    tempSize: null,\n  }\n\n  let list: Block[]\n  switch (action.type) {\n\n    case 'CLICK_ON_TEXT':\n      list = cardMaker.canvas.listBlock;\n      const { color, size, bold, italic, underline, fontFamily } = list[getIndexById(list, action.id)] as Text;\n      return { color, tempColor: null, tempSize: null, size, bold, italic, underline, fontFamily }\n\n    case 'SET_FONT_FAMILY_TEXT':\n      return {\n        ...cardMaker.viewModel.text,\n        fontFamily: action.fontFamily\n      } as ViewModelText;\n\n    case 'INPUT_COLOR_TEXT':\n      return {\n        ...cardMaker.viewModel.text,\n        tempColor: action.color\n      } as ViewModelText;\n\n    case 'INPUT_SIZE_TEXT':\n      return {\n        ...cardMaker.viewModel.text,\n        tempSize: action.size\n      } as ViewModelText;\n\n    case 'SET_BOLD_TEXT':\n      return {\n        ...cardMaker.viewModel.text,\n        bold: action.isBold\n      } as ViewModelText;\n\n    case 'SET_ITALIC_TEXT':\n      return {\n        ...cardMaker.viewModel.text,\n        italic: action.isItalic\n      } as ViewModelText;\n\n    case 'SET_UNDERLINE_TEXT':\n      return {\n        ...cardMaker.viewModel.text,\n        underline: action.isUnderline\n      } as ViewModelText;\n\n    case 'SET_SELECTED_BLOCK': return defState;\n    case 'RESET_SELECTED_BLOCK': return defState;\n\n    case 'UNDO': return defState;\n\n    case 'REDO': return defState;\n\n    default:\n      return cardMaker.viewModel.text\n  }\n}\n\nexport default viewModel;","import {\n  ActionHistory,\n  ArtObj,\n  Img,\n  Text,\n  Background,\n  Filter,\n  Canvas,\n  CardMaker,\n  ViewModel,\n  BlockTypes,\n  Area\n} from \"./types\";\n\n\nconst testSetOfArtObject = {\n  boy: \"img/artObj/boy.png\",\n  frog: \"img/artObj/frog.png\",\n  girl: \"img/artObj/girl.png\",\n  loupe: \"img/artObj/loupe.png\",\n  palette: \"img/artObj/palette.png\",\n  pencil: \"img/artObj/pencil.png\",\n  rainbow: \"img/artObj/rainbow.png\",\n  snail: \"img/artObj/snail.png\",\n}\n\nconst testArtObj: ArtObj = {\n  id: \"d3df27cd-3053-21a6-4abe-9db51cda7c17\",\n  type: BlockTypes.artObj,\n  width: 150,\n  height: 150,\n  x: 20,\n  y: 280,\n  src: testSetOfArtObject.girl,\n}\n\nconst testImg: Img = {\n  id: \"4f406201-6f2f-b9ce-575e-438b1a7d1456\",\n  type: BlockTypes.img,\n  width: 320,\n  height: 238,\n  x: 100,\n  y: 270,\n  src: \"https://images.pexels.com/photos/3337209/pexels-photo-3337209.jpeg?cs=srgb&dl=pexels-mo-3337209.jpg&fm=jpg\",\n}\n\nconst testText: Text = {\n  id: \"9a13a85a-59ee-7ba3-1c64-fcad25650fc1\",\n  type: BlockTypes.text,\n  x: 200,\n  y: 280,\n  text: \"<div>Это</div><div>закат!!!</div>\",\n  size: 40,\n  bold: true,\n  italic: true,\n  underline: true,\n  color: \"#ffffff\",\n  fontFamily: \"Sensei\",\n}\n\nconst testBackground: Background = {\n  color: null,\n  src: \"https://images.pexels.com/photos/8175462/pexels-photo-8175462.jpeg?auto=compress&cs=tinysrgb&h=650&w=940\",\n}\n\nconst testFilter: Filter = {\n  color: \"#c1e319\",\n  opacity: 0.05,\n}\n\nconst deleteArea: Area[] = [\n  {\n    width: 100,\n    height: 50,\n    x: 150,\n    y: 200,\n  },\n  {\n    width: 70,\n    height: 50,\n    x: 350,\n    y: 175,\n  }\n];\n\n\nconst testCanvas: Canvas = {\n  width: 800,\n  height: 800,\n  filter: testFilter,\n  listBlock: [\n    testImg,\n    testArtObj,\n    testText\n  ],\n  deleteArea: deleteArea,\n  background: testBackground,\n}\n\nconst testActionHistory: ActionHistory = {\n  listState:\n    [\n      testCanvas,\n    ],\n  currentIndex: 0,\n}\n\nconst viewModel: ViewModel = {\n  bgColor: null,\n  bgImg: null,\n  canvasSize: null,\n  filter: null,\n  text: {\n    color: null,\n    size: null,\n    bold: null,\n    italic: null,\n    underline: null,\n    fontFamily: null,\n    tempColor: null,\n    tempSize: null,\n  },\n  areaSelection: null,\n}\n\nexport const testCardMaker: CardMaker = {\n  canvas: testCanvas,\n  selectBlock: null,\n  history: testActionHistory,\n  viewModel: viewModel,\n}","import { createStore, applyMiddleware, Store, MiddlewareAPI, Dispatch, AnyAction } from 'redux';\nimport { cardMakerReducer } from './reducers/CardMakerReducer';\nimport { testCardMaker as initialState } from './initialState';\nimport { CardMaker } from './types';\n\nimport { addHistory, afterChangeHistory } from './actionCreators/historyActionCreators';\n\n\nconst exceptions: string[] = [\n  'NEW_CARD_MAKER',\n  'ADD_HISTORY',\n  'AFTER_CHANGE_HISTORY',\n  'UNDO',\n  'REDO',\n  'SET_SELECTED_BLOCK',\n  'RESET_SELECTED_BLOCK',\n  'INPUT_SIZE_TEXT',\n  'INPUT_COLOR_TEXT',\n  'SET_SIZE_TEXT',\n  'SET_POSITION_AREA_SELECTION',\n  'RESET_AREA_SELECTION',\n  'AREA_SELECTION',\n  'INPUT_FILTER',\n  'INPUT_CANVAS_SIZE',\n  'INPUT_BACKGROUND_IMG',\n  'INPUT_BACKGROUND_COLOR',\n];\n\nconst storeHistory = (store: MiddlewareAPI<Dispatch<AnyAction>, CardMaker>) =>\n  (next: AppDispatch) => (action: AnyAction) => {\n    const oldState = store.getState();\n    const result = next(action)\n    const newState = store.getState();\n\n    if (!exceptions.includes(action.type)) {\n      if (JSON.stringify(oldState.canvas) !== JSON.stringify(newState.canvas)) {\n        console.log('сохранение истории');\n        store.dispatch(addHistory(newState.canvas));\n      }\n    }\n    return result\n  }\n\nconst valid: string[] = [\n  'UNDO',\n  'REDO',\n];\n\nconst movingHistory = (store: MiddlewareAPI<Dispatch<AnyAction>, CardMaker>) =>\n  (next: AppDispatch) => (action: AnyAction) => {\n    const result = next(action)\n\n    if ((valid.includes(action.type)) && (action.type !== 'AFTER_CHANGE_HISTORY')) {\n      const canvas = store.getState().history.listState[store.getState().history.currentIndex];\n      const newState = {\n        ...store.getState(),\n        canvas,\n      }\n      store.dispatch(afterChangeHistory(newState));\n    }\n    return result\n  }\n\nexport const store: Store<CardMaker> = createStore(\n  cardMakerReducer,\n  initialState,\n  applyMiddleware(storeHistory, movingHistory)\n);\n\nexport type RootState = ReturnType<typeof store.getState>\nexport type AppDispatch = typeof store.dispatch","import { CardMaker } from '../types';\nimport canvas, { CanvasAction } from './CanvasReducer';\nimport selectBlock, { SelectBlockAction } from './SelectBlockReducer';\nimport history, { HistoryAction } from './HistoryReducer';\nimport viewModel, { ViewModelAction } from './ViewModelReducer';\n\nexport type CardMakerReducerAction = {\n  type: 'AFTER_CHANGE_HISTORY',\n  cardMaker: CardMaker,\n} | {\n  type: 'APPLY_FILE_PROJECT',\n  project: CardMaker,\n} | CanvasAction | SelectBlockAction | HistoryAction | ViewModelAction;\n\nexport function cardMakerReducer(cardMaker: CardMaker = {} as CardMaker, action: CardMakerReducerAction): CardMaker {\n  switch (action.type) {\n\n    case 'AFTER_CHANGE_HISTORY':\n      return action.cardMaker;\n\n    case 'APPLY_FILE_PROJECT':\n      return action.project;\n\n    default:\n      return {\n        canvas: canvas(cardMaker.canvas, action as CanvasAction),\n        selectBlock: selectBlock(cardMaker.selectBlock, action as SelectBlockAction),\n        history: history(cardMaker.history, action as HistoryAction),\n        viewModel: viewModel(cardMaker, action as ViewModelAction)\n      }\n  }\n}\n\n","import { Canvas, CardMaker } from '../types';\n\nexport function addHistory(newCanvas: Canvas) {\n  return {\n    type: 'ADD_HISTORY',\n    newCanvas: newCanvas,\n  }\n}\n\nexport function undo() {\n  return {\n    type: 'UNDO',\n  }\n}\n\nexport function redo() {\n  return {\n    type: 'REDO',\n  }\n}\n\nexport function afterChangeHistory(cardMaker: CardMaker) {\n  return {\n    type: 'AFTER_CHANGE_HISTORY',\n    cardMaker: cardMaker,\n  }\n}","import { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { faTimes } from '@fortawesome/free-solid-svg-icons'\nimport { ReactElement, useEffect } from \"react\"\nimport { connect } from \"react-redux\"\nimport styles from './Modal.module.css';\n\n// интерфейс для пропсов\ntype ModalProps = {\n  visible: boolean\n  title: string\n  content: ReactElement | string\n  footer: ReactElement | string\n  onClose: () => void\n}\n\nconst Modal = ({\n  visible = false,\n  title = '',\n  content = '',\n  footer = '',\n  onClose,\n}: ModalProps) => {\n\n  // c помощью useEffect цепляем обработчик к нажатию клавиш\n  useEffect(() => {\n    // создаем обработчик нажатия клавиши Esc\n    const onKeydown = ({ key }: KeyboardEvent) => {\n      switch (key) {\n        case 'Escape':\n          onClose()\n          break\n      }\n    }\n    document.addEventListener('keydown', onKeydown)\n    return () => document.removeEventListener('keydown', onKeydown)\n  }, [onClose])\n\n  // если компонент невидим, то не отображаем его\n  if (!visible) {\n    return null;\n  }\n\n  // или возвращаем верстку модального окна\n  return <div className={styles.modal} onClick={onClose}>\n    <div className={styles.modalDialog} onClick={e => e.stopPropagation()}>\n      <div className={styles.modalHeader}>\n        <h3 className={styles.modalTitle}>{title}</h3>\n        <span className={styles.modalClose} onClick={onClose}>\n        <FontAwesomeIcon icon={faTimes} />\n        </span>\n      </div>\n      <div className={styles.modalBody}>\n        <div className={styles.modalContent}>{content}</div>\n      </div>\n      {footer && <div className={styles.modalFooter}>{footer}</div>}\n    </div>\n  </div>\n}\n\nexport default connect()(Modal)","import { faPiedPiperSquare } from '@fortawesome/free-brands-svg-icons'\nimport { connect } from 'react-redux';\nimport { useState } from 'react';\nimport { AppDispatch } from '../../../../../store/store';\nimport { newCardMaker } from '../../../../../store/actionCreators/cardMakerActionCreators';\nimport NavButton from '../NavButton/NavButton';\nimport Modal from '../../../../modal/Modal';\n\ntype NewProjectButtonProps = {\n  newCardMaker: () => void,\n}\n\nfunction NewProjectButton(props: NewProjectButtonProps) {\n  const [isModal, setModal] = useState(false)\n  const onClose = () => setModal(false)\n  const onAccept = () => {\n    props.newCardMaker();\n    onClose()\n  }\n\n  const content =\n    <>\n      <p>Несохраненные изменения будут потеряны</p>\n      <p>Вы хотите продолжить ?</p>\n    </>\n\n  const footer =\n    <>\n      <button onClick={onAccept}>Да</button>\n      <button onClick={onClose}>Нет</button>\n    </>\n\n\n  return (\n    <>\n      <NavButton label=\"Новая\" icon={faPiedPiperSquare} onClick={() => setModal(true)} />\n      <Modal\n        visible={isModal}\n        title=\"Новая открытка\"\n        content={content}\n        footer={footer}\n        onClose={onClose}\n      />\n    </>\n  );\n}\n\nconst mapDispatchToProps = (dispatch: AppDispatch) => {\n  return {\n    newCardMaker: () => dispatch(newCardMaker()),\n  }\n}\n\nexport default connect(null, mapDispatchToProps)(NewProjectButton);","import { CardMaker } from '../types';\n\nexport function newCardMaker() {\n  return {\n    type: 'NEW_CARD_MAKER',\n  }\n}\n\nexport function applyFileProject(cardMaker: CardMaker) {\n  return {\n    type: 'APPLY_FILE_PROJECT',\n    project: cardMaker,\n  }\n}\n","\nimport { store } from \"../store/store\";\nimport { Text, Block, BlockTypes } from \"../store/types\";\n\nexport async function exportImg(type: string): Promise<void> {\n\n  const elements = store.getState().canvas.listBlock;\n  const deleteAreas = store.getState().canvas.deleteArea;\n\n  const width = store.getState().canvas.width;\n  const height = store.getState().canvas.height;\n  const background = store.getState().canvas.background;\n  const filter = store.getState().canvas.filter;\n\n  const canvas = document.createElement('canvas');\n  canvas.width = width;\n  canvas.height = height;\n  const ctx = canvas.getContext('2d') as CanvasRenderingContext2D;\n\n  // рендер фона\n  if (background.src) {\n    const img = new Image();\n    img.crossOrigin = 'anonymous'\n    img.src = background.src;\n    await img.decode();\n\n    let imgWidth = img.width;\n    let imgHeight = img.height;\n    \n    if (img.width < width) {\n      imgHeight = (img.height * width) / img.width;\n      imgWidth = (img.width * imgHeight) / img.height;\n    }\n\n    if (img.height < height) {\n      imgWidth = (img.width * height) / img.height;\n      imgHeight = (img.height * imgWidth) / img.width;\n    }\n    ctx.drawImage(img, 0, 0, imgWidth, imgHeight);\n  } else if (background.color) {\n    ctx.fillStyle = background.color;\n    ctx.fillRect(0, 0, width, height);\n  }\n\n  // рендер блоков\n  for (let index = 0; index < elements.length; index++) {\n    await renderBlock(elements[index], ctx);\n  }\n\n  // рендер фильтра\n  const color = convertColor(filter.color);\n  ctx.fillStyle = `rgba(${color.r}, ${color.g}, ${color.b}, ${filter.opacity})`;\n  ctx.fillRect(0, 0, width, height);\n\n\n  ctx.fillStyle = '#ffffff';\n  deleteAreas.forEach(element => {\n    ctx.fillRect(element.x, element.y, element.width, element.height);\n  });\n\n  const dataURL = canvas.toDataURL(type);\n  const link = document.createElement(\"a\");\n  link.href = dataURL;\n  link.download = \"new-image\";\n  link.click();\n}\n\nasync function renderBlock(element: Block, ctx: CanvasRenderingContext2D) {\n  \n  // стандартный сдвиг объекта\n  const defShiftX = 5\n\n  // высота строки\n  const lineHeight = 1.2;\n\n  switch (element.type) {\n\n    // рендер текста\n    case BlockTypes.text:\n      const style = getStyle(element);\n      const textBlock = document.createElement('div');\n      textBlock.innerHTML = element.text;\n      // сдивг строки\n      let shift = 0;\n\n      // отрисовка строк\n      for (let str of Array.from(textBlock.children) as HTMLDivElement[]) {\n\n        ctx.fillStyle = style.color;\n        ctx.font = style.italic + ' ' + style.weight + ' ' + style.size + 'px ' + style.family;\n        ctx.fillText(str.innerText, element.x + defShiftX, element.y + shift + style.size);\n        // подчеркивание\n        if (element.underline) {\n          const textWidth = ctx.measureText(str.innerText).width;\n          let chars = 0;\n          let underline = '';\n          while (str.innerText.length > chars) {\n            underline += '_';\n            chars++;\n          }\n          ctx.font = `700 ${style.size}px openSans`;\n          ctx.fillText(underline, element.x + defShiftX, element.y + shift + style.size, textWidth);\n        }\n        shift += element.size * lineHeight;\n      }\n\n      break;\n\n    // рендер изображения\n    case BlockTypes.img:\n      const img = new Image();\n      img.crossOrigin = 'anonymous'\n      img.src = element.src;\n\n      await img.decode();\n      ctx.drawImage(img, element.x, element.y, element.width, element.height);\n      break;\n\n    // рендер арт-объекта\n    case BlockTypes.artObj:\n      const artObj = new Image();\n      artObj.crossOrigin = 'anonymous'\n      artObj.src = element.src;\n\n      await artObj.decode();\n      ctx.drawImage(artObj, element.x, element.y, element.width, element.height)\n      break;\n  }\n}\n\n// формирование стилей для текстового блока\nfunction getStyle(text: Text) {\n  return {\n    x: text.x,\n    y: text.y,\n    color: text.color,\n    size: text.size,\n    weight: text.bold ? '700' : '',\n    italic: text.italic ? 'italic' : '',\n    family: text.fontFamily,\n  };\n}\n\nexport type RGB = {\n  r: number,\n  g: number,\n  b: number\n}\n\n// конвертирование hex в rgb\nfunction convertColor(color: string): RGB {\n  if (color.substring(0, 1) === '#') {\n    color = color.substring(1);\n  }\n  const rgbColor: RGB = {\n    r: 255,\n    g: 255,\n    b: 255,\n  };\n  rgbColor.r = parseInt(color.substring(0, 2), 16);\n  rgbColor.g = parseInt(color.substring(2, 4), 16);\n  rgbColor.b = parseInt(color.substring(4), 16);\n  return rgbColor;\n}","import { faImage } from '@fortawesome/free-solid-svg-icons'\nimport { connect } from 'react-redux';\nimport { useRef, useState } from 'react';\nimport NavButton from '../NavButton/NavButton';\nimport Modal from '../../../../modal/Modal';\nimport { exportImg } from \"../../../../../utils/exportImg\";\n\nfunction ExportImgButton() {\n\n  const downloadImg = useRef<HTMLButtonElement>(null);\n\n  const [isModal, setModal] = useState(false)\n  const onClose = () => setModal(false)\n\n  const onAcceptJpg = () => {\n    exportImg('image/jpeg');\n    onClose();\n  }\n\n  const onAcceptPng = () => {\n    exportImg('image/png');\n    onClose();\n  }\n\n  const content =\n    <>\n      <p>Выберите формат сохраняемого файла</p>\n    </>\n\n  const footer =\n    <>\n      <button onClick={onAcceptJpg}>jpg</button>\n      <button onClick={onAcceptPng}>png</button>\n      <button onClick={onClose}>Отмена</button>\n    </>\n\n\n  return (\n    <>\n      <NavButton label=\"В jpg/png\" icon={faImage} onClick={() => setModal(true)} ref={downloadImg} />\n      <Modal\n        visible={isModal}\n        title=\"Сохранить как...\"\n        content={content}\n        footer={footer}\n        onClose={onClose}\n      />\n    </>\n  );\n}\n\nexport default connect()(ExportImgButton);","import styles from './Navbar.module.css';\nimport { faClone, faUndo, faRedo, faFileExport, faFolderOpen } from '@fortawesome/free-solid-svg-icons'\nimport NavButton from './navButton/NavButton/NavButton';\nimport NavFileButton from './navButton/NavFileButton/NavFileButton';\nimport { useRef } from 'react';\nimport { useImportFileProject } from './useImportFileProject';\nimport { useStateHistory } from './useStateHistory';\nimport { connect } from 'react-redux';\nimport { undo, redo } from '../../../store/actionCreators/historyActionCreators';\nimport { applyFileProject } from '../../../store/actionCreators/cardMakerActionCreators';\nimport { CardMaker as CardMakerType } from '../../../store/types';\nimport { AppDispatch } from '../../../store/store';\nimport { useExportFileProject } from './useExportFileProject';\nimport NewProjectButton from './navButton/NewProjectButton/NewProjectButton';\nimport ExportImgButton from './navButton/ExportImgButton/ExportImgButton';\n\ntype NavbarProps = {\n  undo: () => void,\n  redo: () => void,\n  applyFileProject: (file: CardMakerType) => void,\n}\n\nfunction Navbar(props: NavbarProps) {\n  const buttonUndo = useRef<HTMLButtonElement>(null);\n  const buttonRedo = useRef<HTMLButtonElement>(null);\n  useStateHistory(\n    buttonUndo,\n    buttonRedo,\n    props.undo,\n    props.redo,\n  );\n\n  const inputFile = useRef<HTMLInputElement>(null);\n  const downloadFile = useRef<HTMLButtonElement>(null);\n\n  useImportFileProject(inputFile, props.applyFileProject);\n  useExportFileProject(downloadFile);\n\n  return (\n    <>\n      <nav className={styles.navbar}>\n        <NavFileButton label=\"Открыть\" icon={faFolderOpen} ref={inputFile} />\n        <NewProjectButton />\n        <ExportImgButton />\n        <NavButton label=\"в json\" icon={faFileExport} ref={downloadFile} onClick={null} />\n        <NavButton label=\"Шаблоны\" icon={faClone} onClick={null} />\n        <NavButton label=\"\" icon={faUndo} ref={buttonUndo} onClick={null} />\n        <NavButton label=\"\" icon={faRedo} ref={buttonRedo} onClick={null} />\n      </nav>\n    </>\n  );\n}\nconst mapDispatchToProps = (dispatch: AppDispatch) => {\n  return {\n    undo: () => dispatch(undo()),\n    redo: () => dispatch(redo()),\n    applyFileProject: (file: CardMakerType) => dispatch(applyFileProject(file)),\n  }\n}\n\nexport default connect(null, mapDispatchToProps)(Navbar);\n","import { RefObject, useEffect } from 'react';\nimport { verify } from '../../../utils/permisions';\n\nexport function useStateHistory(\n  buttonUndo: RefObject<HTMLButtonElement>,\n  buttonRedo: RefObject<HTMLButtonElement>,\n  undo: () => void,\n  redo: () => void,\n): void {\n\n\n  useEffect(() => {\n\n    const btnUndo = buttonUndo.current;\n    const btnRedo = buttonRedo.current;\n\n    function handlerClickUndo(): void {\n      undo();\n    }\n  \n    function handlerClickRedo(): void {\n      redo();\n    }\n  \n    function handlerKeydown(event: KeyboardEvent): void {\n      if (event.code === 'KeyZ' && (event.ctrlKey || event.metaKey)) {\n        undo();\n      }\n      if (event.code === 'KeyY' && (event.ctrlKey || event.metaKey)) {\n        redo();\n      }\n    }\n    \n    \n    verify(btnUndo).addEventListener(\"click\", handlerClickUndo);\n    verify(btnRedo).addEventListener(\"click\", handlerClickRedo);\n    document.addEventListener(\"keydown\", handlerKeydown);\n    return () => {\n      if (btnUndo) btnUndo.removeEventListener(\"click\", handlerClickUndo);\n      if (btnRedo) btnRedo.removeEventListener(\"click\", handlerClickRedo);\n      document.removeEventListener(\"keydown\", handlerKeydown);\n    };\n  }, [buttonUndo, buttonRedo, undo, redo]);\n}","import { RefObject, useEffect } from 'react';\nimport { store } from '../../../store/store';\nimport { verify } from '../../../utils/permisions';\n\nexport function useExportFileProject(downloadButton: RefObject<HTMLButtonElement>): void {\n\n  useEffect(() => {\n\n    const button = downloadButton.current;\n\n    function handlerClickSaveToJson(event: Event): void {\n      const cardMaker = store.getState();\n      const json = JSON.stringify({\n        ...cardMaker,\n        history: {\n          listState: [cardMaker.canvas],\n          currentIndex: 0,\n        }\n      });\n      const file = new Blob([json], { type: 'application/json' });\n      let link = document.createElement(\"a\");\n      link.href = URL.createObjectURL(file);\n      link.download = \"Новый проект.json\";\n      link.click();\n    }\n\n    \n    verify(button).addEventListener(\"click\", handlerClickSaveToJson);\n    return () => {\n      if (button) button.removeEventListener(\"click\", handlerClickSaveToJson);\n    };\n  }, [downloadButton]);\n}","import { getProjectFromFile } from '../../../utils/files';\nimport { RefObject, useEffect } from 'react';\nimport { CardMaker as CardMakerType } from '../../../store/types';\nimport { verify } from '../../../utils/permisions';\n\nexport function useImportFileProject(\n  inputFile: RefObject<HTMLInputElement>,\n  applyFileProject: (file: CardMakerType) => void): void {\n\n  useEffect(() => {\n\n    const input = inputFile.current;\n\n    async function handlerChangeInputFile(event: Event): Promise<void> {\n      const target = event.target as HTMLInputElement;\n      const files = target.files as FileList;\n      applyFileProject(await getProjectFromFile(files[0]))\n      target.value = '';\n    }\n\n    \n    verify(input).addEventListener(\"change\", handlerChangeInputFile);\n    return () => {\n      if (input) input.removeEventListener(\"change\", handlerChangeInputFile);\n    };\n  }, [inputFile, applyFileProject]);\n}","import { store } from '../store';\n\nexport function createTextBlock() {\n  return {\n    type: 'CREATE_TEXT_BLOCK',\n    x: store.getState().canvas.width / 2,\n    y: store.getState().canvas.height / 2,\n  }\n}\n\nexport function setTextInTextBlock(text: string) {\n  return {\n    type: 'SET_TEXT_IN_TEXT_BLOCK',\n    id: store.getState().selectBlock,\n    text: text,\n  }\n}\n\nexport function setFontFamilyText(fontFamily: string) {\n  return {\n    type: 'SET_FONT_FAMILY_TEXT',\n    id: store.getState().selectBlock,\n    fontFamily: fontFamily,\n  }\n}\n\nexport function setBoldText(isBold: boolean) {\n  return {\n    type: 'SET_BOLD_TEXT',\n    id: store.getState().selectBlock,\n    isBold: isBold,\n  }\n}\n\nexport function setItalicText(isItalic: boolean) {\n  return {\n    type: 'SET_ITALIC_TEXT',\n    id: store.getState().selectBlock,\n    isItalic: isItalic,\n  }\n}\n\nexport function setUnderlineText(isUnderline: boolean) {\n  return {\n    type: 'SET_UNDERLINE_TEXT',\n    id: store.getState().selectBlock,\n    isUnderline: isUnderline,\n  }\n}\n\nexport function setSizeText(size: number) {\n  return {\n    type: 'SET_SIZE_TEXT',\n    id: store.getState().selectBlock,\n    size: size,\n  }\n}\n\nexport function inputColorText(color: string) {\n  return {\n    type: 'INPUT_COLOR_TEXT',\n    color: color,\n  }\n}\n\nexport function inputSizeText(size: number) {\n  return {\n    type: 'INPUT_SIZE_TEXT',\n    size: size,\n  }\n}\n\nexport function setColorText(color: string) {\n  return {\n    type: 'SET_COLOR_TEXT',\n    id: store.getState().selectBlock,\n    color: color,\n  }\n}","import styles from './ButtonEditText.module.css';\nimport { IconDefinition } from '@fortawesome/fontawesome-svg-core';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { useRef } from 'react';\nimport { connect } from 'react-redux';\nimport { useEditStateText } from './useEditStateText';\n\ntype ButtonEditTextProps = {\n  icon: IconDefinition,\n  enabled: boolean | null,\n  modifyFn: ((enabled: boolean) => void) | (() => void),\n  param: boolean,\n}\n\nfunction ButtonEditText(props: ButtonEditTextProps) {\n  const button = useRef<HTMLButtonElement>(null);\n\n  useEditStateText(button, props.enabled,  props.modifyFn, props.param);\n\n  return (\n    <button className={styles.button + ' ' + (props.enabled ? styles.active : '')} ref={button}>\n      <FontAwesomeIcon icon={props.icon} />\n    </button>\n  );\n};\n\n\nexport default connect()(ButtonEditText);","import { RefObject, useEffect } from \"react\";\nimport { verify } from \"../../../../../utils/permisions\";\n\nexport function useEditStateText(\n  button: RefObject<HTMLButtonElement>,\n  enabled: boolean | null,\n  modifyFn: (() => void) | ((enabled: boolean) => void),\n  param: boolean) {\n\n  useEffect(() => {\n\n    const btn = button.current;\n\n    function handleClickButton(event: Event) {\n      if (enabled !== null) {\n        modifyFn(!enabled)\n        event.preventDefault();\n      } else if (!param) {\n        modifyFn(true)\n      }\n    }\n\n\n    verify(btn).addEventListener(\"click\", handleClickButton);\n    return () => {\n      if (btn) btn.removeEventListener(\"click\", handleClickButton);\n    };\n  }, [button, modifyFn, enabled, param]);\n}","import styles from './ColorPicker.module.css';\nimport { useRef } from 'react';\nimport { connect } from 'react-redux';\nimport { AppDispatch, RootState } from '../../../../../store/store';\nimport { inputColorText, setColorText } from '../../../../../store/actionCreators/textBlockActionCreators';\nimport { useEditColorText } from './useEditColorText';\n\ntype ColorPickerProps = {\n  setColorText: (color: string) => void,\n  inputColorText: (color: string) => void,\n  color: string | null\n}\n\nfunction ColorPicker(props: ColorPickerProps) {\n  const colorPicker = useRef<HTMLInputElement>(null);\n  useEditColorText(props.color, colorPicker, props.setColorText, props.inputColorText);\n  return (\n    <input type=\"color\"\n      ref={colorPicker}\n      className={styles.input}\n    />\n  );\n}\n\nfunction mapStateToProps(state: RootState) {\n  return {\n    color: state.viewModel.text.color,\n  }\n};\n\nconst mapDispatchToProps = (dispatch: AppDispatch) => {\n  return {\n    setColorText: (color: string) => dispatch(setColorText(color)),\n    inputColorText: (color: string) => dispatch(inputColorText(color)),\n  }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(ColorPicker);\n","import { RefObject, useEffect } from \"react\";\nimport { verify } from \"../../../../../utils/permisions\";\n\nexport function useEditColorText(\n  color: string | null,\n  colorPicker: RefObject<HTMLInputElement>,\n  setColorText: (color: string) => void,\n  inputColorText: (color: string) => void) {\n\n  useEffect(() => {\n\n    const inputColor = colorPicker.current;\n\n    verify(inputColor).value = color ? color : '#000000';\n\n    function handleInput(event: Event) {\n      const target = event.target as HTMLOptionElement;\n      inputColorText(target.value);\n    }\n  \n    function handleChange(event: Event) {\n      const target = event.target as HTMLOptionElement;\n      setColorText(target.value);\n    }\n    \n    function handleClick(event: Event) {\n      event.stopImmediatePropagation();\n    }\n\n\n    verify(inputColor).addEventListener(\"input\", handleInput);\n    verify(inputColor).addEventListener(\"change\", handleChange);\n    verify(inputColor).addEventListener(\"click\", handleClick);\n    return () => {\n      if (inputColor) {\n        inputColor.removeEventListener(\"input\", handleInput);\n        inputColor.removeEventListener(\"change\", handleChange);\n        inputColor.removeEventListener(\"click\", handleClick);\n      }\n    };\n  }, [color, colorPicker, setColorText, inputColorText]);\n}","import styles from './InputNumber.module.css';\nimport { connect } from 'react-redux';\nimport { useEditFontSize } from './useEditFontSize';\nimport { useRef } from 'react';\nimport { AppDispatch, RootState } from '../../../../../store/store';\nimport { inputSizeText, setSizeText } from '../../../../../store/actionCreators/textBlockActionCreators';\n\ntype InputNumberProps = {\n  size: number | null,\n  tempSize: number | null,\n  setSizeText: (size: number) => void,\n  inputSizeText: (size: number) => void,\n}\n\nfunction InputNumber(props: InputNumberProps) {\n  const inputNumber = useRef<HTMLInputElement>(null);\n  useEditFontSize(props.size, inputNumber, props.setSizeText, props.inputSizeText);\n  \n\n  return (\n    <input type=\"number\"\n      ref={inputNumber}\n      className={styles.input__number}\n      min={10}\n      max={150}\n      step={1}\n    />\n  )\n}\n\nfunction mapStateToProps(state: RootState) {\n  return {\n    size: state.viewModel.text.size,\n    tempSize: state.viewModel.text.tempSize,\n  }\n};\n\nconst mapDispatchToProps = (dispatch: AppDispatch) => {\n  return {\n    setSizeText: (size: number) => dispatch(setSizeText(size)),\n    inputSizeText: (size: number) => dispatch(inputSizeText(size))\n  }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(InputNumber);\n","import { RefObject, useEffect } from \"react\";\nimport { verify } from \"../../../../../utils/permisions\";\n\nexport function useEditFontSize(\n  size: number | null,\n  input: RefObject<HTMLInputElement>,\n  setSizeText: (size: number) => void,\n  inputSizeText: (size: number) => void) {\n\n  useEffect(() => {\n\n    const fieldSize = input.current;\n\n    verify(fieldSize).value = size ? String(size) : \"10\";\n\n    function handleInput(event: Event) {\n      const target = event.target as HTMLOptionElement;\n      inputSizeText(Number(target.value));\n    }\n  \n    function handleBlur(event: Event) {\n      const target = event.target as HTMLOptionElement;\n      setSizeText(Number(target.value));\n    }\n    \n    function handleClick(event: Event) {\n      event.stopImmediatePropagation();\n    }\n\n\n    verify(fieldSize).addEventListener(\"input\", handleInput);\n    verify(fieldSize).addEventListener(\"blur\", handleBlur);\n    verify(fieldSize).addEventListener(\"click\", handleClick);\n    return () => {\n      if (fieldSize) {\n        fieldSize.removeEventListener(\"input\", handleInput);\n        fieldSize.removeEventListener(\"blur\", handleBlur);\n        fieldSize.removeEventListener(\"click\", handleClick);\n      }\n    };\n  }, [size, input, setSizeText, inputSizeText]);\n}","import { connect } from 'react-redux';\nimport { AppDispatch, RootState } from '../../../../../store/store';\nimport styles from './SelectFontFamily.module.css';\nimport { useRef } from 'react';\nimport { useSelectFont } from './useSelectFont';\nimport { setFontFamilyText } from '../../../../../store/actionCreators/textBlockActionCreators';\n\ntype SelectFontFamilyProps = {\n  fontFamily: string | null\n  setFontFamilyText: (fontFamily: string) => void,\n}\n\nfunction SelectFontFamily(props: SelectFontFamilyProps) {\n  const select = useRef<HTMLSelectElement>(null);\n\n  useSelectFont(select, props.setFontFamilyText);\n\n  const listParameters = [\n    { value: 'Fantazyor', class: styles.fantazyor },\n    { value: 'Piroucyrillic', class: styles.piroucyrillic },\n    { value: 'Phenomena', class: styles.phenomena },\n    { value: 'Sunday', class: styles.sunday },\n    { value: 'Kurale', class: styles.kurale },\n    { value: 'Sensei', class: styles.sensei },\n    { value: 'Borsok', class: styles.borsok },\n    { value: 'Summer', class: styles.summer },\n    { value: 'Underdog', class: styles.underdog },\n    { value: 'Montserrat', class: styles.montserrat },\n    { value: 'OpenSans', class: styles.openSans },\n    { value: 'Comfortaa', class: styles.comfortaa },\n    { value: 'Rubik', class: styles.rubik },\n    { value: 'Marta', class: styles.marta },\n  ]\n\n  let fontFamilies: JSX.Element[] = listParameters.map((element, index) => {\n    return <option key={index} className={element.class} value={element.value}>{element.value}</option>\n  })\n\n  let currentStyle: string = fontFamilies[0].props.className;\n\n  fontFamilies = fontFamilies.map((element: JSX.Element) => {\n    if (element.props.value === props.fontFamily) {\n      currentStyle = element.props.className;\n      return {\n        ...element,\n        props: {\n          ...element.props,\n          selected: true\n        }\n      }\n    } else {\n      return element\n    }\n  });\n\n  return (\n    <select name=\"\" id=\"\" className={styles.select + ' ' + currentStyle} ref={select}>\n      {fontFamilies}\n    </select>\n  );\n}\n\nfunction mapStateToProps(state: RootState) {\n  let fontFamily: string | null = null;\n  if (state.viewModel.text?.fontFamily) {\n    fontFamily = state.viewModel.text.fontFamily;\n  }\n  return {\n    fontFamily: fontFamily\n  }\n};\n\nconst mapDispatchToProps = (dispatch: AppDispatch) => {\n  return {\n    setFontFamilyText: (fontFamily: string) => dispatch(setFontFamilyText(fontFamily)),\n  }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(SelectFontFamily);","import { RefObject, useEffect } from \"react\";\nimport { verify } from \"../../../../../utils/permisions\";\n\nexport function useSelectFont(\n  select: RefObject<HTMLSelectElement>,\n  setFontFamilyText: (fontFamily: string) => void) {\n\n  useEffect(() => {\n\n    const selectFontFamily = select.current;\n    \n    function handleClick(event: Event) {\n      event.stopImmediatePropagation();\n    }\n\n    function handleChange(event: Event) {\n      const target = event.target as HTMLOptionElement;\n      setFontFamilyText(target.value);\n    }\n\n    \n    verify(selectFontFamily).addEventListener(\"click\", handleClick);\n    verify(selectFontFamily).addEventListener(\"change\", handleChange);\n    return () => {\n      if (selectFontFamily) {\n        selectFontFamily.removeEventListener(\"click\", handleClick);\n        selectFontFamily.removeEventListener(\"change\", handleChange);\n      }\n    };\n  }, [select, setFontFamilyText]);\n}","import styles from './ToolbarText.module.css';\nimport { faBold, faItalic, faUnderline, faFont } from '@fortawesome/free-solid-svg-icons'\nimport { connect } from 'react-redux';\nimport { AppDispatch, RootState } from '../../../../store/store';\nimport { createTextBlock, setBoldText, setItalicText, setUnderlineText } from '../../../../store/actionCreators/textBlockActionCreators';\nimport ButtonEditText from './buttonEditText/ButtonEditText';\nimport ColorPicker from './colorPicker/ColorPicker';\nimport InputNumber from './inputNumber/InputNumber';\nimport SelectFontFamily from './selectFontFamily/SelectFontFamily';\n\n\ntype ToolbarTextProps = {\n  createTextBlock: () => void,\n  setBoldText: (isBold: boolean) => void,\n  setItalicText: (isItalic: boolean) => void,\n  setUnderlineText: (isUnderline: boolean) => void,\n  bold: boolean | null,\n  italic: boolean | null,\n  underline: boolean | null,\n}\n\nfunction ToolbarText(props: ToolbarTextProps) {\n  return (\n    <div className={styles.toolbar}>\n\n      <div className={styles.toolbar__row}>\n        <SelectFontFamily />\n        <ButtonEditText icon={faFont} enabled={null} modifyFn={props.createTextBlock} param={false} />\n      </div>\n\n      <div className={styles.toolbar__row}>\n        <InputNumber />\n\n        <ButtonEditText icon={faBold} enabled={props.bold} modifyFn={props.setBoldText}  param={true}/>\n        <ButtonEditText icon={faItalic} enabled={props.italic} modifyFn={props.setItalicText}  param={true}/>\n        <ButtonEditText icon={faUnderline} enabled={props.underline} modifyFn={props.setUnderlineText}  param={true}/>\n        <div className={styles.colorPickerBox}>\n          <ColorPicker />\n        </div>\n      </div>\n\n      <label className={styles.toolbar__label}>Текст</label>\n    </div>\n  );\n}\n\nfunction mapStateToProps(state: RootState) {\n  return {\n    bold: state.viewModel.text.bold,\n    italic: state.viewModel.text.italic,\n    underline: state.viewModel.text.underline,\n  }\n};\n\nconst mapDispatchToProps = (dispatch: AppDispatch) => {\n  return {\n    createTextBlock: () => dispatch(createTextBlock()),\n    setBoldText: (isBold: boolean) => dispatch(setBoldText(isBold)),\n    setItalicText: (isItalic: boolean) => dispatch(setItalicText(isItalic)),\n    setUnderlineText: (isUnderline: boolean) => dispatch(setUnderlineText(isUnderline)),\n  }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(ToolbarText);\n","import styles from './DropdownMenu.module.css';\nimport { IconDefinition, SizeProp } from '@fortawesome/fontawesome-svg-core';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { connect } from 'react-redux';\n\ntype DropdownMenuProps = {\n  minWidth: number,\n  label: string,\n  icon: IconDefinition,\n  sizeIcon: SizeProp,\n  children: React.ReactElement[],\n}\nfunction DropdownMenu(props: DropdownMenuProps) {\n  return (\n    <div className={styles.dropdown}>\n      <button className={styles.dropbtn}>\n        <FontAwesomeIcon icon={props.icon} size={props.sizeIcon} />\n        {props.label !== '' &&\n          <span className={styles.dropdown_text}>{props.label}</span>\n        }\n      </button>\n      <div className={styles.dropdown_content} style={{minWidth: props.minWidth}}>\n        {props.children}\n      </div>\n    </div>\n  );\n}\n\nexport default connect()(DropdownMenu);\n","import styles from './AddImgButton.module.css';\nimport { IconDefinition } from '@fortawesome/fontawesome-svg-core';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { ForwardedRef, forwardRef } from 'react';\nimport { connect } from 'react-redux';\n\ntype NavButtonProps = {\n  label: string,\n  title: string,\n  icon: IconDefinition,\n}\n\nconst AddImgButton = forwardRef((props: NavButtonProps, ref: ForwardedRef<HTMLButtonElement>) => (\n  <button\n    ref={ref}\n    className={styles.button}\n    title={props.title}>\n    <FontAwesomeIcon icon={props.icon} size=\"lg\" />\n    {props.label !== '' &&\n      <span className={styles.button__text}>{props.label}</span>\n    }\n  </button>\n));\n\nexport default connect(null, null, null, { forwardRef: true })(AddImgButton);","import styles from './AddImgButtonFile.module.css';\nimport { IconDefinition } from '@fortawesome/fontawesome-svg-core';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { ForwardedRef, forwardRef } from 'react';\nimport { connect } from 'react-redux';\n\ntype NavButtonProps = {\n  label: string,\n  title: string,\n  icon: IconDefinition,\n}\n\nconst AddImgButton = forwardRef((props: NavButtonProps, ref: ForwardedRef<HTMLInputElement>) => (\n  <button className={styles.button}>\n    <label htmlFor=\"input-file-img\" className={styles.icon}>\n      <FontAwesomeIcon icon={props.icon} size=\"lg\" />\n    </label>\n    <input\n      className={styles.inputFile}\n      type=\"file\"\n      ref={ref}\n      id=\"input-file-img\"\n    />\n    {props.label !== '' &&\n      <label className={styles.button__text}\n        htmlFor=\"input-file-img\">\n        {props.label}\n      </label>\n    }\n  </button>\n));\n\nexport default connect(null, null, null, { forwardRef: true })(AddImgButton);","import styles from './PreviewArtObj.module.css';\nimport { useCreateArtObj } from './useCreateArtObj';\nimport { useRef } from 'react';\nimport { connect } from 'react-redux';\nimport { AppDispatch } from '../../../../../store/store';\nimport { createArtObjBlock } from '../../../../../store/actionCreators/artObjBlockActionCreators';\n\ntype PreviewArtObjProps = {\n  src: string,\n  createArtObjBlock: (src: string) => void,\n}\n\nfunction PreviewArtObj(props: PreviewArtObjProps) {\n\n  const img = useRef<HTMLImageElement>(null);\n  useCreateArtObj(img, props.src, props.createArtObjBlock);\n  return (\n    <img src={props.src} alt='' ref={img} className={styles.sticker} />\n  );\n}\n\nconst mapDispatchToProps = (dispatch: AppDispatch) => {\n  return {\n    createArtObjBlock: (src: string) => dispatch(createArtObjBlock(src)),\n  }\n}\n\nexport default connect(null, mapDispatchToProps)(PreviewArtObj);","import { store } from \"../store\";\n\nexport function createArtObjBlock(src: string) {\n  return {\n    type: 'CREATE_ART_OBJ_BLOCK',\n    src: src,\n    x: (store.getState().canvas.width / 2) - 75,\n    y: (store.getState().canvas.height / 2) - 75,\n  }\n}\n","import { RefObject, useEffect } from \"react\";\nimport { verify } from \"../../../../../utils/permisions\";\n\nexport function useCreateArtObj(\n  artObj: RefObject<HTMLElement>,\n  src: string,\n  createArtObjBlock: (src: string) => void) {\n\n  useEffect(() => {\n\n    const artObjPreview = artObj.current;\n\n    function handleClickArtObj() {\n      createArtObjBlock(src);\n    }\n\n\n    verify(artObjPreview).addEventListener(\"click\", handleClickArtObj);\n    return () => {\n      if (artObjPreview) artObjPreview.removeEventListener(\"click\", handleClickArtObj);\n    };\n  }, [artObj, src, createArtObjBlock]);\n}","import styles from './ToolbarImg.module.css';\nimport { faDownload, faGlobe, faStickyNote } from '@fortawesome/free-solid-svg-icons'\nimport DropdownMenu from '../../../dropdownMenu/DropdownMenu';\nimport AddImgButton from './addImgButton/AddImgButton';\nimport AddImgButtonFile from './addImgButtonFile/AddImgButtonFile';\nimport PreviewArtObj from './previewArtObj/PreviewArtObj';\nimport { SetOfArtObject } from '../../../../store/types';\nimport { useCreateImg } from './useCreateImg';\nimport { ReactElement } from 'react';\nimport { useRef } from 'react';\nimport { connect } from 'react-redux';\nimport { AppDispatch } from '../../../../store/store';\nimport { createImgBlock } from '../../../../store/actionCreators/imgBlockActionCreators';\n\ntype ToolbarImgProps = {\n  createImgBlock: (src: string, width: number, height: number) => void,\n}\n\nfunction ToolbarImg(props: ToolbarImgProps) {\n\n  // формирование списка стикеров\n  let srcList: SetOfArtObject[] = Object.values(SetOfArtObject);\n  let imgList: ReactElement[] = [];\n  srcList.forEach((src, index) => {\n    imgList.push(<PreviewArtObj src={src} key={index} />);\n  });\n\n  const inputFile = useRef<HTMLInputElement>(null);\n\n  useCreateImg(inputFile, props.createImgBlock);\n  return (\n    <div className={styles.toolbar}>\n      <div className={styles.button_box}>\n        <AddImgButtonFile label=\"\" title=\"C компьютера\" icon={faDownload} ref={inputFile} />\n        <AddImgButton label=\"\" title=\"Из Pixels\" icon={faGlobe} />\n        <DropdownMenu minWidth={200} label=\"\" icon={faStickyNote} sizeIcon='lg'>\n          {imgList}\n        </DropdownMenu>\n      </div>\n      <label className={styles.toolbar__label}>Изображения</label>\n    </div>\n  );\n}\n\nconst mapDispatchToProps = (dispatch: AppDispatch) => {\n  return {\n    createImgBlock: (src: string, width: number, height: number) => dispatch(createImgBlock(src, width, height)),\n  }\n}\n\nexport default connect(null, mapDispatchToProps)(ToolbarImg);\n","import { store } from \"../store\"\nexport function createImgBlock(src: string, width: number, height: number) {\n  return {\n    type: 'CREATE_IMG_BLOCK',\n    src: src,\n    width: width,\n    height: height,\n    x: (store.getState().canvas.width / 2) - (width / 2),\n    y: (store.getState().canvas.height / 2) - (height / 2),\n  }\n}","import { RefObject, useEffect } from \"react\";\nimport { getImgInformationFromFile } from '../../../../utils/files';\nimport { verify } from \"../../../../utils/permisions\";\n\nexport function useCreateImg(\n  inputFile: RefObject<HTMLElement>,\n  createImgBlock: (src: string, width: number, height: number) => void) {\n\n  useEffect(() => {\n\n    const fieldFile = inputFile.current;\n\n    async function handlerChangeInput(event: Event): Promise<void> {\n      const target = event.target as HTMLInputElement;\n      const files = target.files as FileList;\n      const imgInfo = await getImgInformationFromFile(files[0]);\n      createImgBlock(imgInfo.src, imgInfo.width, imgInfo.height);\n      target.value = '';\n    }\n\n\n    verify(fieldFile).addEventListener(\"change\", handlerChangeInput);\n    return () => {\n      if (fieldFile) fieldFile.removeEventListener(\"change\", handlerChangeInput);\n    };\n  }, [inputFile, createImgBlock]);\n}","import styles from './ColorPicker.module.css';\nimport { ForwardedRef, forwardRef } from 'react';\nimport { connect } from 'react-redux';\n\nconst ColorPicker = forwardRef((props: {}, ref: ForwardedRef<HTMLInputElement>) => (\n  <input type=\"color\"\n    ref={ref}\n    className={styles.input__color}\n  />\n));\n\nexport default connect(null, null, null, { forwardRef: true })(ColorPicker);\n","import { store } from \"../store\"\n\nexport function setCanvasSize(width: number, height: number) {\n  return {\n    type: 'SET_CANVAS_SIZE',\n    width: width,\n    height: height,\n  }\n}\n\nexport function setFilter(color: string, opacity: number) {\n  return {\n    type: 'SET_FILTER',\n    color: color,\n    opacity: opacity,\n  }\n}\n\nexport function setBackgroundColor(color: string) {\n  return {\n    type: 'SET_BACKGROUND_COLOR',\n    color: color,\n  }\n}\n\nexport function setBackgroundImg(src: string) {\n  return {\n    type: 'SET_BACKGROUND_IMG',\n    src: src,\n  }\n}\n\nexport function resetBackground() {\n  return {\n    type: 'RESET_BACKGROUND',\n  }\n}\n\nexport function inputBackgroundColor(color: string) {\n  return {\n    type: 'INPUT_BACKGROUND_COLOR',\n    color: color,\n  }\n}\n\nexport function inputBackgroundImg(width: number, height: number, src: string) {\n  return {\n    type: 'INPUT_BACKGROUND_IMG',\n    width: width,\n    height: height,\n    src: src,\n  }\n}\n\nexport function inputCanvasSize(width: number, height: number) {\n  return {\n    type: 'INPUT_CANVAS_SIZE',\n    width: width,\n    height: height,\n  }\n}\n\nexport function inputFilter(color: string, opacity: number) {\n  return {\n    type: 'INPUT_FILTER',\n    color: color,\n    opacity: opacity,\n  }\n}\n\nexport function areaSelection(x: number, y: number, width: number, height: number) {\n  return {\n    type: 'AREA_SELECTION',\n    x: x,\n    y: y,\n    width: width,\n    height: height,\n  }\n}\n\nexport function resetAreaSelection() {\n  return {\n    type: 'RESET_AREA_SELECTION',\n  }\n}\n\nexport function setPositionAreaSelection(x: number, y: number) {\n  return {\n    type: 'SET_POSITION_AREA_SELECTION',\n    x: x,\n    y: y,\n  }\n}\n\nexport function deleteAreaSelection() {\n  return {\n    type: 'DELETE_AREA_SELECTION',\n    area: store.getState().viewModel.areaSelection,\n  }\n}\n","import styles from './ToolbarFilter.module.css';\r\nimport ColorPicker from '../colorPicker/ColorPicker';\r\nimport { RefObject, useRef } from 'react';\r\nimport { useStateFilter } from './useStateFilter';\r\nimport { AppDispatch, RootState } from '../../../../store/store';\r\nimport { inputFilter, setFilter } from '../../../../store/actionCreators/canvasActionCreators';\r\nimport { connect } from 'react-redux';\r\nimport { Filter as FilterType } from '../../../../store/types';\r\n\r\ntype ToolbarFilterProps = {\r\n  inputFilter: (color: string, opacity: number) => void,\r\n  setFilter: (color: string, opacity: number) => void,\r\n  filter: FilterType,\r\n}\r\n\r\nfunction ToolbarFilter(props: ToolbarFilterProps) {\r\n  const inputColor = useRef<HTMLInputElement>(null);\r\n  const inputRange = useRef<HTMLInputElement>(null);\r\n  useStateFilter(\r\n    inputColor,\r\n    inputRange,\r\n    props.inputFilter,\r\n    props.setFilter,\r\n    props.filter\r\n  );\r\n  return (\r\n    <div className={styles.toolbar}>\r\n      <div className={styles.colorPickerBox}>\r\n        <ColorPicker ref={inputColor as RefObject<HTMLInputElement>} />\r\n      </div>\r\n      <input type=\"range\" min=\"0\" max=\"0.2\" step=\"0.025\" className={styles.input_range}\r\n        ref={inputRange}\r\n      />\r\n      <label className={styles.toolbar__label}>Фильтр</label>\r\n    </div>\r\n  );\r\n}\r\n\r\nconst mapStateToProps = (state: RootState) => ({\r\n  filter: state.canvas.filter,\r\n})\r\n\r\nconst mapDispatchToProps = (dispatch: AppDispatch) => {\r\n  return {\r\n    inputFilter: (color: string, opacity: number) => dispatch(inputFilter(color, opacity)),\r\n    setFilter: (color: string, opacity: number) => dispatch(setFilter(color, opacity)),\r\n  }\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(ToolbarFilter);\r\n","import { Filter as FilterType } from '../../../../store/types';\nimport { RefObject, useEffect } from 'react';\nimport { verify } from '../../../../utils/permisions';\n\nexport function useStateFilter(\n  inputColor: RefObject<HTMLInputElement>,\n  inputRange: RefObject<HTMLInputElement>,\n  inputFilter: (color: string, opacity: number) => void,\n  setFilter: (color: string, opacity: number) => void,\n  filter: FilterType): void {\n\n  useEffect(() => {\n\n    const fieldColor = inputColor.current;\n    const fieldRange = inputRange.current;\n\n    verify(fieldColor).value = filter.color;\n    verify(fieldRange).value = String(filter.opacity);\n\n    function handleInputFilter(): void {\n      if (fieldRange && fieldColor) {\n        const color: string = fieldColor.value;\n        const opacity: number = Number(fieldRange.value);\n        inputFilter(color, opacity);\n      }\n    }\n\n    function handleChangeFilter(): void {\n      if (fieldRange && fieldColor) {\n        const opacity: number = Number(fieldRange.value);\n        const color: string = fieldColor.value;\n        setFilter(color, opacity);\n      }\n    }\n\n    verify(fieldColor).addEventListener(\"input\", handleInputFilter);\n    verify(fieldColor).addEventListener(\"change\", handleChangeFilter);\n    verify(fieldRange).addEventListener(\"input\", handleInputFilter);\n    verify(fieldRange).addEventListener(\"change\", handleChangeFilter);\n    return () => {\n      if (fieldColor) {\n        fieldColor.removeEventListener(\"input\", handleInputFilter);\n        fieldColor.removeEventListener(\"change\", handleChangeFilter);\n      }\n      if (fieldRange) {\n        fieldRange.removeEventListener(\"input\", handleInputFilter);\n        fieldRange.removeEventListener(\"change\", handleChangeFilter);\n      }\n    };\n  }, [inputColor, inputRange, inputFilter, setFilter, filter]);\n}","import styles from './FileImgButton.module.css';\nimport { IconDefinition } from '@fortawesome/fontawesome-svg-core';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { useRef, useState } from 'react';\nimport { connect } from 'react-redux';\nimport Modal from '../../../../modal/Modal';\nimport { useBackgroungImg } from '../useBackgroungImg';\nimport { AppDispatch, RootState } from '../../../../../store/store';\nimport {\n  inputBackgroundImg,\n  setBackgroundImg,\n  setCanvasSize\n} from '../../../../../store/actionCreators/canvasActionCreators';\nimport { ViewModelBgImg } from '../../../../../store/types';\n\ntype NavButtonProps = {\n  label: string,\n  title: string,\n  icon: IconDefinition,\n  inputBackgroundImg: (width: number, height: number, src: string) => void,\n  setBackgroundImg: (src: string) => void,\n  setCanvasSize: (width: number, height: number) => void,\n  bgImg: ViewModelBgImg | null,\n}\n\nfunction AddImgButton(props: NavButtonProps): any {\n\n  const inputFile = useRef<HTMLInputElement>(null);\n\n  let [isModal, setModal] = useState(false);\n  const onClose = () => setModal(false);\n\n  useBackgroungImg(inputFile, props.setBackgroundImg, props.inputBackgroundImg, setModal);\n\n  const bg = props.bgImg ?? {\n    width: 0,\n    height: 0,\n    src: '',\n  }\n\n  const onAcceptStretch = () => {\n    props.setBackgroundImg(bg.src);\n    props.setCanvasSize(bg.width, bg.height);\n    onClose();\n  }\n  const onAcceptCrop = () => {\n    props.setBackgroundImg(bg.src);\n    onClose();\n  }\n\n  const content =\n    <>\n      <p>Исходное изображение больше размера холста</p>\n    </>\n\n  const footer =\n    <>\n      <button onClick={onAcceptStretch}>Растянуть холст</button>\n      <button onClick={onAcceptCrop}>Обрезать изображение</button>\n      <button onClick={onClose}>Отмена</button>\n    </>\n\n  return (\n    <>\n      <Modal\n        visible={isModal}\n        title=\"Выберите действие\"\n        content={content}\n        footer={footer}\n        onClose={onClose}\n      />\n      <button className={styles.button} title={props.title}>\n        <label htmlFor=\"input-file-bg-img\" className={styles.icon}>\n          <FontAwesomeIcon icon={props.icon} />\n        </label>\n        <input\n          className={styles.inputFile}\n          type=\"file\"\n          id=\"input-file-bg-img\"\n          ref={inputFile}\n        />\n        {props.label !== '' &&\n          <label className={styles.button__text}\n            htmlFor=\"input-file-bg-img\">\n            {props.label}\n          </label>\n        }\n      </button>\n    </>\n  );\n};\n\nconst mapStateToProps = (state: RootState) => ({\n  bgImg: state.viewModel.bgImg,\n})\n\nconst mapDispatchToProps = (dispatch: AppDispatch) => {\n  return {\n    inputBackgroundImg: (width: number, height: number, src: string) => dispatch(inputBackgroundImg(width, height, src)),\n    setBackgroundImg: (src: string) => dispatch(setBackgroundImg(src)),\n    setCanvasSize: (width: number, height: number) => dispatch(setCanvasSize(width, height)),\n  }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(AddImgButton);","import { RefObject, useEffect } from \"react\";\r\nimport { getImgInformationFromFile } from '../../../../utils/files';\r\nimport { verify } from \"../../../../utils/permisions\";\r\nimport { store } from \"../../../../store/store\";\r\nimport { Size } from \"../../../../store/types\";\r\n\r\nexport function useBackgroungImg(\r\n  inputFile: RefObject<HTMLElement>,\r\n  setBackgroundImg: (src: string) => void,\r\n  inputBackgroundImg: (width: number, height: number, src: string) => void,\r\n  setModal: (state: boolean) => void\r\n) {\r\n\r\n  useEffect(() => {\r\n\r\n    const canvasSize: Size = {\r\n      width: store.getState().canvas.width,\r\n      height: store.getState().canvas.height,\r\n    };\r\n\r\n    const fieldFile = inputFile.current;\r\n    async function handlerChange(event: Event): Promise<void> {\r\n      const target = event.target as HTMLInputElement;\r\n      const files = target.files as FileList;\r\n      const imgInfo = await getImgInformationFromFile(files[0]);\r\n\r\n      if ((canvasSize.width < imgInfo.width) || (canvasSize.height < imgInfo.height)) {\r\n        inputBackgroundImg(imgInfo.width, imgInfo.height, imgInfo.src)\r\n        setModal(true);\r\n      } else {\r\n        setBackgroundImg(imgInfo.src);\r\n      }\r\n\r\n      target.value = '';\r\n    }\r\n\r\n\r\n    verify(fieldFile).addEventListener(\"change\", handlerChange);\r\n    return () => {\r\n      if (fieldFile) fieldFile.removeEventListener(\"change\", handlerChange);\r\n    };\r\n  }, [inputFile, setBackgroundImg, inputBackgroundImg, setModal]);\r\n}","import styles from './Button.module.css';\nimport { IconDefinition } from '@fortawesome/fontawesome-svg-core';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { ForwardedRef, forwardRef } from 'react';\nimport { connect } from 'react-redux';\n\ntype ButtonProps = {\n  label: string,\n  title: string,\n  icon: IconDefinition,\n}\n\nconst Button = forwardRef((props: ButtonProps, ref: ForwardedRef<HTMLButtonElement>) => (\n  <button\n    className={styles.button}\n    ref={ref}\n    title={props.title}\n    style={{ textAlign: props.label === '' ? 'center' : 'left' }}\n  >\n    <FontAwesomeIcon icon={props.icon} />\n    {props.label !== '' &&\n      <span className={styles.button_text}>{props.label}</span>\n    }\n  </button>\n));\n\nexport default connect(null, null, null, { forwardRef: true })(Button);","import styles from './ToolbarBackground.module.css';\r\nimport { faDownload, faGlobe, faRetweet } from '@fortawesome/free-solid-svg-icons'\r\nimport ColorPicker from '../colorPicker/ColorPicker';\r\nimport FileImgButton from './FileImgButton/FileImgButton';\r\nimport Button from '../button/Button';\r\nimport { RefObject, useRef } from 'react';\r\nimport { useBackgroungColor } from './useBackgroungColor';\r\nimport { AppDispatch, RootState } from '../../../../store/store';\r\nimport { inputBackgroundColor, resetBackground, setBackgroundColor } from '../../../../store/actionCreators/canvasActionCreators';\r\nimport { connect } from 'react-redux';\r\nimport { Background as BackgroundType } from '../../../../store/types';\r\n\r\ntype ToolbarBackgroundProps = {\r\n  resetBackground: () => void,\r\n  inputBackgroundColor: (color: string) => void,\r\n  setBackgroundColor: (color: string) => void,\r\n  background: BackgroundType,\r\n}\r\n\r\nfunction ToolbarBackground(props: ToolbarBackgroundProps) {\r\n\r\n  const inputColor = useRef<HTMLInputElement>(null);\r\n  const buttonReset = useRef<HTMLButtonElement>(null);\r\n\r\n  useBackgroungColor(\r\n    props.resetBackground,\r\n    props.inputBackgroundColor,\r\n    props.setBackgroundColor,\r\n    props.background,\r\n    inputColor,\r\n    buttonReset\r\n  );\r\n\r\n  return (\r\n    <div className={styles.toolbar}>\r\n      <div className={styles.toolbar__row}>\r\n        <div className={styles.toolbar__col1}>\r\n          <div className={styles.button_container}>\r\n            <FileImgButton\r\n              label=\"C компьютера\"\r\n              title=\"C компьютера\"\r\n              icon={faDownload}\r\n            />\r\n            <Button\r\n              label=\"Из Pixels\"\r\n              title=\"Из Pixels\"\r\n              icon={faGlobe}\r\n            />\r\n          </div>\r\n        </div>\r\n        <div className={styles.toolbar__col2}>\r\n          <div className={styles.colorPickerBox}>\r\n            <ColorPicker ref={inputColor as RefObject<HTMLInputElement>} />\r\n          </div>\r\n          <Button\r\n            label=\"Сброс\"\r\n            title=\"Сброс\"\r\n            icon={faRetweet}\r\n            ref={buttonReset as RefObject<HTMLButtonElement>}\r\n          />\r\n        </div>\r\n      </div>\r\n      <label className={styles.toolbar__label}>Фон</label>\r\n    </div>\r\n  );\r\n}\r\n\r\nconst mapStateToProps = (state: RootState) => ({\r\n  background: state.canvas.background,\r\n})\r\n\r\n\r\nconst mapDispatchToProps = (dispatch: AppDispatch) => {\r\n  return {\r\n    resetBackground: () => dispatch(resetBackground()),\r\n    inputBackgroundColor: (color: string) => dispatch(inputBackgroundColor(color)),\r\n    setBackgroundColor: (color: string) => dispatch(setBackgroundColor(color)),\r\n  }\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(ToolbarBackground);\r\n","import { useEffect, RefObject } from 'react';\r\nimport { Background as BackgroundType } from '../../../../store/types';\r\nimport { verify } from '../../../../utils/permisions';\r\n\r\nexport function useBackgroungColor(\r\n  resetBackground: () => void,\r\n  inputBackgroundColor: (color: string) => void,\r\n  setBackgroundColor: (color: string) => void,\r\n  background: BackgroundType,\r\n  inputColor: RefObject<HTMLInputElement>,\r\n  buttonReset: RefObject<HTMLButtonElement>): void {\r\n\r\n  useEffect(() => {\r\n\r\n    const input = inputColor.current;\r\n    const button = buttonReset.current;\r\n\r\n    function handlerClickResetColor(): void {\r\n      resetBackground();\r\n    }\r\n  \r\n    function handlerInputColor(event: Event): void {\r\n      const inputColor = event.target as HTMLInputElement;\r\n      inputBackgroundColor(inputColor.value);\r\n    }\r\n  \r\n    function handleerChangeColor(event: Event): void {\r\n      const inputColor = event.target as HTMLInputElement;\r\n      const color: string = inputColor.value;\r\n      setBackgroundColor(color);\r\n    }\r\n\r\n\r\n    verify(input).addEventListener(\"input\", handlerInputColor);\r\n    verify(input).addEventListener(\"change\", handleerChangeColor);\r\n    verify(button).addEventListener(\"click\", handlerClickResetColor);\r\n    return () => {\r\n      if (input) {\r\n        input.removeEventListener(\"input\", handlerInputColor);\r\n        input.removeEventListener(\"change\", handleerChangeColor);\r\n      }\r\n      if (button) button.removeEventListener(\"click\", handlerClickResetColor);\r\n\r\n    };\r\n  }, [resetBackground, inputBackgroundColor, setBackgroundColor, background, inputColor, buttonReset]);\r\n\r\n  // изменение цвета input на белый при сбросе фона\r\n  useEffect(() => {\r\n    const input = inputColor.current;\r\n    verify(input).value = background.color ? background.color : '#ffffff';\r\n  }, [inputColor, background]);\r\n\r\n\r\n}","import styles from './ToolbarArea.module.css';\nimport { faEraser } from '@fortawesome/free-solid-svg-icons'\nimport Button from '../button/Button';\nimport { connect } from 'react-redux';\nimport { AppDispatch } from '../../../../store/store';\nimport { deleteAreaSelection, resetAreaSelection } from '../../../../store/actionCreators/canvasActionCreators';\nimport { useDeleteArea } from './useDeleteArea';\nimport { useRef } from 'react';\n\ntype ToolbarAreaProps = {\n  deleteAreaSelection: () => void,\n  resetAreaSelection: () => void,\n}\n\nfunction ToolbarArea(props: ToolbarAreaProps) {\n\n  let buttonDelete = useRef<HTMLButtonElement>(null); \n\n  useDeleteArea(buttonDelete, props.deleteAreaSelection, props.resetAreaSelection);\n\n  return (\n    <div className={styles.toolbar}>\n      {/* <Button\n        label=\"Выделение\"\n        title=\"Выделение\"\n        icon={faVectorSquare}\n      /> */}\n      <Button\n        ref={buttonDelete}\n        label=\"Удаление\"\n        title=\"Удаление\"\n        icon={faEraser}\n      />\n\n      {/* <button onClick={() => {\n        props.deleteAreaSelection();\n        props.resetAreaSelection();\n      }}>УДАЛИТЬ</button> */}\n      <label className={styles.toolbar__label}>Область</label>\n    </div>\n  );\n}\n\nconst mapDispatchToProps = (dispatch: AppDispatch) => {\n  return {\n    deleteAreaSelection: () => dispatch(deleteAreaSelection()),\n    resetAreaSelection: () => dispatch(resetAreaSelection()),\n  }\n}\n\nexport default connect(null, mapDispatchToProps)(ToolbarArea);\n","import { RefObject, useEffect } from \"react\"\nimport { verify } from \"../../../../utils/permisions\";\n\nexport function useDeleteArea(\n  buttonDelete: RefObject<HTMLButtonElement>,\n  deleteAreaSelection: () => void,\n  resetAreaSelection: () => void) {\n\n    useEffect(() => {\n\n      const button = buttonDelete.current;\n\n      function handleClickButton() {\n        deleteAreaSelection();\n        resetAreaSelection();\n      }\n      function handleMousedownButton(event: MouseEvent) {\n        event.preventDefault();\n      }\n  \n  \n      verify(button).addEventListener(\"click\", handleClickButton);\n      verify(button).addEventListener(\"mousedown\", handleMousedownButton);\n      return () => {\n        if (button) button.removeEventListener(\"click\", handleClickButton);\n        if (button) button.removeEventListener(\"mousedown\", handleMousedownButton);\n      };\n    }, [buttonDelete, deleteAreaSelection, resetAreaSelection]);\n  }","import { store } from '../store';\n\nexport function setSelectedBlock(id: string) {\n  return {\n    type: 'SET_SELECTED_BLOCK',\n    id: id,\n  }\n}\n\nexport function resetSelectedBlock() {\n  return {\n    type: 'RESET_SELECTED_BLOCK',\n  }\n}\n\nexport function setSizeBlock(width: number, height: number) {\n  return {\n    type: 'SET_SIZE_BLOCK',\n    id: store.getState().selectBlock,\n    width: width,\n    height: height,\n  }\n}\n\nexport function deleteBlock() {\n  return {\n    type: 'DELETE_BLOCK',\n    id: store.getState().selectBlock,\n  }\n}\n\nexport function setPositionBlock(x: number, y: number) {\n  return {\n    type: 'SET_POSITION_BLOCK',\n    id: store.getState().selectBlock,\n    x: x,\n    y: y,\n  }\n}\n\nexport function shiftUpBlock() {\n  return {\n    type: 'SHIFT_UP_BLOCK',\n    id: store.getState().selectBlock,\n  }\n}\n\nexport function shiftDownBlock() {\n  return {\n    type: 'SHIFT_DOWN_BLOCK',\n    id: store.getState().selectBlock,\n  }\n}\n\nexport function clickOnText() {\n  return {\n    type: 'CLICK_ON_TEXT',\n    id: store.getState().selectBlock,\n  }\n}\n\nexport function blurOnText() {\n  return {\n    type: 'BLUR_ON_TEXT',\n  }\n}\n","import styles from './ToolbarObject.module.css';\nimport { faArrowUp, faArrowDown, faTrash } from '@fortawesome/free-solid-svg-icons'\nimport Button from '../button/Button';\nimport { useBlockLevel } from './useBlockLevel';\nimport { useBlockDelete } from './useBlockDelete';\nimport { RefObject, useRef } from 'react';\nimport { connect } from 'react-redux';\nimport { AppDispatch } from '../../../../store/store';\nimport { deleteBlock, shiftDownBlock, shiftUpBlock } from '../../../../store/actionCreators/blockActionCreators';\n\ntype ToolbarObjectProps = {\n  shiftUpBlock: () => void,\n  shiftDownBlock: () => void,\n  deleteBlock: () => void,\n}\n\nfunction ToolbarObject(props: ToolbarObjectProps) {\n  const buttonUp = useRef<HTMLButtonElement>(null);\n  const buttonDown = useRef<HTMLButtonElement>(null);\n  const buttonDelete = useRef<HTMLButtonElement>(null);\n  useBlockLevel(buttonUp, buttonDown, props.shiftUpBlock, props.shiftDownBlock);\n  useBlockDelete(buttonDelete, props.deleteBlock);\n  return (\n    <div className={styles.toolbar}>\n      <div className={styles.toolbar__row}>\n        <div>\n          <div className={styles.button_container}>\n            <Button\n              ref={buttonUp as RefObject<HTMLButtonElement>}\n              label=\"\"\n              title=\"Переместить вперед\"\n              icon={faArrowUp}\n            />\n            <Button\n              ref={buttonDown as RefObject<HTMLButtonElement>}\n              label=\"\"\n              title=\"Переместить назад\"\n              icon={faArrowDown}\n            />\n          </div>\n        </div>\n        <div className={styles.toolbar__col}>\n          <Button\n            ref={buttonDelete as RefObject<HTMLButtonElement>}\n            label=\"Удалить\"\n            title=\"Удалить\"\n            icon={faTrash}\n          />\n        </div>\n      </div>\n      <label className={styles.toolbar__label}>Объекты</label>\n    </div>\n  );\n}\n\nconst mapDispatchToProps = (dispatch: AppDispatch) => {\n  return {\n    shiftUpBlock: () => dispatch(shiftUpBlock()),\n    shiftDownBlock: () => dispatch(shiftDownBlock()),\n    deleteBlock: () => dispatch(deleteBlock()),\n  }\n}\n\nexport default connect(null, mapDispatchToProps)(ToolbarObject);\n","import { RefObject, useEffect } from 'react';\nimport { verify } from '../../../../utils/permisions';\n\nexport function useBlockLevel(\n  buttonUp: RefObject<HTMLButtonElement>,\n  buttonDown: RefObject<HTMLButtonElement>,\n  shiftUpBlock: () => void,\n  shiftDownBlock: () => void): void {\n\n  useEffect(() => {\n\n    const btnUp = buttonUp.current;\n    const btnDown = buttonDown.current;\n\n    function handlerClickShiftUp(event: Event): void {\n      event.preventDefault();\n      shiftUpBlock();\n    }\n  \n    function handlerClickShiftDown(event: Event): void {\n      event.preventDefault();\n      shiftDownBlock();\n    }\n\n\n    verify(btnUp).addEventListener(\"click\", handlerClickShiftUp);\n    verify(btnDown).addEventListener(\"click\", handlerClickShiftDown);\n    return () => {\n      if (btnUp) btnUp.removeEventListener(\"click\", handlerClickShiftUp);\n      if (btnDown) btnDown.removeEventListener(\"click\", handlerClickShiftDown);\n    };\n  }, [buttonUp, buttonDown, shiftUpBlock, shiftDownBlock]);\n}\n\n\n","import { RefObject, useEffect } from 'react';\r\nimport { verify } from '../../../../utils/permisions';\r\n\r\nexport function useBlockDelete(buttonDelete: RefObject<HTMLButtonElement>, deleteBlock: () => void): void {\r\n\r\n  useEffect(() => {\r\n\r\n    const button = buttonDelete.current;\r\n\r\n    function handlerClickDelete(): void {\r\n      deleteBlock();\r\n    }\r\n\r\n    function handlerKeydown(event: KeyboardEvent): void {\r\n      if (event.code === 'Delete') {\r\n        deleteBlock();\r\n      }\r\n    }\r\n\r\n    \r\n    verify(button).addEventListener(\"click\", handlerClickDelete);\r\n    document.addEventListener(\"keydown\", handlerKeydown);\r\n    return () => {\r\n      if (button) button.removeEventListener(\"click\", handlerClickDelete);\r\n      document.removeEventListener(\"keydown\", handlerKeydown);\r\n    };\r\n  }, [buttonDelete, deleteBlock]);\r\n}\r\n\r\n\r\n","import styles from './ToolbarCanvas.module.css';\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\r\nimport { faTimes } from '@fortawesome/free-solid-svg-icons'\r\nimport { useRef } from 'react';\r\nimport { useStateCanvasSize } from './useStateCanvasSize';\r\nimport { connect } from 'react-redux';\r\nimport { inputCanvasSize, setCanvasSize } from '../../../../store/actionCreators/canvasActionCreators';\r\nimport { AppDispatch, RootState } from '../../../../store/store';\r\n\r\ntype ToolbarCanvasProps = {\r\n  inputCanvasSize: (width: number, height: number) => void,\r\n  setCanvasSize: (width: number, height: number) => void,\r\n  width: number,\r\n  height: number,\r\n}\r\n\r\nfunction ToolbarCanvas(props: ToolbarCanvasProps) {\r\n\r\n  const inputWidth = useRef<HTMLInputElement>(null);\r\n  const inputHeight = useRef<HTMLInputElement>(null);\r\n  useStateCanvasSize(\r\n    inputWidth,\r\n    inputHeight,\r\n    props.inputCanvasSize,\r\n    props.setCanvasSize,\r\n    props.width,\r\n    props.height,\r\n  );\r\n\r\n  return (\r\n    <div className={styles.toolbar}>\r\n      <div className={styles.toolbar__row}>\r\n        <input type=\"number\" className={styles.input_number} min=\"0\"\r\n          ref={inputWidth}\r\n        />\r\n        <FontAwesomeIcon icon={faTimes} className={styles.label} />\r\n        <input type=\"number\" className={styles.input_number} min=\"0\"\r\n          ref={inputHeight}\r\n        />\r\n      </div>\r\n\r\n      <label className={styles.toolbar__label}>Холст</label>\r\n    </div>\r\n  );\r\n}\r\n\r\nconst mapStateToProps = (state: RootState) => ({\r\n  width: state.canvas.width,\r\n  height: state.canvas.height,\r\n})\r\n\r\nconst mapDispatchToProps = (dispatch: AppDispatch) => {\r\n  return {\r\n    inputCanvasSize: (width: number, height: number) => dispatch(inputCanvasSize(width, height)),\r\n    setCanvasSize: (width: number, height: number) => dispatch(setCanvasSize(width, height)),\r\n  }\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(ToolbarCanvas);\r\n","import { RefObject, useEffect } from 'react';\nimport { verify } from '../../../../utils/permisions';\n\nexport function useStateCanvasSize(\n  inputWidth: RefObject<HTMLInputElement>,\n  inputHeight: RefObject<HTMLInputElement>,\n  inputCanvasSize: (width: number, height: number) => void,\n  setCanvasSize: (width: number, height: number) => void,\n  width: number,\n  height: number\n  ): void {\n\n  useEffect(() => {\n    const fieldWidth = inputWidth.current;\n    const fieldHeight = inputHeight.current;\n\n    verify(fieldWidth).value = String(width);\n    verify(fieldHeight).value = String(height);\n\n    function handleChangeSize(): void {\n      if (fieldWidth && fieldHeight) {\n        const width: number = Number(fieldWidth.value);\n        const height: number = Number(fieldHeight.value);\n        inputCanvasSize(width, height);\n      }\n    }\n\n    function handleBlurSize(): void {\n      if (fieldWidth && fieldHeight) {\n        const width: number = Number(fieldWidth.value);\n        const height: number = Number(fieldHeight.value);\n        setCanvasSize(width, height);\n      }\n    }\n\n\n    verify(fieldWidth).addEventListener(\"change\", handleChangeSize);\n    verify(fieldWidth).addEventListener(\"blur\", handleBlurSize);\n    verify(fieldHeight).addEventListener(\"change\", handleChangeSize);\n    verify(fieldHeight).addEventListener(\"blur\", handleBlurSize);\n    return () => {\n      if (fieldWidth) {\n        fieldWidth.removeEventListener(\"change\", handleChangeSize);\n        fieldWidth.removeEventListener(\"blur\", handleBlurSize);\n      }\n      if (fieldHeight) {\n        fieldHeight.removeEventListener(\"change\", handleChangeSize);\n        fieldHeight.removeEventListener(\"blur\", handleBlurSize);\n      }\n    };\n  }, [inputWidth, inputHeight, inputCanvasSize, setCanvasSize, width, height]);\n}","import styles from './Toolbar.module.css';\nimport ToolbarText from './toolbarText/ToolbarText';\nimport ToolbarImg from './toolbarImg/ToolbarImg';\nimport ToolbarFilter from './toolbarFilter/ToolbarFilter';\nimport ToolbarBackground from './toolbarBackground/ToolbarBackground';\nimport ToolbarArea from './toolbarArea/ToolbarArea';\nimport ToolbarObject from './toolbarObject/ToolbarObject';\nimport ToolbarCanvas from './toolbarCanvas/ToolbarCanvas';\nimport { connect } from 'react-redux';\n\nfunction Toolbar() {\n  return (\n    <div className={styles.toolbar}>\n      <ToolbarText />\n      <ToolbarImg />\n      <ToolbarBackground />\n      <ToolbarArea />\n      <ToolbarFilter />\n      <ToolbarObject />\n      <ToolbarCanvas />\n    </div>\n  );\n}\n\nexport default connect()(Toolbar);\n","import { connect } from 'react-redux';\nimport styles from './Header.module.css';\nimport Navbar from './navbar/Navbar';\nimport Toolbar from './toolbar/Toolbar';\n\nfunction Header() {\n\n  return (\n    <header className={styles.header}>\n      <div className={styles.panel}>\n        <Navbar />\n        <Toolbar />\n      </div>\n    </header >\n  );\n}\n\nexport default connect()(Header);\n","import { useEffect, RefObject } from 'react';\nimport { store } from '../../store/store';\nimport { verify } from '../../utils/permisions';\n\nexport function useStateBlock(\n  blockId: string,\n  block: RefObject<HTMLElement>,\n  setSelectedBlock: (id: string) => void,\n  resetSelectedBlock: () => void,\n): void {\n\n  useEffect(() => {\n\n    const currentBlock = block.current;\n\n    function handleMousedownBlock(): void {\n      if (store.getState().selectBlock !== blockId) {\n        setTimeout(() => {\n          setSelectedBlock(blockId);\n        });\n      }\n    }\n\n    function handleClickDocument(event: Event): void {\n      const isDefPrev: boolean = event.defaultPrevented;\n      const isSelectedID: boolean = store.getState().selectBlock === blockId;\n      if (!isDefPrev && isSelectedID && (event.target !== currentBlock)) {\n        resetSelectedBlock();\n      }\n    }\n\n\n    document.addEventListener(\"click\", handleClickDocument);\n    verify(currentBlock).addEventListener(\"mousedown\", handleMousedownBlock);\n    return () => {\n      if (currentBlock) currentBlock.removeEventListener(\"mousedown\", handleMousedownBlock);\n      document.removeEventListener(\"click\", handleClickDocument);\n    };\n  }, [blockId, block, setSelectedBlock, resetSelectedBlock]);\n}","import { useEffect, RefObject } from 'react';\r\nimport { Position } from '../../store/types';\r\nimport { verify } from '../../utils/permisions';\r\n\r\nexport function useDragAndDrop(\r\n  block: RefObject<HTMLElement>,\r\n  defPos: Position,\r\n  setPositionBlock: (x: number, y: number) => void\r\n): void {\r\n\r\n\r\n  useEffect(() => {\r\n\r\n    const currentBlock = block.current;\r\n\r\n    let startPos: Position;\r\n\r\n    function handleMousedown(event: MouseEvent): void {\r\n      // event.preventDefault();\r\n      startPos = {\r\n        x: event.pageX,\r\n        y: event.pageY,\r\n      };\r\n      document.addEventListener(\"mousemove\", handleMouseMove);\r\n      document.addEventListener(\"mouseup\", handleMouseUp);\r\n    }\r\n  \r\n    let newPos: Position;\r\n\r\n    function handleMouseMove(event: MouseEvent): void {\r\n      if (!event.defaultPrevented) {\r\n        event.preventDefault();\r\n        const delta = {\r\n          x: event.pageX - startPos.x,\r\n          y: event.pageY - startPos.y\r\n        }\r\n        newPos = {\r\n          x: defPos.x + delta.x,\r\n          y: defPos.y + delta.y\r\n        }\r\n        verify(currentBlock).style.left = String(newPos.x) + 'px';\r\n        verify(currentBlock).style.top = String(newPos.y) + 'px';\r\n      }\r\n    }\r\n  \r\n    function handleMouseUp(): void {\r\n      if (newPos) {\r\n        setPositionBlock(newPos.x, newPos.y);\r\n      }\r\n      document.removeEventListener(\"mousemove\", handleMouseMove);\r\n      document.removeEventListener(\"mouseup\", handleMouseUp);\r\n    }\r\n  \r\n\r\n    verify(currentBlock).addEventListener(\"mousedown\", handleMousedown);\r\n    return () => {\r\n      if (currentBlock) currentBlock.removeEventListener(\"mousedown\", handleMousedown);\r\n    };\r\n  }, [block, defPos, setPositionBlock]);\r\n}","import { useEffect, RefObject } from 'react';\nimport { Position, Size } from '../../store/types';\nimport { verify } from '../../utils/permisions';\n\nexport function useResize(\n  setSizeBlock: (width: number, height: number) => void,\n  setPositionBlock: (x: number, y: number) => void,\n  LT: RefObject<HTMLElement>,\n  RT: RefObject<HTMLElement>,\n  LB: RefObject<HTMLElement>,\n  RB: RefObject<HTMLElement>,\n  block: RefObject<HTMLElement>,\n  defPos: Position,\n  defSize: Size\n): void {\n\n\n  useEffect(() => {\n\n    const currentBlock = block.current;\n    const pointLT = LT;\n    const pointRT = RT;\n    const pointLB = LB;\n    const pointRB = RB;\n\n    let startPos: Position;\n    let point: string;\n\n    function handleMousedown(event: MouseEvent): void {\n      event.preventDefault();\n      switch (event.target) {\n        case pointLT.current:\n          point = 'LT';\n          break;\n        case pointRT.current:\n          point = 'RT';\n          break;\n        case pointLB.current:\n          point = 'LB';\n          break;\n        case pointRB.current:\n          point = 'RB';\n          break;\n      }\n\n      startPos = {\n        x: event.pageX + (5 - event.offsetX),\n        y: event.pageY + (5 - event.offsetY)\n      };\n\n      document.addEventListener(\"mousemove\", handleMouseMove);\n      document.addEventListener(\"mouseup\", handleMouseUp);\n    }\n\n    let newWidth: number = defSize.width;\n    let newHeight: number = defSize.height;\n    let prevWidth: number = defSize.width;\n    let prevHeight: number = defSize.height;\n    let newPos: Position;\n\n    function handleMouseMove(event: MouseEvent): void {\n      event.preventDefault();\n      const delta = {\n        x: event.pageX - startPos.x,\n        y: event.pageY - startPos.y,\n      }\n\n      // перемещение при изменении размеров\n      let moving: Position = { x: 0, y: 0 };\n      switch (point) {\n        case 'LT':\n          [newWidth, newHeight] = calculateSize({ x: -delta.x, y: -delta.y }, prevWidth, prevHeight);\n          moving = { x: defSize.width - newWidth, y: defSize.height - newHeight };\n          break;\n        case 'RT':\n          [newWidth, newHeight] = calculateSize({ x: delta.x, y: -delta.y }, prevWidth, prevHeight);\n          moving = { x: 0, y: defSize.height - newHeight };\n          break;\n        case 'LB':\n          [newWidth, newHeight] = calculateSize({ x: -delta.x, y: delta.y }, prevWidth, prevHeight);\n          moving = { x: defSize.width - newWidth, y: 0 };\n          break;\n        case 'RB':\n          [newWidth, newHeight] = calculateSize(delta, prevWidth, prevHeight);\n          break;\n      }\n\n      verify(currentBlock).style.width = String(newWidth) + 'px';\n      verify(currentBlock).style.height = String(newHeight) + 'px';\n\n      newPos = {\n        x: defPos.x + moving.x,\n        y: defPos.y + moving.y\n      }\n\n      verify(currentBlock).style.left = String(newPos.x) + 'px';\n      verify(currentBlock).style.top = String(newPos.y) + 'px';\n\n      prevWidth = newWidth;\n      prevHeight = newHeight;\n    }\n\n    function calculateSize(delta: Position, prevWidth: number, prevHeight: number) {\n      if ((delta.x / prevWidth) < (delta.y / prevHeight)) {\n        newHeight = defSize.height + delta.y;\n        newHeight = newHeight < 20 ? 20 : newHeight;\n        newWidth = (prevWidth * newHeight) / prevHeight;\n      } else {\n        newWidth = defSize.width + delta.x;\n        newWidth = newWidth < 20 ? 20 : newWidth;\n        newHeight = (prevHeight * newWidth) / prevWidth;\n      }\n      return [newWidth, newHeight];\n    }\n\n    function handleMouseUp(): void {\n      setSizeBlock(newWidth, newHeight);\n      if (newPos) {\n        setPositionBlock(newPos.x, newPos.y);\n      }\n      document.removeEventListener(\"mousemove\", handleMouseMove);\n      document.removeEventListener(\"mouseup\", handleMouseUp);\n    }\n\n    \n    verify(pointLT.current).addEventListener(\"mousedown\", handleMousedown);\n    verify(pointRT.current).addEventListener(\"mousedown\", handleMousedown);\n    verify(pointLB.current).addEventListener(\"mousedown\", handleMousedown);\n    verify(pointRB.current).addEventListener(\"mousedown\", handleMousedown);\n    return () => {\n      if (pointLT.current) pointLT.current.removeEventListener(\"mousedown\", handleMousedown);\n      if (pointRT.current) pointRT.current.removeEventListener(\"mousedown\", handleMousedown);\n      if (pointLB.current) pointLB.current.removeEventListener(\"mousedown\", handleMousedown);\n      if (pointRB.current) pointRB.current.removeEventListener(\"mousedown\", handleMousedown);\n    };\n  }, [setSizeBlock, setPositionBlock, LT, RT, LB, RB, block, defPos, defSize]);\n}","import styles from './Img.module.css';\r\nimport { Img as ImgType } from '../../../store/types';\r\nimport { useRef } from 'react';\r\nimport { useStateBlock } from '../useStateBlock';\r\nimport { useDragAndDrop } from '../useDragAndDrop';\r\nimport { useResize } from '../useResize';\r\nimport { connect } from 'react-redux';\r\nimport { resetSelectedBlock, setPositionBlock, setSelectedBlock, setSizeBlock } from '../../../store/actionCreators/blockActionCreators';\r\nimport { AppDispatch, RootState } from '../../../store/store';\r\n\r\ntype ImgProps = {\r\n  img: ImgType,\r\n  selectBlock: string | null,\r\n  setSizeBlock: (width: number, height: number) => void,\r\n  setPositionBlock: (x: number, y: number) => void,\r\n  setSelectedBlock: (id: string) => void,\r\n  resetSelectedBlock: () => void,\r\n}\r\n\r\nfunction Img(props: ImgProps) {\r\n  const img: ImgType = props.img;\r\n  let src: string = '';\r\n  if (img.src) {\r\n    src = img.src;\r\n  }\r\n  const imgStyle = getStyle(img);\r\n  const imgBlock = useRef<HTMLImageElement>(null);\r\n\r\n\r\n  const pointLT = useRef<HTMLDivElement>(null);\r\n  const pointRT = useRef<HTMLDivElement>(null);\r\n  const pointLB = useRef<HTMLDivElement>(null);\r\n  const pointRB = useRef<HTMLDivElement>(null);\r\n\r\n  useStateBlock(props.img.id, imgBlock, props.setSelectedBlock, props.resetSelectedBlock);\r\n  useDragAndDrop(imgBlock, { x: img.x, y: img.y }, props.setPositionBlock);\r\n  useResize(\r\n    props.setSizeBlock,\r\n    props.setPositionBlock,\r\n    pointLT,\r\n    pointRT,\r\n    pointLB,\r\n    pointRB,\r\n    imgBlock,\r\n    { x: img.x, y: img.y },\r\n    { width: img.width, height: img.height }\r\n  );\r\n\r\n  const select: string = props.img.id === props.selectBlock ? styles.selected : '';\r\n\r\n  return (\r\n    <div\r\n      className={styles.block + ' ' + select}\r\n      style={imgStyle}\r\n      ref={imgBlock}\r\n      onDragStart={(e) => e.preventDefault() }\r\n    >\r\n      <div className={styles.pointTopLeft} ref={pointLT}></div>\r\n      <div className={styles.pointTopRight} ref={pointRT}></div>\r\n      <img src={src}\r\n        alt=''\r\n        className={styles.img}\r\n      />\r\n      <div className={styles.pointBottomLeft} ref={pointLB}></div>\r\n      <div className={styles.pointBottomRight} ref={pointRB}></div>\r\n    </div>\r\n  );\r\n}\r\n\r\nconst mapStateToProps = (state: RootState) => ({\r\n  selectBlock: state.selectBlock,\r\n})\r\n\r\nconst mapDispatchToProps = (dispatch: AppDispatch) => {\r\n  return {\r\n    setPositionBlock: (x: number, y: number) => dispatch(setPositionBlock(x, y)),\r\n    setSizeBlock: (width: number, height: number) => dispatch(setSizeBlock(width, height)),\r\n    setSelectedBlock: (id: string) => dispatch(setSelectedBlock(id)),\r\n    resetSelectedBlock: () => dispatch(resetSelectedBlock()),\r\n  }\r\n}\r\n\r\nfunction getStyle(img: ImgType) {\r\n  return {\r\n    width: img.width,\r\n    height: img.height,\r\n    left: img.x,\r\n    top: img.y,\r\n  };\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(Img);\r\n","import styles from './Text.module.css';\r\nimport { Text as TextType } from '../../../store/types';\r\nimport { useRef } from 'react';\r\nimport { useStateBlock } from '../useStateBlock';\r\nimport { useDragAndDrop } from '../useDragAndDrop';\r\nimport { connect } from 'react-redux';\r\nimport { clickOnText, deleteBlock, resetSelectedBlock, setPositionBlock, setSelectedBlock } from '../../../store/actionCreators/blockActionCreators';\r\nimport { AppDispatch, RootState } from '../../../store/store';\r\nimport { useEditText } from './useEditText';\r\nimport { setBoldText, setItalicText, setTextInTextBlock, setUnderlineText } from '../../../store/actionCreators/textBlockActionCreators';\r\n\r\ntype TextProps = {\r\n  text: TextType,\r\n  color: string | null,\r\n  size: number | null,\r\n  selectBlock: string | null,\r\n  setPositionBlock: (x: number, y: number) => void,\r\n  setSelectedBlock: (id: string) => void,\r\n  resetSelectedBlock: () => void,\r\n  setTextInTextBlock: (text: string) => void,\r\n  clickOnText: () => void,\r\n  deleteBlock: () => void,\r\n  setBoldText: (isBold: boolean) => void,\r\n  setItalicText: (isItalic: boolean) => void,\r\n  setUnderlineText: (isUnderline: boolean) => void,\r\n}\r\n\r\nfunction Text(props: TextProps) {\r\n  const text: TextType = props.text;\r\n\r\n  const textBlock = useRef<HTMLDivElement>(null);\r\n  useStateBlock(props.text.id, textBlock, props.setSelectedBlock, props.resetSelectedBlock);\r\n  useDragAndDrop(textBlock, { x: text.x, y: text.y }, props.setPositionBlock);\r\n\r\n  useEditText(\r\n    textBlock,\r\n    text.bold,\r\n    text.italic,\r\n    text.underline,\r\n    props.setTextInTextBlock,\r\n    props.clickOnText,\r\n    props.deleteBlock,\r\n    props.setBoldText,\r\n    props.setItalicText,\r\n    props.setUnderlineText,\r\n  );\r\n\r\n  const select: string = props.text.id === props.selectBlock ? styles.selected : '';\r\n  let textStyle = getStyle(text);\r\n  textStyle = {\r\n    ...textStyle,\r\n    color: props.color && select !== '' ? props.color : textStyle.color,\r\n    fontSize: props.size && select !== '' ? props.size : textStyle.fontSize,\r\n  }\r\n\r\n  return (\r\n    <div style={textStyle}\r\n      contentEditable={false}\r\n      suppressContentEditableWarning={true}\r\n      onDragStart={(e) => e.preventDefault()}\r\n      ref={textBlock}\r\n      className={styles.block + ' ' + select}\r\n      dangerouslySetInnerHTML={{ __html: text.text }}\r\n    >\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction getStyle(text: TextType) {\r\n  return {\r\n    left: text.x,\r\n    top: text.y,\r\n    color: text.color,\r\n    fontSize: text.size,\r\n    fontWeight: text.bold ? 700 : 400,\r\n    textDecoration: text.underline ? 'underline' : 'none',\r\n    fontStyle: text.italic ? 'italic' : 'normal',\r\n    fontFamily: text.fontFamily,\r\n  };\r\n}\r\n\r\nconst mapStateToProps = (state: RootState) => ({\r\n  selectBlock: state.selectBlock,\r\n  color: state.viewModel.text.tempColor,\r\n  size: state.viewModel.text.tempSize,\r\n})\r\n\r\nconst mapDispatchToProps = (dispatch: AppDispatch) => {\r\n  return {\r\n    setPositionBlock: (x: number, y: number) => dispatch(setPositionBlock(x, y)),\r\n    setSelectedBlock: (id: string) => dispatch(setSelectedBlock(id)),\r\n    resetSelectedBlock: () => dispatch(resetSelectedBlock()),\r\n    setTextInTextBlock: (text: string) => dispatch(setTextInTextBlock(text)),\r\n    clickOnText: () => dispatch(clickOnText()),\r\n    deleteBlock: () => dispatch(deleteBlock()),\r\n    setBoldText: (isBold: boolean) => dispatch(setBoldText(isBold)),\r\n    setItalicText: (isItalic: boolean) => dispatch(setItalicText(isItalic)),\r\n    setUnderlineText: (isUnderline: boolean) => dispatch(setUnderlineText(isUnderline)),\r\n  }\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(Text);\r\n","import { RefObject, useEffect } from \"react\";\nimport { verify } from \"../../../utils/permisions\";\n\nexport function useEditText(\n  block: RefObject<HTMLDivElement>,\n  bold: boolean,\n  italic: boolean,\n  underline: boolean,\n  setTextIncurrentBlock: (text: string) => void,\n  clickOnText: () => void,\n  deleteBlock: () => void,\n  setBoldText: (isBold: boolean) => void,\n  setItalicText: (isItalic: boolean) => void,\n  setUnderlineText: (isUnderline: boolean) => void,\n) {\n\n  useEffect(() => {\n\n    const currentBlock = block.current;\n\n    function handleClickBlock() {\n      setTimeout(() => {\n        clickOnText();\n      });\n    }\n\n    function handleDblclickBlock() {\n      verify(currentBlock).setAttribute(\"contenteditable\", \"true\")\n      verify(currentBlock).focus();\n    }\n\n    function handleBlur() {\n      if (currentBlock) {\n        currentBlock.setAttribute(\"contenteditable\", \"false\")\n        const content: string = currentBlock.innerHTML;\n        console.log(content)\n        if (content === '<div><br></div>') {\n          deleteBlock();\n        } else {\n          setTextIncurrentBlock(currentBlock.innerHTML);\n        }\n      }\n    }\n\n    function handleMouseMove(event: Event) {\n      if (verify(currentBlock).getAttribute('contenteditable') === 'true') {\n        event.stopImmediatePropagation();\n      }\n    }\n\n    function handlerKeydown(event: KeyboardEvent): void {\n      if (event.code === 'Escape') {\n        if (verify(currentBlock).getAttribute('contenteditable') === 'true') {\n          verify(currentBlock).setAttribute(\"contenteditable\", \"false\")\n          setTextIncurrentBlock(verify(currentBlock).innerHTML)\n        }\n      }\n      if (event.code === 'Delete') {\n        event.stopImmediatePropagation();\n      }\n      if (event.code === 'KeyB' && (event.ctrlKey || event.metaKey)) {\n        setBoldText(!bold)\n      }\n      if (event.code === 'KeyI' && (event.ctrlKey || event.metaKey)) {\n        setItalicText(!italic)\n      }\n      if (event.code === 'KeyU' && (event.ctrlKey || event.metaKey)) {\n        setUnderlineText(!underline)\n      }\n    }\n\n    function handlerPaste(event: any) {\n      event.preventDefault();\n      const text = event.clipboardData.getData(\"text/plain\");\n      document.execCommand(\"insertHTML\", false, text);\n    }\n\n    function handlerInput(event: Event) {\n      if (currentBlock) {\n        if (currentBlock.innerHTML[0] !== '<' || currentBlock.innerHTML === '<br>') {\n          currentBlock.innerHTML = `<div>${currentBlock.innerText}<br></div>`;\n          currentBlock.focus();\n        }\n      }\n    }\n\n\n    verify(currentBlock).addEventListener(\"mousedown\", handleClickBlock);\n    verify(currentBlock).addEventListener(\"dblclick\", handleDblclickBlock);\n    verify(currentBlock).addEventListener(\"blur\", handleBlur);\n    document.addEventListener(\"mousemove\", handleMouseMove);\n    verify(currentBlock).addEventListener(\"keydown\", handlerKeydown);\n    verify(currentBlock).addEventListener(\"paste\", handlerPaste);\n    verify(currentBlock).addEventListener(\"input\", handlerInput);\n    return () => {\n      if (currentBlock) {\n        currentBlock.removeEventListener(\"mousedown\", handleClickBlock);\n        currentBlock.removeEventListener(\"dblclick\", handleDblclickBlock);\n        currentBlock.addEventListener(\"blur\", handleBlur);\n        currentBlock.removeEventListener(\"keydown\", handlerKeydown);\n        currentBlock.removeEventListener(\"paste\", handlerPaste);\n        currentBlock.removeEventListener(\"input\", handlerInput);\n      }\n      document.removeEventListener(\"mousemove\", handleMouseMove);\n    };\n  }, [\n    block, bold, italic, underline, setTextIncurrentBlock, clickOnText,\n    deleteBlock, setBoldText, setItalicText, setUnderlineText\n  ]);\n}","import styles from './ArtObj.module.css';\r\nimport { ArtObj as ArtObjType } from '../../../store/types';\r\nimport { useRef } from 'react';\r\nimport { useStateBlock } from '../useStateBlock';\r\nimport { useDragAndDrop } from '../useDragAndDrop';\r\nimport { useResize } from '../useResize';\r\nimport { resetSelectedBlock, setPositionBlock, setSelectedBlock, setSizeBlock } from '../../../store/actionCreators/blockActionCreators';\r\nimport { connect } from 'react-redux';\r\nimport { AppDispatch, RootState } from '../../../store/store';\r\n\r\ntype ArtObjProps = {\r\n  artObj: ArtObjType,\r\n  selectBlock: string | null,\r\n  setSizeBlock: (width: number, height: number) => void,\r\n  setPositionBlock: (x: number, y: number) => void,\r\n  setSelectedBlock: (id: string) => void,\r\n  resetSelectedBlock: () => void,\r\n}\r\n\r\nfunction ArtObj(props: ArtObjProps) {\r\n  const artObj: ArtObjType = props.artObj;\r\n  const artObjBlock = useRef<HTMLDivElement>(null);\r\n  const artObjStyle = getStyle(artObj);\r\n\r\n  const pointLT = useRef<HTMLDivElement>(null);\r\n  const pointRT = useRef<HTMLDivElement>(null);\r\n  const pointLB = useRef<HTMLDivElement>(null);\r\n  const pointRB = useRef<HTMLDivElement>(null);\r\n\r\n  useStateBlock(props.artObj.id, artObjBlock, props.setSelectedBlock, props.resetSelectedBlock);\r\n  useDragAndDrop(artObjBlock, { x: artObj.x, y: artObj.y }, props.setPositionBlock);\r\n  useResize(\r\n    props.setSizeBlock,\r\n    props.setPositionBlock,\r\n    pointLT,\r\n    pointRT,\r\n    pointLB,\r\n    pointRB,\r\n    artObjBlock,\r\n    { x: artObj.x, y: artObj.y },\r\n    { width: artObj.width, height: artObj.height }\r\n  );\r\n  \r\n  const select: string = props.artObj.id === props.selectBlock ? styles.selected : '';\r\n\r\n  return (\r\n    <div\r\n      className={styles.block + ' ' + select}\r\n      style={artObjStyle}\r\n      ref={artObjBlock}\r\n      onDragStart={(e) => e.preventDefault() }\r\n    >\r\n      <div className={styles.pointTopLeft} ref={pointLT}></div>\r\n      <div className={styles.pointTopRight} ref={pointRT}></div>\r\n      <img src={artObj.src}\r\n        alt=''\r\n        className={styles.img}\r\n      />\r\n      <div className={styles.pointBottomLeft} ref={pointLB}></div>\r\n      <div className={styles.pointBottomRight} ref={pointRB}></div>\r\n    </div>\r\n  );\r\n}\r\n\r\nconst mapStateToProps = (state: RootState) => ({\r\n  selectBlock: state.selectBlock,\r\n})\r\n\r\nconst mapDispatchToProps = (dispatch: AppDispatch) => {\r\n  return {\r\n    setPositionBlock: (x: number, y: number) => dispatch(setPositionBlock(x, y)),\r\n    setSizeBlock: (width: number, height: number) => dispatch(setSizeBlock(width, height)),\r\n    setSelectedBlock: (id: string) => dispatch(setSelectedBlock(id)),\r\n    resetSelectedBlock: () => dispatch(resetSelectedBlock()),\r\n  }\r\n}\r\n\r\nfunction getStyle(artObj: ArtObjType) {\r\n  return {\r\n    width: artObj.width,\r\n    height: artObj.height,\r\n    left: artObj.x,\r\n    top: artObj.y,\r\n  };\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(ArtObj);\r\n","import styles from './Filter.module.css';\nimport { Canvas as CanvasType, Filter as FilterType } from '../../../store/types';\nimport { connect } from 'react-redux';\nimport { RootState } from '../../../store/store';\n\ntype FilterProps = {\n  canvas: CanvasType\n  filter: FilterType | null,\n}\n\nfunction Filter(props: FilterProps) {\n  const canvas: CanvasType = props.canvas;\n\n  let color: string = '';\n  let opacity: number = 0;\n  if (props.filter) {\n    color = props.filter.color;\n    opacity = props.filter.opacity;\n  } else {\n    color = canvas.filter.color;\n    opacity = canvas.filter.opacity;\n  }\n\n  const filterStyle = {\n    background: color,\n    opacity: opacity,\n  };\n\n  return (\n    <div className={styles.filter} style={filterStyle} id=\"filter\"></div>\n  );\n}\n\nfunction mapStateToProps(state: RootState) {\n  return {\n    canvas: state.canvas,\n    filter: state.viewModel.filter,\n  }\n};\n\nexport default connect(mapStateToProps)(Filter);","import styles from './DeleteArea.module.css';\nimport { ReactElement } from 'react';\nimport { Area, Canvas as CanvasType } from '../../../store/types';\nimport { connect } from 'react-redux';\nimport { RootState } from '../../../store/store';\n\ntype DeleteAreaProps = { canvas: CanvasType }\n\nfunction DeleteArea(props: DeleteAreaProps) {\n  const canvas: CanvasType = props.canvas;\n\n  let listBlock: ReactElement[] = [];\n  canvas.deleteArea.forEach((block: Area, index: number) => {\n    const DeleteAreaStyle = {\n      width: block.width as number,\n      height: block.height as number,\n      left: block.x as number,\n      top: block.y as number,\n    };\n\n    listBlock.push(\n    <div className={styles.deleteArea}\n      key={index}\n      style={DeleteAreaStyle}>\n    </div>);\n  });\n\n  return (\n    <>\n      {listBlock}\n    </>\n  );\n}\n\nfunction mapStateToProps(state: RootState) {\n  return {\n    canvas: state.canvas,\n  }\n};\n\nexport default connect(mapStateToProps)(DeleteArea);\n\n\n\n","import styles from './AreaSelection.module.css';\nimport { Area } from '../../../store/types';\nimport { connect } from 'react-redux';\nimport { AppDispatch } from '../../../store/store';\nimport { useDragAndDrop } from '../useDragAndDrop';\nimport { areaSelection, resetAreaSelection, setPositionAreaSelection } from '../../../store/actionCreators/canvasActionCreators';\nimport { ForwardedRef, forwardRef, RefObject } from 'react';\n\ntype AreaSelectionProps = {\n  area: Area,\n  areaSelection: (x: number, y: number, width: number, height: number) => void,\n  resetAreaSelection: () => void,\n  setPositionAreaSelection: (x: number, y: number) => void,\n}\n\n  const AreaSelection = forwardRef((props: AreaSelectionProps, ref: ForwardedRef<HTMLDivElement>) => {\n\n  let areaSelectionStyle = {};\n\n\n  areaSelectionStyle = {\n    left: props.area.x,\n    top: props.area.y,\n    width: props.area.width - 2,\n    height: props.area.height - 2,\n  }\n  useDragAndDrop(ref as RefObject<HTMLElement>, { x: props.area.x, y: props.area.y }, props.setPositionAreaSelection);\n\n  return (\n    <div className={styles.areaSelection} style={areaSelectionStyle} ref={ref}></div>\n  );\n});\n\nconst mapDispatchToProps = (dispatch: AppDispatch) => {\n  return {\n    areaSelection: (x: number, y: number, width: number, height: number) => dispatch(areaSelection(x, y, width, height)),\n    resetAreaSelection: () => dispatch(resetAreaSelection()),\n    setPositionAreaSelection: (x: number, y: number) => dispatch(setPositionAreaSelection(x, y)),\n  }\n}\n\nexport default connect(null, mapDispatchToProps, null, { forwardRef: true })(AreaSelection);\n\n\n\n","import styles from './Canvas.module.css';\r\nimport { ReactElement, useRef } from 'react';\r\nimport Img from './img/Img'\r\nimport Text from './text/Text'\r\nimport ArtObj from './artObj/ArtObj'\r\nimport Filter from './filter/Filter'\r\nimport DeleteArea from './deleteArea/DeleteArea'\r\nimport { Area, Block as BlockType, Canvas as CanvasType, Size } from '../../store/types';\r\nimport { connect } from 'react-redux';\r\nimport { AppDispatch, RootState } from '../../store/store';\r\nimport { BlockTypes } from '../../store/types';\r\nimport AreaSelection from './areaSelection/AreaSelection';\r\nimport { areaSelection, resetAreaSelection } from '../../store/actionCreators/canvasActionCreators';\r\nimport { useAreaSelection } from './useAreaSelection';\r\n\r\ntype CanvasProps = {\r\n  canvas: CanvasType,\r\n  area: Area | null,\r\n  bgColor: string | null,\r\n  canvasSize: Size | null,\r\n  areaSelection: (x: number, y: number, width: number, height: number) => void,\r\n  resetAreaSelection: () => void,\r\n}\r\n\r\nfunction Canvas(props: CanvasProps) {\r\n  const canvasStyle = getStyle(props.canvas, props.bgColor, props.canvasSize);\r\n  const listBlock: ReactElement[] = getListBlock(props.canvas.listBlock);\r\n\r\n  const canvas = useRef<HTMLDivElement>(null);\r\n  const area = useRef<HTMLDivElement>(null);\r\n  useAreaSelection(canvas, area, props.areaSelection, props.resetAreaSelection);\r\n\r\n  return (\r\n    <div id=\"canvas\" className={styles.canvas} style={canvasStyle} ref={canvas}>\r\n      {props.area &&\r\n        <AreaSelection area={props.area} ref={area}/>\r\n      }\r\n      {props.canvas.deleteArea &&\r\n        <DeleteArea />\r\n      }\r\n      <Filter />\r\n      {listBlock}\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction mapStateToProps(state: RootState) {\r\n  return {\r\n    canvas: state.canvas,\r\n    area: state.viewModel.areaSelection,\r\n    bgColor: state.viewModel.bgColor,\r\n    canvasSize: state.viewModel.canvasSize,\r\n  }\r\n};\r\n\r\nconst mapDispatchToProps = (dispatch: AppDispatch) => {\r\n  return {\r\n    areaSelection: (x: number, y: number, width: number, height: number) => dispatch(areaSelection(x, y, width, height)),\r\n    resetAreaSelection: () => dispatch(resetAreaSelection()),\r\n  }\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(Canvas);\r\n\r\n\r\nfunction getListBlock(listBlock: BlockType[]): ReactElement[] {\r\n  let newListBlock: ReactElement[] = [];\r\n  listBlock.forEach((block: BlockType) => {\r\n    switch (block.type) {\r\n      case BlockTypes.text:\r\n        newListBlock.push(<Text text={block}\r\n          key={block.id} />);\r\n        break;\r\n      case BlockTypes.img:\r\n        newListBlock.push(<Img img={block}\r\n          key={block.id} />);\r\n        break;\r\n      case BlockTypes.artObj:\r\n        newListBlock.push(<ArtObj artObj={block}\r\n          key={block.id} />);\r\n        break;\r\n    }\r\n  });\r\n  return newListBlock;\r\n}\r\n\r\nfunction getStyle(canvas: CanvasType, bgColor: string | null, canvasSize: Size | null) {\r\n  let background: string = '#fff';\r\n\r\n  if (bgColor) {\r\n    background = bgColor;\r\n  } else {\r\n    if (canvas.background.color) {\r\n      background = canvas.background.color;\r\n    } else if (canvas.background.src) {\r\n      background = 'url(' + canvas.background.src + ')';\r\n    }\r\n  }\r\n\r\n  let width: number = 0;\r\n  let height: number = 0;\r\n  if (canvasSize) {\r\n    width = canvasSize.width;\r\n    height = canvasSize.height;\r\n  } else {\r\n    width = canvas.width;\r\n    height = canvas.height;\r\n  }\r\n\r\n  return {\r\n    width: width,\r\n    height: height,\r\n    background: background,\r\n  };\r\n}","import { useEffect, RefObject } from 'react';\nimport { Position } from '../../store/types';\nimport { verify } from '../../utils/permisions';\n\nexport function useAreaSelection(\n  canvas: RefObject<HTMLDivElement>,\n  area: RefObject<HTMLDivElement>,\n  areaSelection: (x: number, y: number, width: number, height: number) => void,\n  resetAreaSelection: () => void): void {\n\n  useEffect(() => {\n\n    const field = canvas.current;\n    const selectArea = area.current;\n\n    let startPos: Position;\n    let startOffsetPos: Position;\n\n    const div: HTMLDivElement = document.createElement(\"div\");\n    div.style.position = 'absolute';\n    div.style.zIndex = '1';\n    div.style.pointerEvents = 'none';\n\n    function handleMousedown(event: MouseEvent): void {\n      \n      if (!event.defaultPrevented && event.target === field) {\n        startPos = {\n          x: event.pageX,\n          y: event.pageY,\n        };\n\n        startOffsetPos = {\n          x: event.offsetX,\n          y: event.offsetY,\n        };\n\n        document.addEventListener(\"mousemove\", handleMouseMove);\n        document.addEventListener(\"mouseup\", handleMouseUp);\n\n        div.style.border = '1px dashed red';\n        div.style.width = '0px';\n        div.style.height = '0px';\n\n        div.style.left = event.offsetX + 'px';\n        div.style.top = event.offsetY + 'px';\n        if (field) field.appendChild(div);\n      }\n    }\n\n\n    function handleMouseMove(event: MouseEvent): void {\n\n      if (!event.defaultPrevented) {\n\n        const delta = {\n          x: Math.abs(event.pageX - startPos.x),\n          y: Math.abs(event.pageY - startPos.y)\n        }\n\n        let moving: Position = { x: 0, y: 0 };\n\n        if (startPos.x >= event.pageX && startPos.y >= event.pageY) { // левый верхний\n          moving = { x: -delta.x, y: -delta.y };\n        } else if (startPos.x <= event.pageX && startPos.y >= event.pageY) { // правый верхний\n          moving = { x: 0, y: -delta.y };\n        } else if (startPos.x >= event.pageX && startPos.y <= event.pageY) { // левый нижний\n          moving = { x: -delta.x, y: 0 };\n        }\n\n        div.style.width = delta.x + 'px';\n        div.style.height = delta.y + 'px';\n\n        div.style.left = startOffsetPos.x + moving.x + 'px';\n        div.style.top = startOffsetPos.y + moving.y + 'px';\n      }\n    }\n\n    function handleMouseUp(): void {\n\n      if (div.offsetWidth > 2 && div.offsetHeight > 2) {\n        areaSelection(div.offsetLeft, div.offsetTop, div.offsetWidth, div.offsetHeight);\n      }\n      div.remove();\n\n      document.removeEventListener(\"mousemove\", handleMouseMove);\n      document.removeEventListener(\"mouseup\", handleMouseUp);\n\n    }\n\n    function handleMousedownDocument(event: Event): void {\n      if (!event.defaultPrevented && area.current) {\n        event.preventDefault();\n        if (area.current !== event.target) {\n          resetAreaSelection();\n        }\n      }\n    }\n\n    function handleMousedownArea(event: MouseEvent) {\n      event.preventDefault();\n    }\n\n    \n    verify(field).addEventListener(\"mousedown\", handleMousedown);\n    if (selectArea) selectArea.addEventListener(\"mousedown\", handleMousedownArea);\n    document.addEventListener(\"mousedown\", handleMousedownDocument);\n    return () => {\n      if (field) field.removeEventListener(\"mousedown\", handleMousedown);\n      if (selectArea) selectArea.removeEventListener(\"mousedown\", handleMousedownArea);\n      document.removeEventListener(\"mousedown\", handleMousedownDocument);\n    };\n  }, [canvas, area, areaSelection, resetAreaSelection]);\n}","import styles from './CardMaker.module.css';\r\nimport Header from './header/Header';\r\nimport Canvas from './canvas/Canvas';\r\nimport { connect } from 'react-redux';\r\n\r\nfunction CardMaker() {\r\n  return (\r\n    <>\r\n      <Header />\r\n      <main className={styles.main}>\r\n        <Canvas />\r\n      </main>\r\n    </>\r\n  );\r\n}\r\n\r\nexport default connect()(CardMaker);\r\n","import './index.css';\r\nimport React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport CardMaker from './cardMaker/CardMaker';\r\nimport { store } from './store/store';\r\nimport { Provider } from 'react-redux';\r\n\r\nstore.subscribe(() => {\r\n  // console.log(store.getState());\r\n});\r\n\r\nReactDOM.render(\r\n\r\n  <React.StrictMode>\r\n    <Provider store={store}>\r\n      <CardMaker />\r\n    </Provider>\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n"],"sourceRoot":""}