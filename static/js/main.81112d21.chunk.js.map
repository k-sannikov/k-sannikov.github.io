{"version":3,"sources":["cardMaker/header/toolbar/toolbarText/selectFontFamily/SelectFontFamily.module.css","cardMaker/modal/Modal.module.css","cardMaker/header/toolbar/toolbarBackground/ToolbarBackground.module.css","cardMaker/canvas/img/Img.module.css","cardMaker/canvas/artObj/ArtObj.module.css","cardMaker/header/toolbar/toolbarCanvas/ToolbarCanvas.module.css","cardMaker/header/toolbar/toolbarText/ToolbarText.module.css","cardMaker/header/toolbar/toolbarObject/ToolbarObject.module.css","cardMaker/header/navbar/navButton/NavFileButton/NavFileButton.module.css","cardMaker/dropdownMenu/DropdownMenu.module.css","cardMaker/header/toolbar/toolbarImg/addImgButtonFile/AddImgButtonFile.module.css","cardMaker/header/toolbar/toolbarFilter/ToolbarFilter.module.css","cardMaker/header/toolbar/toolbarBackground/FileImgButton/FileImgButton.module.css","cardMaker/header/toolbar/toolbarImg/ToolbarImg.module.css","cardMaker/header/Header.module.css","cardMaker/header/navbar/navButton/NavButton/NavButton.module.css","cardMaker/header/toolbar/toolbarText/buttonEditText/ButtonEditText.module.css","cardMaker/header/toolbar/toolbarImg/addImgButton/AddImgButton.module.css","cardMaker/header/toolbar/button/Button.module.css","cardMaker/header/toolbar/toolbarArea/ToolbarArea.module.css","cardMaker/canvas/text/Text.module.css","cardMaker/CardMaker.module.css","cardMaker/header/navbar/Navbar.module.css","cardMaker/header/toolbar/Toolbar.module.css","cardMaker/header/toolbar/toolbarText/colorPicker/ColorPicker.module.css","cardMaker/header/toolbar/toolbarText/inputNumber/InputNumber.module.css","cardMaker/header/toolbar/toolbarImg/previewArtObj/PreviewArtObj.module.css","cardMaker/header/toolbar/colorPicker/ColorPicker.module.css","cardMaker/canvas/Canvas.module.css","cardMaker/canvas/filter/Filter.module.css","cardMaker/canvas/deleteArea/DeleteArea.module.css","cardMaker/canvas/areaSelection/AreaSelection.module.css","cardMaker/header/navbar/navButton/NavButton/NavButton.tsx","cardMaker/header/navbar/navButton/NavFileButton/NavFileButton.tsx","utils/files.ts","utils/elementList.ts","utils/permisions.ts","store/reducers/BackgroundReducer.ts","store/reducers/FilterReducer.ts","store/reducers/HeightCanvasReducer.ts","store/types.ts","utils/guid.ts","store/reducers/ListBlockReducer.ts","store/reducers/WidthCanvasReducer.ts","store/reducers/CanvasReducer.ts","store/reducers/SelectBlockReducer.ts","store/reducers/HistoryReducer.ts","store/reducers/ViewModelReducer.ts","store/initialState.ts","store/store.ts","store/reducers/CardMakerReducer.ts","store/actionCreators/historyActionCreators.ts","cardMaker/modal/Modal.tsx","cardMaker/header/navbar/navButton/NewProjectButton/NewProjectButton.tsx","store/actionCreators/cardMakerActionCreators.ts","utils/exportImg.ts","cardMaker/header/navbar/navButton/ExportImgButton/ExportImgButton.tsx","cardMaker/header/navbar/Navbar.tsx","cardMaker/header/navbar/useStateHistory.ts","cardMaker/header/navbar/useExportFileProject.ts","cardMaker/header/navbar/useImportFileProject.ts","store/actionCreators/textBlockActionCreators.ts","cardMaker/header/toolbar/toolbarText/buttonEditText/ButtonEditText.tsx","cardMaker/header/toolbar/toolbarText/buttonEditText/useEditStateText.ts","cardMaker/header/toolbar/toolbarText/colorPicker/ColorPicker.tsx","cardMaker/header/toolbar/toolbarText/colorPicker/useEditColorText.ts","cardMaker/header/toolbar/toolbarText/inputNumber/InputNumber.tsx","cardMaker/header/toolbar/toolbarText/inputNumber/useEditFontSize.ts","cardMaker/header/toolbar/toolbarText/selectFontFamily/SelectFontFamily.tsx","cardMaker/header/toolbar/toolbarText/selectFontFamily/useSelectFont.ts","cardMaker/header/toolbar/toolbarText/ToolbarText.tsx","cardMaker/dropdownMenu/DropdownMenu.tsx","cardMaker/header/toolbar/toolbarImg/addImgButton/AddImgButton.tsx","cardMaker/header/toolbar/toolbarImg/addImgButtonFile/AddImgButtonFile.tsx","cardMaker/header/toolbar/toolbarImg/previewArtObj/PreviewArtObj.tsx","store/actionCreators/artObjBlockActionCreators.ts","cardMaker/header/toolbar/toolbarImg/previewArtObj/useCreateArtObj.ts","cardMaker/header/toolbar/toolbarImg/ToolbarImg.tsx","store/actionCreators/imgBlockActionCreators.ts","cardMaker/header/toolbar/toolbarImg/useCreateImg.ts","cardMaker/header/toolbar/colorPicker/ColorPicker.tsx","store/actionCreators/canvasActionCreators.ts","cardMaker/header/toolbar/toolbarFilter/ToolbarFilter.tsx","cardMaker/header/toolbar/toolbarFilter/useStateFilter.ts","cardMaker/header/toolbar/toolbarBackground/FileImgButton/FileImgButton.tsx","cardMaker/header/toolbar/toolbarBackground/useBackgroungImg.ts","cardMaker/header/toolbar/button/Button.tsx","cardMaker/header/toolbar/toolbarBackground/ToolbarBackground.tsx","cardMaker/header/toolbar/toolbarBackground/useBackgroungColor.ts","cardMaker/header/toolbar/toolbarArea/ToolbarArea.tsx","cardMaker/header/toolbar/toolbarArea/useDeleteArea.ts","store/actionCreators/blockActionCreators.ts","cardMaker/header/toolbar/toolbarObject/ToolbarObject.tsx","cardMaker/header/toolbar/toolbarObject/useBlockLevel.ts","cardMaker/header/toolbar/toolbarObject/useBlockDelete.ts","cardMaker/header/toolbar/toolbarCanvas/ToolbarCanvas.tsx","cardMaker/header/toolbar/toolbarCanvas/useStateCanvasSize.ts","cardMaker/header/toolbar/Toolbar.tsx","cardMaker/header/Header.tsx","cardMaker/canvas/useStateBlock.ts","cardMaker/canvas/useDragAndDrop.ts","cardMaker/canvas/useResize.ts","cardMaker/canvas/img/Img.tsx","cardMaker/canvas/text/Text.tsx","cardMaker/canvas/text/useEditText.ts","cardMaker/canvas/artObj/ArtObj.tsx","cardMaker/canvas/filter/Filter.tsx","cardMaker/canvas/deleteArea/DeleteArea.tsx","cardMaker/canvas/areaSelection/AreaSelection.tsx","cardMaker/canvas/Canvas.tsx","cardMaker/canvas/useAreaSelection.ts","cardMaker/CardMaker.tsx","index.tsx"],"names":["module","exports","NavButton","forwardRef","props","ref","onClick","className","styles","button","icon","label","button__text","connect","NavFileButton","htmlFor","inputFile","type","id","getImgInformationFromFile","fileImg","a","fileImgPromise","Promise","resolve","reject","reader","FileReader","readAsDataURL","onload","result","onerror","img","Image","src","decode","width","height","getProjectFromFile","file","filePromise","readAsText","json","JSON","parse","setComponentFields","listBlock","modifiableFields","newlistBlock","forEach","component","push","getIndexById","foundIndex","block","index","verify","value","Error","background","action","color","filter","opacity","heightCanvas","BlockTypes","SetOfArtObject","createGUID","gen","join","count","out","i","Math","random","toString","substring","text","x","y","size","bold","italic","underline","fontFamily","isBold","isItalic","isUnderline","artObj","copyListBlock","Boolean","isSelectedBlock","splice","newListBlock","length","isShiftUpAvailable","flipValue","isShiftDownAvailable","widthCanvas","canvas","deleteArea","area","selectBlock","history","listState","currentIndex","newListState","newCanvas","newCurrentIndex","isUndoAvailable","isRedoAvailable","areaSelection","cardMaker","viewModel","bgColor","bgImg","canvasSize","list","defState","tempColor","tempSize","testArtObj","testCanvas","testCardMaker","templates","name","exceptions","valid","store","createStore","project","initialState","applyMiddleware","next","oldState","getState","newState","includes","stringify","console","log","dispatch","visible","title","content","footer","onClose","useEffect","onKeydown","key","document","addEventListener","removeEventListener","modal","modalDialog","e","stopPropagation","modalHeader","modalTitle","modalClose","faTimes","modalBody","modalContent","modalFooter","newCardMaker","useState","isModal","setModal","faPiedPiperSquare","exportImg","elements","deleteAreas","createElement","ctx","getContext","crossOrigin","imgWidth","imgHeight","drawImage","fillStyle","fillRect","renderBlock","convertColor","r","g","b","element","dataURL","toDataURL","link","href","download","click","defShiftX","lineHeight","style","getStyle","textBlock","innerHTML","shift","Array","from","children","str","font","weight","family","fillText","innerText","textWidth","measureText","chars","rgbColor","parseInt","downloadImg","useRef","faImage","undo","redo","applyFileProject","buttonUndo","buttonRedo","btnUndo","current","btnRedo","handlerClickUndo","handlerClickRedo","handlerKeydown","event","code","ctrlKey","metaKey","useStateHistory","downloadButton","downloadFile","input","handlerChangeInputFile","target","files","useImportFileProject","handlerClickSaveToJson","Blob","URL","createObjectURL","navbar","faFolderOpen","faFileExport","faClone","faUndo","faRedo","setBoldText","setItalicText","setUnderlineText","enabled","modifyFn","param","btn","handleClickButton","preventDefault","useEditStateText","active","state","setColorText","inputColorText","colorPicker","inputColor","handleInput","handleChange","handleClick","stopImmediatePropagation","useEditColorText","setSizeText","inputSizeText","inputNumber","fieldSize","Number","handleBlur","String","input__number","min","max","step","setFontFamilyText","select","selectFontFamily","useSelectFont","fontFamilies","class","fantazyor","piroucyrillic","phenomena","sunday","kurale","sensei","borsok","summer","underdog","montserrat","openSans","comfortaa","rubik","marta","map","currentStyle","selected","createTextBlock","toolbar","toolbar__row","faFont","faBold","faItalic","faUnderline","colorPickerBox","toolbar__label","dropdown","dropbtn","dropdown_text","dropdown_content","AddImgButton","createArtObjBlock","artObjPreview","handleClickArtObj","alt","sticker","createImgBlock","srcList","Object","values","imgList","fieldFile","handlerChangeInput","imgInfo","useCreateImg","button_box","AddImgButtonFile","faDownload","faGlobe","faStickyNote","ColorPicker","input__color","setCanvasSize","inputFilter","setFilter","inputRange","fieldColor","fieldRange","handleInputFilter","handleChangeFilter","useStateFilter","input_range","inputBackgroundImg","setBackgroundImg","handlerChange","useBackgroungImg","bg","Button","textAlign","button_text","resetBackground","inputBackgroundColor","setBackgroundColor","buttonReset","handlerClickResetColor","handlerInputColor","handleerChangeColor","useBackgroungColor","toolbar__col1","button_container","FileImgButton","toolbar__col2","faRetweet","deleteAreaSelection","resetAreaSelection","buttonDelete","handleMousedownButton","useDeleteArea","faEraser","setSelectedBlock","setSizeBlock","deleteBlock","setPositionBlock","shiftUpBlock","shiftDownBlock","buttonUp","buttonDown","btnUp","btnDown","handlerClickShiftUp","handlerClickShiftDown","useBlockLevel","handlerClickDelete","useBlockDelete","faArrowUp","faArrowDown","toolbar__col","faTrash","inputCanvasSize","inputWidth","inputHeight","fieldWidth","fieldHeight","handleChangeSize","handleBlurSize","useStateCanvasSize","input_number","header","panel","useStateBlock","blockId","resetSelectedBlock","currentBlock","handleMousedownBlock","setTimeout","handleClickDocument","isDefPrev","defaultPrevented","isSelectedID","useDragAndDrop","defPos","startPos","newPos","handleMousedown","pageX","pageY","handleMouseMove","handleMouseUp","delta","left","top","useResize","LT","RT","LB","RB","defSize","point","pointLT","pointRT","pointLB","pointRB","offsetX","offsetY","newWidth","newHeight","prevWidth","prevHeight","moving","calculateSize","imgStyle","imgBlock","onDragStart","pointTopLeft","pointTopRight","pointBottomLeft","pointBottomRight","setTextInTextBlock","clickOnText","setTextIncurrentBlock","handleClickBlock","handleDblclickBlock","setAttribute","focus","getAttribute","handlerPaste","clipboardData","getData","execCommand","handlerInput","textStyle","fontSize","fontWeight","textDecoration","fontStyle","contentEditable","suppressContentEditableWarning","dangerouslySetInnerHTML","__html","artObjBlock","artObjStyle","filterStyle","DeleteAreaStyle","AreaSelection","areaSelectionStyle","setPositionAreaSelection","canvasStyle","getListBlock","startOffsetPos","field","selectArea","div","border","appendChild","abs","offsetWidth","offsetHeight","offsetLeft","offsetTop","remove","handleMousedownDocument","handleMousedownArea","position","zIndex","pointerEvents","useAreaSelection","main","subscribe","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.81112d21.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"select\":\"SelectFontFamily_select__1Hv9D\",\"fantazyor\":\"SelectFontFamily_fantazyor__1YuH3\",\"piroucyrillic\":\"SelectFontFamily_piroucyrillic__2APyX\",\"phenomena\":\"SelectFontFamily_phenomena__3L0pA\",\"sunday\":\"SelectFontFamily_sunday__3-2n9\",\"kurale\":\"SelectFontFamily_kurale__-1mws\",\"sensei\":\"SelectFontFamily_sensei__1zzQ5\",\"borsok\":\"SelectFontFamily_borsok__2Wuhd\",\"summer\":\"SelectFontFamily_summer__1jEjL\",\"underdog\":\"SelectFontFamily_underdog__2MpfH\",\"montserrat\":\"SelectFontFamily_montserrat__3seoV\",\"openSans\":\"SelectFontFamily_openSans__tiuJF\",\"comfortaa\":\"SelectFontFamily_comfortaa__3IxgG\",\"rubik\":\"SelectFontFamily_rubik__3nd8M\",\"marta\":\"SelectFontFamily_marta__1T-z5\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"modal\":\"Modal_modal__3Ldwj\",\"appear\":\"Modal_appear__1oVsi\",\"modalDialog\":\"Modal_modalDialog__3Du5z\",\"animatetop\":\"Modal_animatetop__2MHhu\",\"slide-in\":\"Modal_slide-in__1_LpD\",\"modalHeader\":\"Modal_modalHeader__1ppBy\",\"modalFooter\":\"Modal_modalFooter__lSAfT\",\"modalClose\":\"Modal_modalClose__3GnIC\",\"modalBody\":\"Modal_modalBody__12nPW\",\"modalContent\":\"Modal_modalContent__35CCy\",\"modalTitle\":\"Modal_modalTitle__bNkET\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"toolbar\":\"ToolbarBackground_toolbar__MQ_48\",\"toolbar__label\":\"ToolbarBackground_toolbar__label__1I8R8\",\"toolbar__col1\":\"ToolbarBackground_toolbar__col1__3BwVD\",\"toolbar__col2\":\"ToolbarBackground_toolbar__col2__12hzd\",\"toolbar__row\":\"ToolbarBackground_toolbar__row__3lf-3\",\"button_container\":\"ToolbarBackground_button_container__1ir_S\",\"colorPickerBox\":\"ToolbarBackground_colorPickerBox__2npIL\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"block\":\"Img_block__r3fmB\",\"img\":\"Img_img__3Hans\",\"selected\":\"Img_selected__vEyvs\",\"pointBottomRight\":\"Img_pointBottomRight__1Z-pj\",\"pointTopLeft\":\"Img_pointTopLeft__3ZXB8\",\"pointTopRight\":\"Img_pointTopRight__2cXMJ\",\"pointBottomLeft\":\"Img_pointBottomLeft__x6rWq\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"block\":\"ArtObj_block__1DyCD\",\"img\":\"ArtObj_img__3ltZN\",\"selected\":\"ArtObj_selected__1oJ2Z\",\"pointBottomRight\":\"ArtObj_pointBottomRight__3og1x\",\"pointTopLeft\":\"ArtObj_pointTopLeft__2iQK4\",\"pointTopRight\":\"ArtObj_pointTopRight__19xjD\",\"pointBottomLeft\":\"ArtObj_pointBottomLeft__1BMY1\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"toolbar\":\"ToolbarCanvas_toolbar__2lemH\",\"toolbar__button\":\"ToolbarCanvas_toolbar__button__2LRIf\",\"toolbar__label\":\"ToolbarCanvas_toolbar__label__1lbBA\",\"toolbar__button_text\":\"ToolbarCanvas_toolbar__button_text__Fo0b_\",\"input_number\":\"ToolbarCanvas_input_number__kQeBA\",\"toolbar__row\":\"ToolbarCanvas_toolbar__row__fR0UK\",\"input_range\":\"ToolbarCanvas_input_range__2BdY0\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"toolbar\":\"ToolbarText_toolbar__L36Xy\",\"toolbar__row\":\"ToolbarText_toolbar__row__1n6YO\",\"toolbar__label\":\"ToolbarText_toolbar__label__XASo7\",\"button\":\"ToolbarText_button__34F-S\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"toolbar\":\"ToolbarObject_toolbar__1wNU-\",\"toolbar__label\":\"ToolbarObject_toolbar__label__GzSLz\",\"toolbar__col\":\"ToolbarObject_toolbar__col__33gVZ\",\"toolbar__row\":\"ToolbarObject_toolbar__row__3n9uD\",\"input__color\":\"ToolbarObject_input__color__3PxWa\",\"button_container\":\"ToolbarObject_button_container__2CKtQ\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"button\":\"NavFileButton_button__31bRb\",\"button__text\":\"NavFileButton_button__text__2WzyS\",\"inputFile\":\"NavFileButton_inputFile__3SOw7\",\"icon\":\"NavFileButton_icon__1R6pk\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"dropbtn\":\"DropdownMenu_dropbtn__2-JiC\",\"dropdown\":\"DropdownMenu_dropdown__2_ubm\",\"dropdown_content\":\"DropdownMenu_dropdown_content__iSef_\",\"dropdown_text\":\"DropdownMenu_dropdown_text__2gbo8\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"button\":\"AddImgButtonFile_button__2N8CC\",\"button__text\":\"AddImgButtonFile_button__text__34fFe\",\"inputFile\":\"AddImgButtonFile_inputFile__4uOdL\",\"icon\":\"AddImgButtonFile_icon__3xQsK\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"toolbar\":\"ToolbarFilter_toolbar__CEBoi\",\"toolbar__label\":\"ToolbarFilter_toolbar__label__3pgyB\",\"input_color\":\"ToolbarFilter_input_color__1hKXO\",\"input_range\":\"ToolbarFilter_input_range__2mQc9\",\"colorPickerBox\":\"ToolbarFilter_colorPickerBox__3-g1H\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"button\":\"FileImgButton_button__2-G8o\",\"button__text\":\"FileImgButton_button__text__ilBCY\",\"inputFile\":\"FileImgButton_inputFile__nu7Na\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"toolbar\":\"ToolbarImg_toolbar__1U8h2\",\"button_box\":\"ToolbarImg_button_box__1ADxG\",\"toolbar__label\":\"ToolbarImg_toolbar__label__3zwm8\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"header\":\"Header_header__1rLmw\",\"panel\":\"Header_panel__29H5m\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"button\":\"NavButton_button__UL2Cr\",\"button__text\":\"NavButton_button__text__C4Sqv\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"button\":\"ButtonEditText_button__JsKq3\",\"active\":\"ButtonEditText_active__1z4H3\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"button\":\"AddImgButton_button__2zBC1\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"button\":\"Button_button__3s58t\",\"button_text\":\"Button_button_text__2xGDG\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"toolbar\":\"ToolbarArea_toolbar__17QU7\",\"toolbar__label\":\"ToolbarArea_toolbar__label__25frT\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"block\":\"Text_block__Fvt_5\",\"selected\":\"Text_selected__2uNOO\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"main\":\"CardMaker_main__qNuoq\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"navbar\":\"Navbar_navbar__2UjT7\",\"input\":\"Navbar_input__1lW6o\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"toolbar\":\"Toolbar_toolbar__hCIIv\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"input\":\"ColorPicker_input__Kiwid\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"input__number\":\"InputNumber_input__number__2kkQW\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"sticker\":\"PreviewArtObj_sticker__twuA7\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"input__color\":\"ColorPicker_input__color__3EGb4\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"canvas\":\"Canvas_canvas__Ak89z\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"filter\":\"Filter_filter__16erS\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"deleteArea\":\"DeleteArea_deleteArea__2KQym\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"areaSelection\":\"AreaSelection_areaSelection__1Syux\"};","import styles from './NavButton.module.css';\nimport { IconDefinition } from '@fortawesome/fontawesome-svg-core';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { ForwardedRef, forwardRef } from 'react';\nimport { connect } from 'react-redux';\n\ntype NavButtonProps = {\n  label: string,\n  icon: IconDefinition,\n  onClick: null | (() => void),\n}\n\nconst NavButton = forwardRef((props: NavButtonProps, ref: ForwardedRef<HTMLButtonElement>) => {\n  return (\n    <button\n      onClick={props.onClick ? props.onClick : ()=>{}}\n      className={styles.button}\n      ref={ref}>\n      <FontAwesomeIcon icon={props.icon} />\n      {props.label !== '' &&\n        <span className={styles.button__text}>{props.label}</span>\n      }\n    </button>\n  )\n});\n\nexport default connect(null, null, null, { forwardRef: true })(NavButton);","import styles from './NavFileButton.module.css';\nimport { IconDefinition } from '@fortawesome/fontawesome-svg-core';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { ForwardedRef, forwardRef } from 'react';\nimport { connect } from 'react-redux';\n\ntype NavFileButtonProps = {\n  label: string,\n  icon: IconDefinition,\n}\n\nconst NavFileButton = forwardRef((props: NavFileButtonProps, ref: ForwardedRef<HTMLInputElement>) => (\n  <button className={styles.button}>\n    <label htmlFor=\"input-file\" className={styles.icon}>\n      <FontAwesomeIcon icon={props.icon} />\n    </label>\n    <input\n      className={styles.inputFile}\n      type=\"file\"\n      ref={ref}\n      id=\"input-file\"\n    />\n    {props.label !== '' &&\n      <label className={styles.button__text}\n        htmlFor=\"input-file\">\n        {props.label}\n      </label>\n    }\n  </button>\n));\n\nexport default connect(null, null, null, { forwardRef: true })(NavFileButton);","import { CardMaker } from '../store/types';\n\n// конвертирование файла изображения в src стоку base64\ntype ImgInfo = {\n  width: number,\n  height: number,\n  src: string,\n}\n\nexport async function getImgInformationFromFile(fileImg: File): Promise<ImgInfo> {\n  const fileImgPromise = new Promise((resolve, reject) => {\n    let reader = new FileReader();\n    reader.readAsDataURL(fileImg);\n    reader.onload = () => resolve(reader.result);\n    reader.onerror = reject;\n  });\n  const img = new Image();\n  img.src = await fileImgPromise as string;\n  await img.decode();\n  return {\n    width: img.width,\n    height: img.height,\n    src: img.src,\n  }\n}\n\nexport async function getProjectFromFile(file: File): Promise<CardMaker> {\n  const filePromise = new Promise((resolve, reject) => {\n    let reader = new FileReader();\n    reader.readAsText(file);\n    reader.onload = () => resolve(reader.result);\n    reader.onerror = reject;\n  });\n  const json = await filePromise as string;\n  return await JSON.parse(json) as CardMaker;\n}","import { Block } from '../store/types';\n\n// проверка выделен ли блок\nexport function isSelectedBlock(id: string | null): boolean {\n  return Boolean(id)\n}\n\n// установка значений полю/полям одного элемента из списка элементов\nexport function setComponentFields(listBlock: Block[], id: string, modifiableFields: object): Block[] {\n  let newlistBlock: Block[] = [];\n  listBlock.forEach((component: Block) => {\n    if (component.id === id) {\n      newlistBlock.push({\n        ...component,\n        ...modifiableFields,\n      });\n    } else {\n      newlistBlock.push(component);\n    }\n  });\n  return newlistBlock;\n}\n\n// получить индекс элемента по id\nexport function getIndexById(listBlock: Block[], id: string): number {\n  let foundIndex: number = -1;\n  listBlock.forEach((block: Block, index: number) => {\n    if (block.id === id) {\n      foundIndex = index;\n    }\n  });\n  return foundIndex;\n}\n\n\n\n","import { ActionHistory, Block } from '../store/types';\nimport { getIndexById } from './elementList';\n\n// провера доступности операции undo\nexport function isUndoAvailable(history: ActionHistory): boolean {\n  let length = history.listState.length;\n  let index = history.currentIndex;\n  return length > 1 && index > 0;\n}\n\n// проверка доступности операции redo\nexport function isRedoAvailable(history: ActionHistory): boolean {\n  let length = history.listState.length;\n  let index = history.currentIndex;\n  return index + 1 < length;\n}\n\n// проверка доступности операции перемещения слоя вверх\nexport function isShiftUpAvailable(id: string | null, listBlock: Block[]): boolean {\n  const length: number = listBlock.length;\n  return Boolean(id && getIndexById(listBlock, id) < length - 1)\n}\n\n// проверка доступности операции перемещения слоя вниз\nexport function isShiftDownAvailable(id: string | null, listBlock: Block[]): boolean {\n  return Boolean(id && getIndexById(listBlock, id) > 0)\n}\n\n// проверка на !null значение\nexport function verify<T>(value: T | null | undefined): T {\n  if (!value) {\n    throw new Error('Assertion failed');\n  }\n  return value;\n}","import { Background } from '../types';\n\nexport type BackgroundAction = {\n  type: 'NEW_CARD_MAKER',\n} | {\n  type: 'RESET_BACKGROUND',\n} | {\n  type: 'SET_BACKGROUND_COLOR',\n  color: string,\n} | {\n  type: 'SET_BACKGROUND_IMG',\n  src: string,\n}\n\nfunction background(background: Background, action: BackgroundAction): Background {\n  switch (action.type) {\n\n    case 'NEW_CARD_MAKER':\n      return {\n        color: '#ffffff',\n        src: null,\n      };\n\n    case 'RESET_BACKGROUND':\n      return {\n        color: '#ffffff',\n        src: null,\n      };\n\n    case 'SET_BACKGROUND_COLOR':\n      return {\n        color: action.color,\n        src: null,\n      };\n\n    case 'SET_BACKGROUND_IMG':\n      return {\n        color: null,\n        src: action.src,\n      };\n\n    default:\n      return background;\n  }\n}\n\nexport default background;","import { Filter } from '../types';\n\nexport type FilterAction = {\n  type: 'NEW_CARD_MAKER',\n} | {\n  type: 'SET_FILTER',\n  color: string,\n  opacity: number,\n}\n\nfunction filter(filter: Filter, action: FilterAction): Filter {\n  switch (action.type) {\n\n    case 'NEW_CARD_MAKER':\n      return {\n        color: '#ffffff',\n        opacity: 0,\n      };\n\n    case 'SET_FILTER':\n      return {\n        color: action.color,\n        opacity: action.opacity,\n      };\n\n    default:\n      return filter;\n  }\n}\n\nexport default filter;","export type HeightAction = {\n  type: 'NEW_CARD_MAKER',\n} | {\n  type: 'SET_CANVAS_SIZE',\n  height: number,\n}\n\nfunction heightCanvas(height: number, action: HeightAction): number {\n  switch (action.type) {\n\n    case 'NEW_CARD_MAKER':\n      return 600;\n\n    case 'SET_CANVAS_SIZE':\n      return action.height;\n\n    default:\n      return height;\n  }\n}\n\nexport default heightCanvas;","export enum BlockTypes {\n  img,\n  artObj,\n  text\n}\n\nexport type ActionHistory = Readonly<{\n  listState: Canvas[],\n  currentIndex: number,\n}>\n\nexport type Template = Readonly<{\n  name: string,\n  json: string,\n}>\n\nexport enum SetOfArtObject {\n  boy = \"./img/artObj/boy.png\",\n  frog = \"./img/artObj/frog.png\",\n  girl = \"./img/artObj/girl.png\",\n  loupe = \"./img/artObj/loupe.png\",\n  palette = \"./img/artObj/palette.png\",\n  pencil = \"./img/artObj/pencil.png\",\n  rainbow = \"./img/artObj/rainbow.png\",\n  snail = \"./img/artObj/snail.png\",\n}\n\nexport type Position = Readonly<{\n  x: number,\n  y: number,\n}>\n\nexport type UnifiedBlock = Readonly<{\n  id: string,\n  // type: string,\n}> & Position\n\nexport type ArtObj = Readonly<{\n  src: string,\n  type: BlockTypes.artObj\n}> & UnifiedBlock & Size\n\nexport type Img = Readonly<{\n  src: string,\n  type: BlockTypes.img\n}> & UnifiedBlock & Size\n\nexport type Text = Readonly<{\n  text: string,\n  color: string,\n  size: number,\n  bold: boolean,\n  italic: boolean,\n  underline: boolean,\n  fontFamily: string,\n  type: BlockTypes.text\n}> & UnifiedBlock\n\nexport type Block = Text | Img | ArtObj;\n\nexport type Background = Readonly<{\n  color: string | null,\n  src: string | null,\n}>\n\nexport type Filter = Readonly<{\n  color: string,\n  opacity: number,\n}>\n\nexport type Area = Readonly<{\n  x: number,\n  y: number,\n}> & Size\n\nexport type Canvas = Readonly<{\n  filter: Filter,\n  listBlock: Block[];\n  deleteArea: Area[],\n  background: Background,\n}> & Size\n\nexport type Size = Readonly<{\n  width: number,\n  height: number,\n}>\n\nexport type ViewModelText = {\n  color: string | null,\n  size: number | null,\n  bold: boolean | null,\n  italic: boolean | null,\n  underline: boolean | null,\n  fontFamily: string | null,\n  tempColor: string | null,\n  tempSize: number | null,\n}\n\nexport type ViewModelBgImg = {\n  width: number,\n  height: number,\n  src: string,\n}\n\nexport type ViewModel = Readonly<{\n  bgColor: string | null,\n  bgImg: ViewModelBgImg | null,\n  canvasSize: Size | null,\n  filter: Filter | null,\n  text: ViewModelText,\n  areaSelection: Area | null,\n}>\n\nexport type CardMaker = Readonly<{\n  canvas: Canvas,\n  selectBlock: string | null,\n  history: ActionHistory,\n  templates: Template[],\n  viewModel: ViewModel,\n}>\n","export function createGUID() {\n  return [gen(2), gen(1), gen(1), gen(1), gen(3)].join(\"-\");\n}\n\nfunction gen(count: number) {\n  let out = \"\";\n  for (let i: number = 0; i < count; i++) {\n    out += (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);\n  }\n  return out;\n}","import { Block, BlockTypes } from '../types';\nimport { setComponentFields, getIndexById, isSelectedBlock } from '../../utils/elementList'\nimport { isShiftUpAvailable, isShiftDownAvailable } from '../../utils/permisions'\nimport { createGUID } from '../../utils/guid';\n\nexport type ListBlockAction = {\n  type: 'NEW_CARD_MAKER',\n} | {\n  type: 'CREATE_TEXT_BLOCK',\n  x: number,\n  y: number,\n} | {\n  type: 'SET_SIZE_BLOCK',\n  id: string,\n  width: number,\n  height: number,\n} | {\n  type: 'SET_TEXT_IN_TEXT_BLOCK',\n  id: string,\n  text: string,\n} | {\n  type: 'SET_FONT_FAMILY_TEXT',\n  id: string,\n  fontFamily: string,\n} | {\n  type: 'SET_BOLD_TEXT',\n  id: string,\n  isBold: boolean,\n} | {\n  type: 'SET_ITALIC_TEXT',\n  id: string,\n  isItalic: boolean,\n} | {\n  type: 'SET_UNDERLINE_TEXT',\n  id: string,\n  isUnderline: boolean,\n} | {\n  type: 'SET_SIZE_TEXT',\n  id: string,\n  size: number,\n} | {\n  type: 'SET_COLOR_TEXT',\n  id: string,\n  color: string,\n} | {\n  type: 'CREATE_IMG_BLOCK',\n  width: number,\n  height: number,\n  src: string,\n  x: number,\n  y: number,\n} | {\n  type: 'CREATE_ART_OBJ_BLOCK',\n  src: string,\n  x: number,\n  y: number,\n} | {\n  type: 'DELETE_BLOCK',\n  id: string,\n} | {\n  type: 'SET_POSITION_BLOCK',\n  id: string,\n  x: number,\n  y: number,\n} | {\n  type: 'SHIFT_UP_BLOCK',\n  id: string,\n} | {\n  type: 'SHIFT_DOWN_BLOCK',\n  id: string,\n}\n\nfunction listBlock(listBlock: Block[], action: ListBlockAction): Block[] {\n  switch (action.type) {\n\n    case 'NEW_CARD_MAKER':\n      return [];\n\n    case 'CREATE_TEXT_BLOCK':\n      return [\n        ...listBlock,\n        {\n          id: createGUID(),\n          type: BlockTypes.text,\n          color: '#898989',\n          x: action.x - 45,\n          y: action.y - 25,\n          text: '<div>Текст<br></div>',\n          size: 50,\n          bold: false,\n          italic: false,\n          underline: false,\n          fontFamily: 'OpenSans',\n        }\n      ];\n\n    case 'SET_SIZE_BLOCK':\n      return setComponentFields(listBlock, action.id, {\n        width: action.width,\n        height: action.height,\n      });\n\n    case 'SET_TEXT_IN_TEXT_BLOCK':\n      return setComponentFields(listBlock, action.id, {\n        text: action.text,\n      });\n\n    case 'SET_FONT_FAMILY_TEXT':\n      return setComponentFields(listBlock, action.id, {\n        fontFamily: action.fontFamily,\n      });\n\n    case 'SET_BOLD_TEXT':\n      return setComponentFields(listBlock, action.id, {\n        bold: action.isBold,\n      });\n\n    case 'SET_ITALIC_TEXT':\n      return setComponentFields(listBlock, action.id, {\n        italic: action.isItalic,\n      });\n\n    case 'SET_UNDERLINE_TEXT':\n      return setComponentFields(listBlock, action.id, {\n        underline: action.isUnderline,\n      });\n\n    case 'SET_SIZE_TEXT':\n      return setComponentFields(listBlock, action.id, {\n        size: action.size,\n      });\n\n    case 'SET_COLOR_TEXT':\n      return setComponentFields(listBlock, action.id, {\n        color: action.color,\n      });\n\n    case 'CREATE_IMG_BLOCK':\n      return [\n        ...listBlock,\n        {\n          id: createGUID(),\n          type: BlockTypes.img,\n          width: action.width,\n          height: action.height,\n          x: action.x,\n          y: action.y,\n          src: action.src,\n        }\n      ];\n\n    case 'CREATE_ART_OBJ_BLOCK':\n      return [\n        ...listBlock,\n        {\n          id: createGUID(),\n          type: BlockTypes.artObj,\n          width: 150,\n          height: 150,\n          x: action.x,\n          y: action.y,\n          src: action.src,\n        }\n      ];\n\n    case 'DELETE_BLOCK':\n      let copyListBlock: Block[] = [...listBlock];\n      if (isSelectedBlock(action.id)) {\n        copyListBlock.forEach((component, index) => {\n          if (component.id === action.id) {\n            copyListBlock.splice(index, 1);\n            return false;\n          }\n        });\n      }\n      return copyListBlock;\n\n    case 'SET_POSITION_BLOCK':\n      return setComponentFields(listBlock, action.id, {\n        x: action.x,\n        y: action.y,\n      });\n\n    case 'SHIFT_UP_BLOCK':\n      {\n        let newListBlock: Block[] = [...listBlock];\n        if (isShiftUpAvailable(action.id, listBlock)) {\n          const id: string = action.id as string;\n          const index: number = getIndexById(newListBlock, id);\n          const flipValue: Block[] = [newListBlock[index + 1], newListBlock[index]];\n          newListBlock.splice(index, 2, ...flipValue);\n        }\n        return newListBlock;\n      }\n\n    case 'SHIFT_DOWN_BLOCK':\n      {\n        let newListBlock: Block[] = [...listBlock];\n        if (isShiftDownAvailable(action.id, listBlock)) {\n          const id: string = action.id as string;\n          const index: number = getIndexById(newListBlock, id);\n          const flipValue: Block[] = [newListBlock[index], newListBlock[index - 1]];\n          newListBlock.splice(index - 1, 2, ...flipValue);\n        }\n        return newListBlock;\n      }\n\n    default:\n      return listBlock;\n  }\n}\n\nexport default listBlock;","export type WidthAction = {\n  type: 'NEW_CARD_MAKER',\n} | {\n  type: 'SET_CANVAS_SIZE',\n  width: number,\n}\n\nfunction widthCanvas(width: number, action: WidthAction): number {\n  switch (action.type) {\n\n    case 'NEW_CARD_MAKER':\n      return 800;\n\n    case 'SET_CANVAS_SIZE':\n      return action.width;\n\n    default:\n      return width;\n  }\n}\nexport default widthCanvas;","import { Canvas, Area } from '../types';\nimport background, { BackgroundAction } from './BackgroundReducer';\nimport filter, { FilterAction } from './FilterReducer';\nimport heightCanvas, { HeightAction } from './HeightCanvasReducer';\nimport listBlock, { ListBlockAction } from './ListBlockReducer';\nimport widthCanvas, { WidthAction } from './WidthCanvasReducer';\n\nexport type CanvasAction = WidthAction | HeightAction | FilterAction | ListBlockAction | BackgroundAction | DeleteAreaAction;\n\nfunction canvas(canvas: Canvas, action: CanvasAction): Canvas {\n  return {\n    width: widthCanvas(canvas.width, action as WidthAction),\n    height: heightCanvas(canvas.height, action as HeightAction),\n    filter: filter(canvas.filter, action as FilterAction),\n    listBlock: listBlock(canvas.listBlock, action as ListBlockAction),\n    background: background(canvas.background, action as BackgroundAction),\n    deleteArea: deleteArea(canvas.deleteArea, action as DeleteAreaAction),\n  };\n}\n\nexport default canvas;\n\ntype DeleteAreaAction = {\n  type: 'DELETE_AREA_SELECTION',\n  area: Area | null\n} | {\n  type: 'NEW_CARD_MAKER',\n}\n\nfunction deleteArea(deleteArea: Area[], action: DeleteAreaAction): Area[] {\n  switch (action.type) {\n    case 'DELETE_AREA_SELECTION':\n      if (action.area) {\n        return [\n          ...deleteArea,\n          action.area as Area,\n        ];\n      } else {\n        return deleteArea;\n      }\n    case 'NEW_CARD_MAKER':\n      return [];\n  \n    default:\n      return deleteArea;\n  }\n}","export type SelectBlockAction = {\n  type: 'NEW_CARD_MAKER',\n} | {\n  type: 'RESET_SELECTED_BLOCK',\n  width: number,\n} | {\n  type: 'SET_SELECTED_BLOCK',\n  id: string,\n}\n\nfunction selectBlock(selectBlock: null | string, action: SelectBlockAction): string | null {\n  switch (action.type) {\n\n    case 'NEW_CARD_MAKER':\n      return null;\n\n    case 'RESET_SELECTED_BLOCK':\n      return null;\n\n    case 'SET_SELECTED_BLOCK':\n      return action.id;\n\n    default:\n      return selectBlock;\n  }\n}\n\nexport default selectBlock;","import { Canvas as CanvasType, ActionHistory as ActionHistoryType } from '../types';\nimport { isUndoAvailable, isRedoAvailable } from '../../utils/permisions'\nimport canvas from './CanvasReducer';\n\nexport type HistoryAction = {\n  type: 'NEW_CARD_MAKER',\n} | {\n  type: 'ADD_HISTORY',\n  newCanvas: CanvasType,\n} | {\n  type: 'UNDO',\n} | {\n  type: 'REDO',\n}\n\nfunction history(history: ActionHistoryType, action: HistoryAction): ActionHistoryType {\n  switch (action.type) {\n\n    case 'NEW_CARD_MAKER':\n      return {\n        listState: [canvas({} as CanvasType, action)],\n        currentIndex: 0,\n      };\n\n    case 'ADD_HISTORY':\n      {\n        const listState: CanvasType[] = history.listState;\n        const currentIndex: number = history.currentIndex;\n        let newListState: CanvasType[] = [...history.listState];\n        if (currentIndex !== listState.length - 1) {\n          newListState.splice(currentIndex + 1, listState.length - currentIndex + 1);\n        }\n        newListState.push(action.newCanvas);\n        return {\n          currentIndex: currentIndex + 1,\n          listState: newListState,\n        };\n      }\n\n    case 'UNDO':\n      {\n        const currentIndex: number = history.currentIndex;\n        const newCurrentIndex: number = isUndoAvailable(history) ? currentIndex - 1 : currentIndex;\n        return {\n          ...history,\n          currentIndex: newCurrentIndex,\n        }\n      }\n\n    case 'REDO':\n      {\n        const currentIndex: number = history.currentIndex;\n        const newCurrentIndex: number = isRedoAvailable(history) ? currentIndex + 1 : currentIndex;\n        return {\n          ...history,\n          currentIndex: newCurrentIndex,\n        }\n      }\n\n    default:\n      return history;\n  }\n}\n\nexport default history;","import { CardMaker, Size, Filter, ViewModelText, Block, Text, Area } from \"../types\";\nimport { getIndexById } from '../../utils/elementList';\n\nexport type ViewModelAction = BgColorAction | BgImgAction | CanvasSizeAction | FilterAction | TextAction;\n\nfunction viewModel(cardMaker: CardMaker = {} as CardMaker, action: ViewModelAction) {\n  return {\n    bgColor: bgColor(cardMaker, action as BgColorAction),\n    bgImg: bgImg(cardMaker, action as BgImgAction),\n    canvasSize: canvasSize(cardMaker, action as CanvasSizeAction),\n    filter: filter(cardMaker, action as FilterAction),\n    text: text(cardMaker, action as TextAction),\n    areaSelection: areaSelection(cardMaker, action as AreaSelectionAction),\n  }\n}\n\ntype AreaSelectionAction = {\n  type: 'AREA_SELECTION',\n  x: number,\n  y: number,\n  width: number,\n  height: number,\n} | {\n  type: 'RESET_AREA_SELECTION',\n} | {\n  type: 'SET_POSITION_AREA_SELECTION',\n  x: number,\n  y: number,\n} | {\n  type: 'UNDO',\n} | {\n  type: 'REDO'\n}\n\nfunction areaSelection(cardMaker: CardMaker, action: AreaSelectionAction): Area | null {\n  switch (action.type) {\n    case 'AREA_SELECTION':\n      return {\n        x: action.x,\n        y: action.y,\n        width: action.width,\n        height: action.height,\n      }\n    case 'SET_POSITION_AREA_SELECTION':\n      return {\n        ...cardMaker.viewModel.areaSelection as Area,\n        x: action.x,\n        y: action.y,\n      };\n    case 'RESET_AREA_SELECTION': return null;\n    case 'UNDO': return null;\n    case 'REDO': return null;\n    default: return cardMaker.viewModel.areaSelection;\n  }\n}\n\ntype BgColorAction = {\n  type: 'INPUT_BACKGROUND_COLOR',\n  color: string,\n} | {\n  type: 'UNDO',\n} | {\n  type: 'REDO'\n}\n\nfunction bgColor(cardMaker: CardMaker, action: BgColorAction): string | null {\n  switch (action.type) {\n    case 'INPUT_BACKGROUND_COLOR': return action.color;\n    case 'UNDO': return null;\n    case 'REDO': return null;\n    default: return cardMaker.canvas.background.color;\n  }\n}\n\ntype BgImgAction = {\n  type: 'INPUT_BACKGROUND_IMG',\n  width: number,\n  height: number,\n  src: string,\n} | {\n  type: 'UNDO',\n} | {\n  type: 'REDO'\n}\n\nfunction bgImg(cardMaker: CardMaker, action: BgImgAction): Size & { src: string } | null {\n  switch (action.type) {\n    case 'INPUT_BACKGROUND_IMG':\n      return {\n        width: action.width,\n        height: action.height,\n        src: action.src,\n      };\n    case 'UNDO': return null;\n    case 'REDO': return null;\n    default: return null;\n  }\n}\n\ntype CanvasSizeAction = {\n  type: 'INPUT_CANVAS_SIZE',\n  width: number,\n  height: number,\n} | {\n  type: 'UNDO',\n} | {\n  type: 'REDO'\n}\n\nfunction canvasSize(cardMaker: CardMaker, action: CanvasSizeAction): Size | null {\n  switch (action.type) {\n    case 'INPUT_CANVAS_SIZE':\n      return {\n        width: action.width,\n        height: action.height,\n      };\n    case 'UNDO': return null;\n    case 'REDO': return null;\n    default:\n      return cardMaker.viewModel.canvasSize\n  }\n}\n\ntype FilterAction = {\n  type: 'INPUT_FILTER',\n  color: string,\n  opacity: number,\n} | {\n  type: 'UNDO',\n} | {\n  type: 'REDO'\n}\n\nfunction filter(cardMaker: CardMaker, action: FilterAction): Filter | null {\n  switch (action.type) {\n    case 'INPUT_FILTER':\n      return {\n        color: action.color,\n        opacity: action.opacity,\n      };\n    case 'UNDO': return null;\n    case 'REDO': return null;\n    default:\n      return cardMaker.viewModel.filter\n  }\n}\n\ntype TextAction = {\n  type: 'CLICK_ON_TEXT',\n  id: string,\n} | {\n  type: 'RESET_SELECTED_BLOCK',\n} | {\n  type: 'SET_SELECTED_BLOCK',\n  id: string,\n} | {\n  type: 'SET_FONT_FAMILY_TEXT',\n  id: string,\n  fontFamily: string,\n} | {\n  type: 'INPUT_COLOR_TEXT',\n  color: string,\n} | {\n  type: 'INPUT_SIZE_TEXT',\n  size: number,\n} | {\n  type: 'SET_BOLD_TEXT',\n  id: string,\n  isBold: boolean,\n} | {\n  type: 'SET_ITALIC_TEXT',\n  id: string,\n  isItalic: boolean,\n} | {\n  type: 'SET_UNDERLINE_TEXT',\n  id: string,\n  isUnderline: boolean,\n} | {\n  type: 'UNDO',\n} | {\n  type: 'REDO'\n}\n\nfunction text(cardMaker: CardMaker, action: TextAction): ViewModelText {\n  const defState: ViewModelText = {\n    color: null,\n    size: null,\n    bold: null,\n    italic: null,\n    underline: null,\n    fontFamily: null,\n    tempColor: null,\n    tempSize: null,\n  }\n\n  let list: Block[]\n  switch (action.type) {\n\n    case 'CLICK_ON_TEXT':\n      list = cardMaker.canvas.listBlock;\n      const { color, size, bold, italic, underline, fontFamily } = list[getIndexById(list, action.id)] as Text;\n      return { color, tempColor: null, tempSize: null, size, bold, italic, underline, fontFamily }\n\n    case 'SET_FONT_FAMILY_TEXT':\n      return {\n        ...cardMaker.viewModel.text,\n        fontFamily: action.fontFamily\n      } as ViewModelText;\n\n    case 'INPUT_COLOR_TEXT':\n      return {\n        ...cardMaker.viewModel.text,\n        tempColor: action.color\n      } as ViewModelText;\n\n    case 'INPUT_SIZE_TEXT':\n      return {\n        ...cardMaker.viewModel.text,\n        tempSize: action.size\n      } as ViewModelText;\n\n    case 'SET_BOLD_TEXT':\n      return {\n        ...cardMaker.viewModel.text,\n        bold: action.isBold\n      } as ViewModelText;\n\n    case 'SET_ITALIC_TEXT':\n      return {\n        ...cardMaker.viewModel.text,\n        italic: action.isItalic\n      } as ViewModelText;\n\n    case 'SET_UNDERLINE_TEXT':\n      return {\n        ...cardMaker.viewModel.text,\n        underline: action.isUnderline\n      } as ViewModelText;\n\n    case 'SET_SELECTED_BLOCK': return defState;\n    case 'RESET_SELECTED_BLOCK': return defState;\n\n    case 'UNDO': return defState;\n\n    case 'REDO': return defState;\n\n    default:\n      return cardMaker.viewModel.text\n  }\n}\n\nexport default viewModel;","import {\n  ActionHistory,\n  Template,\n  ArtObj,\n  Img,\n  Text,\n  Background,\n  Filter,\n  Canvas,\n  CardMaker,\n  ViewModel,\n  BlockTypes,\n  Area\n} from \"./types\";\n\nconst testTemplate: Template = {\n  name: \"\",\n  json: \"\",\n}\n\nconst testSetOfArtObject = {\n  boy: \"img/artObj/boy.png\",\n  frog: \"img/artObj/frog.png\",\n  girl: \"img/artObj/girl.png\",\n  loupe: \"img/artObj/loupe.png\",\n  palette: \"img/artObj/palette.png\",\n  pencil: \"img/artObj/pencil.png\",\n  rainbow: \"img/artObj/rainbow.png\",\n  snail: \"img/artObj/snail.png\",\n}\n\nconst testArtObj: ArtObj = {\n  id: \"d3df27cd-3053-21a6-4abe-9db51cda7c17\",\n  type: BlockTypes.artObj,\n  width: 150,\n  height: 150,\n  x: 20,\n  y: 280,\n  src: testSetOfArtObject.girl,\n}\n\nconst testImg: Img = {\n  id: \"4f406201-6f2f-b9ce-575e-438b1a7d1456\",\n  type: BlockTypes.img,\n  width: 320,\n  height: 238,\n  x: 100,\n  y: 270,\n  src: \"https://images.pexels.com/photos/3337209/pexels-photo-3337209.jpeg?cs=srgb&dl=pexels-mo-3337209.jpg&fm=jpg\",\n}\n\nconst testText: Text = {\n  id: \"9a13a85a-59ee-7ba3-1c64-fcad25650fc1\",\n  type: BlockTypes.text,\n  x: 200,\n  y: 280,\n  text: \"<div>Это</div><div>закат!!!</div>\",\n  size: 40,\n  bold: true,\n  italic: true,\n  underline: true,\n  color: \"#ffffff\",\n  fontFamily: \"Sensei\",\n}\n\nconst testBackground: Background = {\n  color: null,\n  src: \"https://images.pexels.com/photos/8175462/pexels-photo-8175462.jpeg?auto=compress&cs=tinysrgb&h=650&w=940\",\n}\n\nconst testFilter: Filter = {\n  color: \"#c1e319\",\n  opacity: 0.05,\n}\n\nconst deleteArea: Area[] = [\n  {\n    width: 100,\n    height: 50,\n    x: 150,\n    y: 200,\n  },\n  {\n    width: 70,\n    height: 50,\n    x: 350,\n    y: 175,\n  }\n];\n\n\nconst testCanvas: Canvas = {\n  width: 800,\n  height: 800,\n  filter: testFilter,\n  listBlock: [\n    testImg,\n    testArtObj,\n    testText\n  ],\n  deleteArea: deleteArea,\n  background: testBackground,\n}\n\nconst testActionHistory: ActionHistory = {\n  listState:\n    [\n      testCanvas,\n    ],\n  currentIndex: 0,\n}\n\nconst viewModel: ViewModel = {\n  bgColor: null,\n  bgImg: null,\n  canvasSize: null,\n  filter: null,\n  text: {\n    color: null,\n    size: null,\n    bold: null,\n    italic: null,\n    underline: null,\n    fontFamily: null,\n    tempColor: null,\n    tempSize: null,\n  },\n  areaSelection: null,\n}\n\nexport const testCardMaker: CardMaker = {\n  canvas: testCanvas,\n  selectBlock: null,\n  history: testActionHistory,\n  templates: [testTemplate],\n  viewModel: viewModel,\n}","import { createStore, applyMiddleware, Store, MiddlewareAPI, Dispatch, AnyAction } from 'redux';\nimport { cardMakerReducer } from './reducers/CardMakerReducer';\nimport { testCardMaker as initialState } from './initialState';\nimport { CardMaker } from './types';\n\nimport { addHistory, afterChangeHistory } from './actionCreators/historyActionCreators';\n\n\nconst exceptions: string[] = [\n  'NEW_CARD_MAKER',\n  'ADD_HISTORY',\n  'AFTER_CHANGE_HISTORY',\n  'UNDO',\n  'REDO',\n  'SET_SELECTED_BLOCK',\n  'RESET_SELECTED_BLOCK',\n  'INPUT_SIZE_TEXT',\n  'INPUT_COLOR_TEXT',\n  'SET_SIZE_TEXT',\n  'SET_POSITION_AREA_SELECTION',\n  'RESET_AREA_SELECTION',\n  'AREA_SELECTION',\n  'INPUT_FILTER',\n  'INPUT_CANVAS_SIZE',\n  'INPUT_BACKGROUND_IMG',\n  'INPUT_BACKGROUND_COLOR',\n];\n\nconst storeHistory = (store: MiddlewareAPI<Dispatch<AnyAction>, CardMaker>) =>\n  (next: AppDispatch) => (action: AnyAction) => {\n    const oldState = store.getState();\n    const result = next(action)\n    const newState = store.getState();\n\n    if (!exceptions.includes(action.type)) {\n      if (JSON.stringify(oldState.canvas) !== JSON.stringify(newState.canvas)) {\n        console.log('сохранение истории');\n        store.dispatch(addHistory(newState.canvas));\n      }\n    }\n    return result\n  }\n\nconst valid: string[] = [\n  'UNDO',\n  'REDO',\n];\n\nconst movingHistory = (store: MiddlewareAPI<Dispatch<AnyAction>, CardMaker>) =>\n  (next: AppDispatch) => (action: AnyAction) => {\n    const result = next(action)\n\n    if ((valid.includes(action.type)) && (action.type !== 'AFTER_CHANGE_HISTORY')) {\n      const canvas = store.getState().history.listState[store.getState().history.currentIndex];\n      const newState = {\n        ...store.getState(),\n        canvas,\n      }\n      store.dispatch(afterChangeHistory(newState));\n    }\n    return result\n  }\n\nexport const store: Store<CardMaker> = createStore(\n  cardMakerReducer,\n  initialState,\n  applyMiddleware(storeHistory, movingHistory)\n);\n\nexport type RootState = ReturnType<typeof store.getState>\nexport type AppDispatch = typeof store.dispatch","import { CardMaker } from '../types';\nimport canvas, { CanvasAction } from './CanvasReducer';\nimport selectBlock, { SelectBlockAction } from './SelectBlockReducer';\nimport history, { HistoryAction } from './HistoryReducer';\nimport viewModel, { ViewModelAction } from './ViewModelReducer';\n\nexport type CardMakerReducerAction = {\n  type: 'AFTER_CHANGE_HISTORY',\n  cardMaker: CardMaker,\n} | {\n  type: 'APPLY_FILE_PROJECT',\n  project: CardMaker,\n} | CanvasAction | SelectBlockAction | HistoryAction | ViewModelAction;\n\nexport function cardMakerReducer(cardMaker: CardMaker = {} as CardMaker, action: CardMakerReducerAction): CardMaker {\n  switch (action.type) {\n\n    case 'AFTER_CHANGE_HISTORY':\n      return action.cardMaker;\n\n    case 'APPLY_FILE_PROJECT':\n      return action.project;\n\n    default:\n      return {\n        canvas: canvas(cardMaker.canvas, action as CanvasAction),\n        selectBlock: selectBlock(cardMaker.selectBlock, action as SelectBlockAction),\n        history: history(cardMaker.history, action as HistoryAction),\n        templates: [],\n        viewModel: viewModel(cardMaker, action as ViewModelAction)\n      }\n  }\n}\n\n","import { Canvas, CardMaker } from '../types';\n\nexport function addHistory(newCanvas: Canvas) {\n  return {\n    type: 'ADD_HISTORY',\n    newCanvas: newCanvas,\n  }\n}\n\nexport function undo() {\n  return {\n    type: 'UNDO',\n  }\n}\n\nexport function redo() {\n  return {\n    type: 'REDO',\n  }\n}\n\nexport function afterChangeHistory(cardMaker: CardMaker) {\n  return {\n    type: 'AFTER_CHANGE_HISTORY',\n    cardMaker: cardMaker,\n  }\n}","import { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { faTimes } from '@fortawesome/free-solid-svg-icons'\nimport { ReactElement, useEffect } from \"react\"\nimport { connect } from \"react-redux\"\nimport styles from './Modal.module.css';\n\n// интерфейс для пропсов\ntype ModalProps = {\n  visible: boolean\n  title: string\n  content: ReactElement | string\n  footer: ReactElement | string\n  onClose: () => void\n}\n\nconst Modal = ({\n  visible = false,\n  title = '',\n  content = '',\n  footer = '',\n  onClose,\n}: ModalProps) => {\n\n  // c помощью useEffect цепляем обработчик к нажатию клавиш\n  useEffect(() => {\n    // создаем обработчик нажатия клавиши Esc\n    const onKeydown = ({ key }: KeyboardEvent) => {\n      switch (key) {\n        case 'Escape':\n          onClose()\n          break\n      }\n    }\n    document.addEventListener('keydown', onKeydown)\n    return () => document.removeEventListener('keydown', onKeydown)\n  }, [onClose])\n\n  // если компонент невидим, то не отображаем его\n  if (!visible) {\n    return null;\n  }\n\n  // или возвращаем верстку модального окна\n  return <div className={styles.modal} onClick={onClose}>\n    <div className={styles.modalDialog} onClick={e => e.stopPropagation()}>\n      <div className={styles.modalHeader}>\n        <h3 className={styles.modalTitle}>{title}</h3>\n        <span className={styles.modalClose} onClick={onClose}>\n        <FontAwesomeIcon icon={faTimes} />\n        </span>\n      </div>\n      <div className={styles.modalBody}>\n        <div className={styles.modalContent}>{content}</div>\n      </div>\n      {footer && <div className={styles.modalFooter}>{footer}</div>}\n    </div>\n  </div>\n}\n\nexport default connect()(Modal)","import { faPiedPiperSquare } from '@fortawesome/free-brands-svg-icons'\nimport { connect } from 'react-redux';\nimport { useState } from 'react';\nimport { AppDispatch } from '../../../../../store/store';\nimport { newCardMaker } from '../../../../../store/actionCreators/cardMakerActionCreators';\nimport NavButton from '../NavButton/NavButton';\nimport Modal from '../../../../modal/Modal';\n\ntype NewProjectButtonProps = {\n  newCardMaker: () => void,\n}\n\nfunction NewProjectButton(props: NewProjectButtonProps) {\n  const [isModal, setModal] = useState(false)\n  const onClose = () => setModal(false)\n  const onAccept = () => {\n    props.newCardMaker();\n    onClose()\n  }\n\n  const content =\n    <>\n      <p>Несохраненные изменения будут потеряны</p>\n      <p>Вы хотите продолжить ?</p>\n    </>\n\n  const footer =\n    <>\n      <button onClick={onAccept}>Да</button>\n      <button onClick={onClose}>Нет</button>\n    </>\n\n\n  return (\n    <>\n      <NavButton label=\"Новая\" icon={faPiedPiperSquare} onClick={() => setModal(true)} />\n      <Modal\n        visible={isModal}\n        title=\"Новая открытка\"\n        content={content}\n        footer={footer}\n        onClose={onClose}\n      />\n    </>\n  );\n}\n\nconst mapDispatchToProps = (dispatch: AppDispatch) => {\n  return {\n    newCardMaker: () => dispatch(newCardMaker()),\n  }\n}\n\nexport default connect(null, mapDispatchToProps)(NewProjectButton);","import { CardMaker } from '../types';\n\nexport function newCardMaker() {\n  return {\n    type: 'NEW_CARD_MAKER',\n  }\n}\n\nexport function applyFileProject(cardMaker: CardMaker) {\n  return {\n    type: 'APPLY_FILE_PROJECT',\n    project: cardMaker,\n  }\n}\n","\nimport { store } from \"../store/store\";\nimport { Text, Block, BlockTypes } from \"../store/types\";\n\nexport async function exportImg(type: string): Promise<void> {\n\n  const elements = store.getState().canvas.listBlock;\n  const deleteAreas = store.getState().canvas.deleteArea;\n\n  const width = store.getState().canvas.width;\n  const height = store.getState().canvas.height;\n  const background = store.getState().canvas.background;\n  const filter = store.getState().canvas.filter;\n\n  const canvas = document.createElement('canvas');\n  canvas.width = width;\n  canvas.height = height;\n  const ctx = canvas.getContext('2d') as CanvasRenderingContext2D;\n\n  // рендер фона\n  if (background.src) {\n    const img = new Image();\n    img.crossOrigin = 'anonymous'\n    img.src = background.src;\n    await img.decode();\n\n    let imgWidth = img.width;\n    let imgHeight = img.height;\n    \n    if (img.width < width) {\n      imgHeight = (img.height * width) / img.width;\n      imgWidth = (img.width * imgHeight) / img.height;\n    }\n\n    if (img.height < height) {\n      imgWidth = (img.width * height) / img.height;\n      imgHeight = (img.height * imgWidth) / img.width;\n    }\n    ctx.drawImage(img, 0, 0, imgWidth, imgHeight);\n  } else if (background.color) {\n    ctx.fillStyle = background.color;\n    ctx.fillRect(0, 0, width, height);\n  }\n\n  // рендер блоков\n  for (let index = 0; index < elements.length; index++) {\n    await renderBlock(elements[index], ctx);\n  }\n\n  // рендер фильтра\n  const color = convertColor(filter.color);\n  ctx.fillStyle = `rgba(${color.r}, ${color.g}, ${color.b}, ${filter.opacity})`;\n  ctx.fillRect(0, 0, width, height);\n\n\n  ctx.fillStyle = '#ffffff';\n  deleteAreas.forEach(element => {\n    ctx.fillRect(element.x, element.y, element.width, element.height);\n  });\n\n  const dataURL = canvas.toDataURL(type);\n  const link = document.createElement(\"a\");\n  link.href = dataURL;\n  link.download = \"new-image\";\n  link.click();\n}\n\nasync function renderBlock(element: Block, ctx: CanvasRenderingContext2D) {\n  \n  // стандартный сдвиг объекта\n  const defShiftX = 5\n\n  // высота строки\n  const lineHeight = 1.2;\n\n  switch (element.type) {\n\n    // рендер текста\n    case BlockTypes.text:\n      const style = getStyle(element);\n      const textBlock = document.createElement('div');\n      textBlock.innerHTML = element.text;\n      // сдивг строки\n      let shift = 0;\n\n      // отрисовка строк\n      for (let str of Array.from(textBlock.children) as HTMLDivElement[]) {\n\n        ctx.fillStyle = style.color;\n        ctx.font = style.italic + ' ' + style.weight + ' ' + style.size + 'px ' + style.family;\n        ctx.fillText(str.innerText, element.x + defShiftX, element.y + shift + style.size);\n        // подчеркивание\n        if (element.underline) {\n          const textWidth = ctx.measureText(str.innerText).width;\n          let chars = 0;\n          let underline = '';\n          while (str.innerText.length > chars) {\n            underline += '_';\n            chars++;\n          }\n          ctx.font = `700 ${style.size}px openSans`;\n          ctx.fillText(underline, element.x + defShiftX, element.y + shift + style.size, textWidth);\n        }\n        shift += element.size * lineHeight;\n      }\n\n      break;\n\n    // рендер изображения\n    case BlockTypes.img:\n      const img = new Image();\n      img.crossOrigin = 'anonymous'\n      img.src = element.src;\n\n      await img.decode();\n      ctx.drawImage(img, element.x, element.y, element.width, element.height);\n      break;\n\n    // рендер арт-объекта\n    case BlockTypes.artObj:\n      const artObj = new Image();\n      artObj.crossOrigin = 'anonymous'\n      artObj.src = element.src;\n\n      await artObj.decode();\n      ctx.drawImage(artObj, element.x, element.y, element.width, element.height)\n      break;\n  }\n}\n\n// формирование стилей для текстового блока\nfunction getStyle(text: Text) {\n  return {\n    x: text.x,\n    y: text.y,\n    color: text.color,\n    size: text.size,\n    weight: text.bold ? '700' : '',\n    italic: text.italic ? 'italic' : '',\n    family: text.fontFamily,\n  };\n}\n\nexport type RGB = {\n  r: number,\n  g: number,\n  b: number\n}\n\n// конвертирование hex в rgb\nfunction convertColor(color: string): RGB {\n  if (color.substring(0, 1) === '#') {\n    color = color.substring(1);\n  }\n  const rgbColor: RGB = {\n    r: 255,\n    g: 255,\n    b: 255,\n  };\n  rgbColor.r = parseInt(color.substring(0, 2), 16);\n  rgbColor.g = parseInt(color.substring(2, 4), 16);\n  rgbColor.b = parseInt(color.substring(4), 16);\n  return rgbColor;\n}","import { faImage } from '@fortawesome/free-solid-svg-icons'\nimport { connect } from 'react-redux';\nimport { useRef, useState } from 'react';\nimport NavButton from '../NavButton/NavButton';\nimport Modal from '../../../../modal/Modal';\nimport { exportImg } from \"../../../../../utils/exportImg\";\n\nfunction ExportImgButton() {\n\n  const downloadImg = useRef<HTMLButtonElement>(null);\n\n  const [isModal, setModal] = useState(false)\n  const onClose = () => setModal(false)\n\n  const onAcceptJpg = () => {\n    exportImg('image/jpeg');\n    onClose();\n  }\n\n  const onAcceptPng = () => {\n    exportImg('image/png');\n    onClose();\n  }\n\n  const content =\n    <>\n      <p>Выберите формат сохраняемого файла</p>\n    </>\n\n  const footer =\n    <>\n      <button onClick={onAcceptJpg}>jpg</button>\n      <button onClick={onAcceptPng}>png</button>\n      <button onClick={onClose}>Отмена</button>\n    </>\n\n\n  return (\n    <>\n      <NavButton label=\"В jpg/png\" icon={faImage} onClick={() => setModal(true)} ref={downloadImg} />\n      <Modal\n        visible={isModal}\n        title=\"Сохранить как...\"\n        content={content}\n        footer={footer}\n        onClose={onClose}\n      />\n    </>\n  );\n}\n\nexport default connect()(ExportImgButton);","import styles from './Navbar.module.css';\nimport { faClone, faUndo, faRedo, faFileExport, faFolderOpen } from '@fortawesome/free-solid-svg-icons'\nimport NavButton from './navButton/NavButton/NavButton';\nimport NavFileButton from './navButton/NavFileButton/NavFileButton';\nimport { useRef } from 'react';\nimport { useImportFileProject } from './useImportFileProject';\nimport { useStateHistory } from './useStateHistory';\nimport { connect } from 'react-redux';\nimport { undo, redo } from '../../../store/actionCreators/historyActionCreators';\nimport { applyFileProject } from '../../../store/actionCreators/cardMakerActionCreators';\nimport { CardMaker as CardMakerType } from '../../../store/types';\nimport { AppDispatch } from '../../../store/store';\nimport { useExportFileProject } from './useExportFileProject';\nimport NewProjectButton from './navButton/NewProjectButton/NewProjectButton';\nimport ExportImgButton from './navButton/ExportImgButton/ExportImgButton';\n\ntype NavbarProps = {\n  undo: () => void,\n  redo: () => void,\n  applyFileProject: (file: CardMakerType) => void,\n}\n\nfunction Navbar(props: NavbarProps) {\n  const buttonUndo = useRef<HTMLButtonElement>(null);\n  const buttonRedo = useRef<HTMLButtonElement>(null);\n  useStateHistory(\n    buttonUndo,\n    buttonRedo,\n    props.undo,\n    props.redo,\n  );\n\n  const inputFile = useRef<HTMLInputElement>(null);\n  const downloadFile = useRef<HTMLButtonElement>(null);\n\n  useImportFileProject(inputFile, props.applyFileProject);\n  useExportFileProject(downloadFile);\n\n  return (\n    <>\n      <nav className={styles.navbar}>\n        <NavFileButton label=\"Открыть\" icon={faFolderOpen} ref={inputFile} />\n        <NewProjectButton />\n        <ExportImgButton />\n        <NavButton label=\"в json\" icon={faFileExport} ref={downloadFile} onClick={null} />\n        <NavButton label=\"Шаблоны\" icon={faClone} onClick={null} />\n        <NavButton label=\"\" icon={faUndo} ref={buttonUndo} onClick={null} />\n        <NavButton label=\"\" icon={faRedo} ref={buttonRedo} onClick={null} />\n      </nav>\n    </>\n  );\n}\nconst mapDispatchToProps = (dispatch: AppDispatch) => {\n  return {\n    undo: () => dispatch(undo()),\n    redo: () => dispatch(redo()),\n    applyFileProject: (file: CardMakerType) => dispatch(applyFileProject(file)),\n  }\n}\n\nexport default connect(null, mapDispatchToProps)(Navbar);\n","import { RefObject, useEffect } from 'react';\nimport { verify } from '../../../utils/permisions';\n\nexport function useStateHistory(\n  buttonUndo: RefObject<HTMLButtonElement>,\n  buttonRedo: RefObject<HTMLButtonElement>,\n  undo: () => void,\n  redo: () => void,\n): void {\n\n\n  useEffect(() => {\n\n    const btnUndo = buttonUndo.current;\n    const btnRedo = buttonRedo.current;\n\n    function handlerClickUndo(): void {\n      undo();\n    }\n  \n    function handlerClickRedo(): void {\n      redo();\n    }\n  \n    function handlerKeydown(event: KeyboardEvent): void {\n      if (event.code === 'KeyZ' && (event.ctrlKey || event.metaKey)) {\n        undo();\n      }\n      if (event.code === 'KeyY' && (event.ctrlKey || event.metaKey)) {\n        redo();\n      }\n    }\n    \n    \n    verify(btnUndo).addEventListener(\"click\", handlerClickUndo);\n    verify(btnRedo).addEventListener(\"click\", handlerClickRedo);\n    document.addEventListener(\"keydown\", handlerKeydown);\n    return () => {\n      if (btnUndo) btnUndo.removeEventListener(\"click\", handlerClickUndo);\n      if (btnRedo) btnRedo.removeEventListener(\"click\", handlerClickRedo);\n      document.removeEventListener(\"keydown\", handlerKeydown);\n    };\n  }, [buttonUndo, buttonRedo, undo, redo]);\n}","import { RefObject, useEffect } from 'react';\nimport { store } from '../../../store/store';\nimport { verify } from '../../../utils/permisions';\n\nexport function useExportFileProject(downloadButton: RefObject<HTMLButtonElement>): void {\n\n  useEffect(() => {\n\n    const button = downloadButton.current;\n\n    function handlerClickSaveToJson(event: Event): void {\n      const cardMaker = store.getState();\n      const json = JSON.stringify({\n        ...cardMaker,\n        history: {\n          listState: [cardMaker.canvas],\n          currentIndex: 0,\n        }\n      });\n      const file = new Blob([json], { type: 'application/json' });\n      let link = document.createElement(\"a\");\n      link.href = URL.createObjectURL(file);\n      link.download = \"Новый проект.json\";\n      link.click();\n    }\n\n    \n    verify(button).addEventListener(\"click\", handlerClickSaveToJson);\n    return () => {\n      if (button) button.removeEventListener(\"click\", handlerClickSaveToJson);\n    };\n  }, [downloadButton]);\n}","import { getProjectFromFile } from '../../../utils/files';\nimport { RefObject, useEffect } from 'react';\nimport { CardMaker as CardMakerType } from '../../../store/types';\nimport { verify } from '../../../utils/permisions';\n\nexport function useImportFileProject(\n  inputFile: RefObject<HTMLInputElement>,\n  applyFileProject: (file: CardMakerType) => void): void {\n\n  useEffect(() => {\n\n    const input = inputFile.current;\n\n    async function handlerChangeInputFile(event: Event): Promise<void> {\n      const target = event.target as HTMLInputElement;\n      const files = target.files as FileList;\n      applyFileProject(await getProjectFromFile(files[0]))\n      target.value = '';\n    }\n\n    \n    verify(input).addEventListener(\"change\", handlerChangeInputFile);\n    return () => {\n      if (input) input.removeEventListener(\"change\", handlerChangeInputFile);\n    };\n  }, [inputFile, applyFileProject]);\n}","import { store } from '../store';\n\nexport function createTextBlock() {\n  return {\n    type: 'CREATE_TEXT_BLOCK',\n    x: store.getState().canvas.width / 2,\n    y: store.getState().canvas.height / 2,\n  }\n}\n\nexport function setTextInTextBlock(text: string) {\n  return {\n    type: 'SET_TEXT_IN_TEXT_BLOCK',\n    id: store.getState().selectBlock,\n    text: text,\n  }\n}\n\nexport function setFontFamilyText(fontFamily: string) {\n  return {\n    type: 'SET_FONT_FAMILY_TEXT',\n    id: store.getState().selectBlock,\n    fontFamily: fontFamily,\n  }\n}\n\nexport function setBoldText(isBold: boolean) {\n  return {\n    type: 'SET_BOLD_TEXT',\n    id: store.getState().selectBlock,\n    isBold: isBold,\n  }\n}\n\nexport function setItalicText(isItalic: boolean) {\n  return {\n    type: 'SET_ITALIC_TEXT',\n    id: store.getState().selectBlock,\n    isItalic: isItalic,\n  }\n}\n\nexport function setUnderlineText(isUnderline: boolean) {\n  return {\n    type: 'SET_UNDERLINE_TEXT',\n    id: store.getState().selectBlock,\n    isUnderline: isUnderline,\n  }\n}\n\nexport function setSizeText(size: number) {\n  return {\n    type: 'SET_SIZE_TEXT',\n    id: store.getState().selectBlock,\n    size: size,\n  }\n}\n\nexport function inputColorText(color: string) {\n  return {\n    type: 'INPUT_COLOR_TEXT',\n    color: color,\n  }\n}\n\nexport function inputSizeText(size: number) {\n  return {\n    type: 'INPUT_SIZE_TEXT',\n    size: size,\n  }\n}\n\nexport function setColorText(color: string) {\n  return {\n    type: 'SET_COLOR_TEXT',\n    id: store.getState().selectBlock,\n    color: color,\n  }\n}","import styles from './ButtonEditText.module.css';\nimport { IconDefinition } from '@fortawesome/fontawesome-svg-core';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { useRef } from 'react';\nimport { connect } from 'react-redux';\nimport { useEditStateText } from './useEditStateText';\n\ntype ButtonEditTextProps = {\n  icon: IconDefinition,\n  enabled: boolean | null,\n  modifyFn: ((enabled: boolean) => void) | (() => void),\n  param: boolean,\n}\n\nfunction ButtonEditText(props: ButtonEditTextProps) {\n  const button = useRef<HTMLButtonElement>(null);\n\n  useEditStateText(button, props.enabled,  props.modifyFn, props.param);\n\n  return (\n    <button className={styles.button + ' ' + (props.enabled ? styles.active : '')} ref={button}>\n      <FontAwesomeIcon icon={props.icon} />\n    </button>\n  );\n};\n\n\nexport default connect()(ButtonEditText);","import { RefObject, useEffect } from \"react\";\nimport { verify } from \"../../../../../utils/permisions\";\n\nexport function useEditStateText(\n  button: RefObject<HTMLButtonElement>,\n  enabled: boolean | null,\n  modifyFn: (() => void) | ((enabled: boolean) => void),\n  param: boolean) {\n\n  useEffect(() => {\n\n    const btn = button.current;\n\n    function handleClickButton(event: Event) {\n      if (enabled !== null) {\n        modifyFn(!enabled)\n        event.preventDefault();\n      } else if (!param) {\n        modifyFn(true)\n      }\n    }\n\n\n    verify(btn).addEventListener(\"click\", handleClickButton);\n    return () => {\n      if (btn) btn.removeEventListener(\"click\", handleClickButton);\n    };\n  }, [button, modifyFn, enabled, param]);\n}","import styles from './ColorPicker.module.css';\nimport { useRef } from 'react';\nimport { connect } from 'react-redux';\nimport { AppDispatch, RootState } from '../../../../../store/store';\nimport { inputColorText, setColorText } from '../../../../../store/actionCreators/textBlockActionCreators';\nimport { useEditColorText } from './useEditColorText';\n\ntype ColorPickerProps = {\n  setColorText: (color: string) => void,\n  inputColorText: (color: string) => void,\n  color: string | null\n}\n\nfunction ColorPicker(props: ColorPickerProps) {\n  const colorPicker = useRef<HTMLInputElement>(null);\n  useEditColorText(props.color, colorPicker, props.setColorText, props.inputColorText);\n  return (\n    <input type=\"color\"\n      ref={colorPicker}\n      className={styles.input}\n    />\n  );\n}\n\nfunction mapStateToProps(state: RootState) {\n  return {\n    color: state.viewModel.text.color,\n  }\n};\n\nconst mapDispatchToProps = (dispatch: AppDispatch) => {\n  return {\n    setColorText: (color: string) => dispatch(setColorText(color)),\n    inputColorText: (color: string) => dispatch(inputColorText(color)),\n  }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(ColorPicker);\n","import { RefObject, useEffect } from \"react\";\nimport { verify } from \"../../../../../utils/permisions\";\n\nexport function useEditColorText(\n  color: string | null,\n  colorPicker: RefObject<HTMLInputElement>,\n  setColorText: (color: string) => void,\n  inputColorText: (color: string) => void) {\n\n  useEffect(() => {\n\n    const inputColor = colorPicker.current;\n\n    verify(inputColor).value = color ? color : '#000000';\n\n    function handleInput(event: Event) {\n      const target = event.target as HTMLOptionElement;\n      inputColorText(target.value);\n    }\n  \n    function handleChange(event: Event) {\n      const target = event.target as HTMLOptionElement;\n      setColorText(target.value);\n    }\n    \n    function handleClick(event: Event) {\n      event.stopImmediatePropagation();\n    }\n\n\n    verify(inputColor).addEventListener(\"input\", handleInput);\n    verify(inputColor).addEventListener(\"change\", handleChange);\n    verify(inputColor).addEventListener(\"click\", handleClick);\n    return () => {\n      if (inputColor) {\n        inputColor.removeEventListener(\"input\", handleInput);\n        inputColor.removeEventListener(\"change\", handleChange);\n        inputColor.removeEventListener(\"click\", handleClick);\n      }\n    };\n  }, [color, colorPicker, setColorText, inputColorText]);\n}","import styles from './InputNumber.module.css';\nimport { connect } from 'react-redux';\nimport { useEditFontSize } from './useEditFontSize';\nimport { useRef } from 'react';\nimport { AppDispatch, RootState } from '../../../../../store/store';\nimport { inputSizeText, setSizeText } from '../../../../../store/actionCreators/textBlockActionCreators';\n\ntype InputNumberProps = {\n  size: number | null,\n  tempSize: number | null,\n  setSizeText: (size: number) => void,\n  inputSizeText: (size: number) => void,\n}\n\nfunction InputNumber(props: InputNumberProps) {\n  const inputNumber = useRef<HTMLInputElement>(null);\n  useEditFontSize(props.size, inputNumber, props.setSizeText, props.inputSizeText);\n  \n\n  return (\n    <input type=\"number\"\n      ref={inputNumber}\n      className={styles.input__number}\n      min={10}\n      max={150}\n      step={1}\n    />\n  )\n}\n\nfunction mapStateToProps(state: RootState) {\n  return {\n    size: state.viewModel.text.size,\n    tempSize: state.viewModel.text.tempSize,\n  }\n};\n\nconst mapDispatchToProps = (dispatch: AppDispatch) => {\n  return {\n    setSizeText: (size: number) => dispatch(setSizeText(size)),\n    inputSizeText: (size: number) => dispatch(inputSizeText(size))\n  }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(InputNumber);\n","import { RefObject, useEffect } from \"react\";\nimport { verify } from \"../../../../../utils/permisions\";\n\nexport function useEditFontSize(\n  size: number | null,\n  input: RefObject<HTMLInputElement>,\n  setSizeText: (size: number) => void,\n  inputSizeText: (size: number) => void) {\n\n  useEffect(() => {\n\n    const fieldSize = input.current;\n\n    verify(fieldSize).value = size ? String(size) : \"10\";\n\n    function handleInput(event: Event) {\n      const target = event.target as HTMLOptionElement;\n      inputSizeText(Number(target.value));\n    }\n  \n    function handleBlur(event: Event) {\n      const target = event.target as HTMLOptionElement;\n      setSizeText(Number(target.value));\n    }\n    \n    function handleClick(event: Event) {\n      event.stopImmediatePropagation();\n    }\n\n\n    verify(fieldSize).addEventListener(\"input\", handleInput);\n    verify(fieldSize).addEventListener(\"blur\", handleBlur);\n    verify(fieldSize).addEventListener(\"click\", handleClick);\n    return () => {\n      if (fieldSize) {\n        fieldSize.removeEventListener(\"input\", handleInput);\n        fieldSize.removeEventListener(\"blur\", handleBlur);\n        fieldSize.removeEventListener(\"click\", handleClick);\n      }\n    };\n  }, [size, input, setSizeText, inputSizeText]);\n}","import { connect } from 'react-redux';\nimport { AppDispatch, RootState } from '../../../../../store/store';\nimport styles from './SelectFontFamily.module.css';\nimport { useRef } from 'react';\nimport { useSelectFont } from './useSelectFont';\nimport { setFontFamilyText } from '../../../../../store/actionCreators/textBlockActionCreators';\n\ntype SelectFontFamilyProps = {\n  fontFamily: string | null\n  setFontFamilyText: (fontFamily: string) => void,\n}\n\nfunction SelectFontFamily(props: SelectFontFamilyProps) {\n  const select = useRef<HTMLSelectElement>(null);\n\n  useSelectFont(select, props.setFontFamilyText);\n\n  const listParameters = [\n    { value: 'Fantazyor', class: styles.fantazyor },\n    { value: 'Piroucyrillic', class: styles.piroucyrillic },\n    { value: 'Phenomena', class: styles.phenomena },\n    { value: 'Sunday', class: styles.sunday },\n    { value: 'Kurale', class: styles.kurale },\n    { value: 'Sensei', class: styles.sensei },\n    { value: 'Borsok', class: styles.borsok },\n    { value: 'Summer', class: styles.summer },\n    { value: 'Underdog', class: styles.underdog },\n    { value: 'Montserrat', class: styles.montserrat },\n    { value: 'OpenSans', class: styles.openSans },\n    { value: 'Comfortaa', class: styles.comfortaa },\n    { value: 'Rubik', class: styles.rubik },\n    { value: 'Marta', class: styles.marta },\n  ]\n\n  let fontFamilies: JSX.Element[] = listParameters.map((element, index) => {\n    return <option key={index} className={element.class} value={element.value}>{element.value}</option>\n  })\n\n  let currentStyle: string = fontFamilies[0].props.className;\n\n  fontFamilies = fontFamilies.map((element: JSX.Element) => {\n    if (element.props.value === props.fontFamily) {\n      currentStyle = element.props.className;\n      return {\n        ...element,\n        props: {\n          ...element.props,\n          selected: true\n        }\n      }\n    } else {\n      return element\n    }\n  });\n\n  return (\n    <select name=\"\" id=\"\" className={styles.select + ' ' + currentStyle} ref={select}>\n      {fontFamilies}\n    </select>\n  );\n}\n\nfunction mapStateToProps(state: RootState) {\n  let fontFamily: string | null = null;\n  if (state.viewModel.text?.fontFamily) {\n    fontFamily = state.viewModel.text.fontFamily;\n  }\n  return {\n    fontFamily: fontFamily\n  }\n};\n\nconst mapDispatchToProps = (dispatch: AppDispatch) => {\n  return {\n    setFontFamilyText: (fontFamily: string) => dispatch(setFontFamilyText(fontFamily)),\n  }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(SelectFontFamily);","import { RefObject, useEffect } from \"react\";\nimport { verify } from \"../../../../../utils/permisions\";\n\nexport function useSelectFont(\n  select: RefObject<HTMLSelectElement>,\n  setFontFamilyText: (fontFamily: string) => void) {\n\n  useEffect(() => {\n\n    const selectFontFamily = select.current;\n    \n    function handleClick(event: Event) {\n      event.stopImmediatePropagation();\n    }\n\n    function handleChange(event: Event) {\n      const target = event.target as HTMLOptionElement;\n      setFontFamilyText(target.value);\n    }\n\n    \n    verify(selectFontFamily).addEventListener(\"click\", handleClick);\n    verify(selectFontFamily).addEventListener(\"change\", handleChange);\n    return () => {\n      if (selectFontFamily) {\n        selectFontFamily.removeEventListener(\"click\", handleClick);\n        selectFontFamily.removeEventListener(\"change\", handleChange);\n      }\n    };\n  }, [select, setFontFamilyText]);\n}","import styles from './ToolbarText.module.css';\nimport { faBold, faItalic, faUnderline, faFont } from '@fortawesome/free-solid-svg-icons'\nimport { connect } from 'react-redux';\nimport { AppDispatch, RootState } from '../../../../store/store';\nimport { createTextBlock, setBoldText, setItalicText, setUnderlineText } from '../../../../store/actionCreators/textBlockActionCreators';\nimport ButtonEditText from './buttonEditText/ButtonEditText';\nimport ColorPicker from './colorPicker/ColorPicker';\nimport InputNumber from './inputNumber/InputNumber';\nimport SelectFontFamily from './selectFontFamily/SelectFontFamily';\n\n\ntype ToolbarTextProps = {\n  createTextBlock: () => void,\n  setBoldText: (isBold: boolean) => void,\n  setItalicText: (isItalic: boolean) => void,\n  setUnderlineText: (isUnderline: boolean) => void,\n  bold: boolean | null,\n  italic: boolean | null,\n  underline: boolean | null,\n}\n\nfunction ToolbarText(props: ToolbarTextProps) {\n  return (\n    <div className={styles.toolbar}>\n\n      <div className={styles.toolbar__row}>\n        <SelectFontFamily />\n        <ButtonEditText icon={faFont} enabled={null} modifyFn={props.createTextBlock} param={false} />\n      </div>\n\n      <div className={styles.toolbar__row}>\n        <InputNumber />\n\n        <ButtonEditText icon={faBold} enabled={props.bold} modifyFn={props.setBoldText}  param={true}/>\n        <ButtonEditText icon={faItalic} enabled={props.italic} modifyFn={props.setItalicText}  param={true}/>\n        <ButtonEditText icon={faUnderline} enabled={props.underline} modifyFn={props.setUnderlineText}  param={true}/>\n        <div className={styles.colorPickerBox}>\n          <ColorPicker />\n        </div>\n      </div>\n\n      <label className={styles.toolbar__label}>Текст</label>\n    </div>\n  );\n}\n\nfunction mapStateToProps(state: RootState) {\n  return {\n    bold: state.viewModel.text.bold,\n    italic: state.viewModel.text.italic,\n    underline: state.viewModel.text.underline,\n  }\n};\n\nconst mapDispatchToProps = (dispatch: AppDispatch) => {\n  return {\n    createTextBlock: () => dispatch(createTextBlock()),\n    setBoldText: (isBold: boolean) => dispatch(setBoldText(isBold)),\n    setItalicText: (isItalic: boolean) => dispatch(setItalicText(isItalic)),\n    setUnderlineText: (isUnderline: boolean) => dispatch(setUnderlineText(isUnderline)),\n  }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(ToolbarText);\n","import styles from './DropdownMenu.module.css';\nimport { IconDefinition } from '@fortawesome/fontawesome-svg-core';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { connect } from 'react-redux';\n\ntype DropdownMenuProps = {\n  label: string,\n  icon: IconDefinition,\n  content: React.ReactElement[],\n}\nfunction DropdownMenu(props: DropdownMenuProps) {\n  return (\n    <div className={styles.dropdown}>\n      <button className={styles.dropbtn}>\n        <FontAwesomeIcon icon={props.icon} size=\"lg\" />\n        {props.label !== '' &&\n          <span className={styles.dropdown_text}>{props.label}</span>\n        }\n      </button>\n      <div className={styles.dropdown_content}>\n        {props.content}\n      </div>\n    </div>\n  );\n}\n\nexport default connect()(DropdownMenu);\n","import styles from './AddImgButton.module.css';\nimport { IconDefinition } from '@fortawesome/fontawesome-svg-core';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { ForwardedRef, forwardRef } from 'react';\nimport { connect } from 'react-redux';\n\ntype NavButtonProps = {\n  label: string,\n  title: string,\n  icon: IconDefinition,\n}\n\nconst AddImgButton = forwardRef((props: NavButtonProps, ref: ForwardedRef<HTMLButtonElement>) => (\n  <button\n    ref={ref}\n    className={styles.button}\n    title={props.title}>\n    <FontAwesomeIcon icon={props.icon} size=\"lg\" />\n    {props.label !== '' &&\n      <span className={styles.button__text}>{props.label}</span>\n    }\n  </button>\n));\n\nexport default connect(null, null, null, { forwardRef: true })(AddImgButton);","import styles from './AddImgButtonFile.module.css';\nimport { IconDefinition } from '@fortawesome/fontawesome-svg-core';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { ForwardedRef, forwardRef } from 'react';\nimport { connect } from 'react-redux';\n\ntype NavButtonProps = {\n  label: string,\n  title: string,\n  icon: IconDefinition,\n}\n\nconst AddImgButton = forwardRef((props: NavButtonProps, ref: ForwardedRef<HTMLInputElement>) => (\n  <button className={styles.button}>\n    <label htmlFor=\"input-file-img\" className={styles.icon}>\n      <FontAwesomeIcon icon={props.icon} size=\"lg\" />\n    </label>\n    <input\n      className={styles.inputFile}\n      type=\"file\"\n      ref={ref}\n      id=\"input-file-img\"\n    />\n    {props.label !== '' &&\n      <label className={styles.button__text}\n        htmlFor=\"input-file-img\">\n        {props.label}\n      </label>\n    }\n  </button>\n));\n\nexport default connect(null, null, null, { forwardRef: true })(AddImgButton);","import styles from './PreviewArtObj.module.css';\nimport { useCreateArtObj } from './useCreateArtObj';\nimport { useRef } from 'react';\nimport { connect } from 'react-redux';\nimport { AppDispatch } from '../../../../../store/store';\nimport { createArtObjBlock } from '../../../../../store/actionCreators/artObjBlockActionCreators';\n\ntype PreviewArtObjProps = {\n  src: string,\n  createArtObjBlock: (src: string) => void,\n}\n\nfunction PreviewArtObj(props: PreviewArtObjProps) {\n\n  const img = useRef<HTMLImageElement>(null);\n  useCreateArtObj(img, props.src, props.createArtObjBlock);\n  return (\n    <img src={props.src} alt='' ref={img} className={styles.sticker} />\n  );\n}\n\nconst mapDispatchToProps = (dispatch: AppDispatch) => {\n  return {\n    createArtObjBlock: (src: string) => dispatch(createArtObjBlock(src)),\n  }\n}\n\nexport default connect(null, mapDispatchToProps)(PreviewArtObj);","import { store } from \"../store\";\n\nexport function createArtObjBlock(src: string) {\n  return {\n    type: 'CREATE_ART_OBJ_BLOCK',\n    src: src,\n    x: (store.getState().canvas.width / 2) - 75,\n    y: (store.getState().canvas.height / 2) - 75,\n  }\n}\n","import { RefObject, useEffect } from \"react\";\nimport { verify } from \"../../../../../utils/permisions\";\n\nexport function useCreateArtObj(\n  artObj: RefObject<HTMLElement>,\n  src: string,\n  createArtObjBlock: (src: string) => void) {\n\n  useEffect(() => {\n\n    const artObjPreview = artObj.current;\n\n    function handleClickArtObj() {\n      createArtObjBlock(src);\n    }\n\n\n    verify(artObjPreview).addEventListener(\"click\", handleClickArtObj);\n    return () => {\n      if (artObjPreview) artObjPreview.removeEventListener(\"click\", handleClickArtObj);\n    };\n  }, [artObj, src, createArtObjBlock]);\n}","import styles from './ToolbarImg.module.css';\nimport { faDownload, faGlobe, faStickyNote } from '@fortawesome/free-solid-svg-icons'\nimport DropdownMenu from '../../../dropdownMenu/DropdownMenu';\nimport AddImgButton from './addImgButton/AddImgButton';\nimport AddImgButtonFile from './addImgButtonFile/AddImgButtonFile';\nimport PreviewArtObj from './previewArtObj/PreviewArtObj';\nimport { SetOfArtObject } from '../../../../store/types';\nimport { useCreateImg } from './useCreateImg';\nimport { ReactElement } from 'react';\nimport { useRef } from 'react';\nimport { connect } from 'react-redux';\nimport { AppDispatch } from '../../../../store/store';\nimport { createImgBlock } from '../../../../store/actionCreators/imgBlockActionCreators';\n\ntype ToolbarImgProps = {\n  createImgBlock: (src: string, width: number, height: number) => void,\n}\n\nfunction ToolbarImg(props: ToolbarImgProps) {\n\n  // формирование списка стикеров\n  let srcList: SetOfArtObject[] = Object.values(SetOfArtObject);\n  let imgList: ReactElement[] = [];\n  srcList.forEach((src, index) => {\n    imgList.push(<PreviewArtObj src={src} key={index} />);\n  });\n\n  const inputFile = useRef<HTMLInputElement>(null);\n\n  useCreateImg(inputFile, props.createImgBlock);\n  return (\n    <div className={styles.toolbar}>\n      <div className={styles.button_box}>\n        <AddImgButtonFile label=\"\" title=\"C компьютера\" icon={faDownload} ref={inputFile} />\n        <AddImgButton label=\"\" title=\"Из Pixels\" icon={faGlobe} />\n        <DropdownMenu label=\"\" icon={faStickyNote} content={imgList} />\n      </div>\n      <label className={styles.toolbar__label}>Изображения</label>\n    </div>\n  );\n}\n\nconst mapDispatchToProps = (dispatch: AppDispatch) => {\n  return {\n    createImgBlock: (src: string, width: number, height: number) => dispatch(createImgBlock(src, width, height)),\n  }\n}\n\nexport default connect(null, mapDispatchToProps)(ToolbarImg);\n","import { store } from \"../store\"\nexport function createImgBlock(src: string, width: number, height: number) {\n  return {\n    type: 'CREATE_IMG_BLOCK',\n    src: src,\n    width: width,\n    height: height,\n    x: (store.getState().canvas.width / 2) - (width / 2),\n    y: (store.getState().canvas.height / 2) - (height / 2),\n  }\n}","import { RefObject, useEffect } from \"react\";\nimport { getImgInformationFromFile } from '../../../../utils/files';\nimport { verify } from \"../../../../utils/permisions\";\n\nexport function useCreateImg(\n  inputFile: RefObject<HTMLElement>,\n  createImgBlock: (src: string, width: number, height: number) => void) {\n\n  useEffect(() => {\n\n    const fieldFile = inputFile.current;\n\n    async function handlerChangeInput(event: Event): Promise<void> {\n      const target = event.target as HTMLInputElement;\n      const files = target.files as FileList;\n      const imgInfo = await getImgInformationFromFile(files[0]);\n      createImgBlock(imgInfo.src, imgInfo.width, imgInfo.height);\n      target.value = '';\n    }\n\n\n    verify(fieldFile).addEventListener(\"change\", handlerChangeInput);\n    return () => {\n      if (fieldFile) fieldFile.removeEventListener(\"change\", handlerChangeInput);\n    };\n  }, [inputFile, createImgBlock]);\n}","import styles from './ColorPicker.module.css';\nimport { ForwardedRef, forwardRef } from 'react';\nimport { connect } from 'react-redux';\n\nconst ColorPicker = forwardRef((props: {}, ref: ForwardedRef<HTMLInputElement>) => (\n  <input type=\"color\"\n    ref={ref}\n    className={styles.input__color}\n  />\n));\n\nexport default connect(null, null, null, { forwardRef: true })(ColorPicker);\n","import { store } from \"../store\"\n\nexport function setCanvasSize(width: number, height: number) {\n  return {\n    type: 'SET_CANVAS_SIZE',\n    width: width,\n    height: height,\n  }\n}\n\nexport function setFilter(color: string, opacity: number) {\n  return {\n    type: 'SET_FILTER',\n    color: color,\n    opacity: opacity,\n  }\n}\n\nexport function setBackgroundColor(color: string) {\n  return {\n    type: 'SET_BACKGROUND_COLOR',\n    color: color,\n  }\n}\n\nexport function setBackgroundImg(src: string) {\n  return {\n    type: 'SET_BACKGROUND_IMG',\n    src: src,\n  }\n}\n\nexport function resetBackground() {\n  return {\n    type: 'RESET_BACKGROUND',\n  }\n}\n\nexport function inputBackgroundColor(color: string) {\n  return {\n    type: 'INPUT_BACKGROUND_COLOR',\n    color: color,\n  }\n}\n\nexport function inputBackgroundImg(width: number, height: number, src: string) {\n  return {\n    type: 'INPUT_BACKGROUND_IMG',\n    width: width,\n    height: height,\n    src: src,\n  }\n}\n\nexport function inputCanvasSize(width: number, height: number) {\n  return {\n    type: 'INPUT_CANVAS_SIZE',\n    width: width,\n    height: height,\n  }\n}\n\nexport function inputFilter(color: string, opacity: number) {\n  return {\n    type: 'INPUT_FILTER',\n    color: color,\n    opacity: opacity,\n  }\n}\n\nexport function areaSelection(x: number, y: number, width: number, height: number) {\n  return {\n    type: 'AREA_SELECTION',\n    x: x,\n    y: y,\n    width: width,\n    height: height,\n  }\n}\n\nexport function resetAreaSelection() {\n  return {\n    type: 'RESET_AREA_SELECTION',\n  }\n}\n\nexport function setPositionAreaSelection(x: number, y: number) {\n  return {\n    type: 'SET_POSITION_AREA_SELECTION',\n    x: x,\n    y: y,\n  }\n}\n\nexport function deleteAreaSelection() {\n  return {\n    type: 'DELETE_AREA_SELECTION',\n    area: store.getState().viewModel.areaSelection,\n  }\n}\n","import styles from './ToolbarFilter.module.css';\r\nimport ColorPicker from '../colorPicker/ColorPicker';\r\nimport { RefObject, useRef } from 'react';\r\nimport { useStateFilter } from './useStateFilter';\r\nimport { AppDispatch, RootState } from '../../../../store/store';\r\nimport { inputFilter, setFilter } from '../../../../store/actionCreators/canvasActionCreators';\r\nimport { connect } from 'react-redux';\r\nimport { Filter as FilterType } from '../../../../store/types';\r\n\r\ntype ToolbarFilterProps = {\r\n  inputFilter: (color: string, opacity: number) => void,\r\n  setFilter: (color: string, opacity: number) => void,\r\n  filter: FilterType,\r\n}\r\n\r\nfunction ToolbarFilter(props: ToolbarFilterProps) {\r\n  const inputColor = useRef<HTMLInputElement>(null);\r\n  const inputRange = useRef<HTMLInputElement>(null);\r\n  useStateFilter(\r\n    inputColor,\r\n    inputRange,\r\n    props.inputFilter,\r\n    props.setFilter,\r\n    props.filter\r\n  );\r\n  return (\r\n    <div className={styles.toolbar}>\r\n      <div className={styles.colorPickerBox}>\r\n        <ColorPicker ref={inputColor as RefObject<HTMLInputElement>} />\r\n      </div>\r\n      <input type=\"range\" min=\"0\" max=\"0.2\" step=\"0.025\" className={styles.input_range}\r\n        ref={inputRange}\r\n      />\r\n      <label className={styles.toolbar__label}>Фильтр</label>\r\n    </div>\r\n  );\r\n}\r\n\r\nconst mapStateToProps = (state: RootState) => ({\r\n  filter: state.canvas.filter,\r\n})\r\n\r\nconst mapDispatchToProps = (dispatch: AppDispatch) => {\r\n  return {\r\n    inputFilter: (color: string, opacity: number) => dispatch(inputFilter(color, opacity)),\r\n    setFilter: (color: string, opacity: number) => dispatch(setFilter(color, opacity)),\r\n  }\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(ToolbarFilter);\r\n","import { Filter as FilterType } from '../../../../store/types';\nimport { RefObject, useEffect } from 'react';\nimport { verify } from '../../../../utils/permisions';\n\nexport function useStateFilter(\n  inputColor: RefObject<HTMLInputElement>,\n  inputRange: RefObject<HTMLInputElement>,\n  inputFilter: (color: string, opacity: number) => void,\n  setFilter: (color: string, opacity: number) => void,\n  filter: FilterType): void {\n\n  useEffect(() => {\n\n    const fieldColor = inputColor.current;\n    const fieldRange = inputRange.current;\n\n    verify(fieldColor).value = filter.color;\n    verify(fieldRange).value = String(filter.opacity);\n\n    function handleInputFilter(): void {\n      if (fieldRange && fieldColor) {\n        const color: string = fieldColor.value;\n        const opacity: number = Number(fieldRange.value);\n        inputFilter(color, opacity);\n      }\n    }\n\n    function handleChangeFilter(): void {\n      if (fieldRange && fieldColor) {\n        const opacity: number = Number(fieldRange.value);\n        const color: string = fieldColor.value;\n        setFilter(color, opacity);\n      }\n    }\n\n    verify(fieldColor).addEventListener(\"input\", handleInputFilter);\n    verify(fieldColor).addEventListener(\"change\", handleChangeFilter);\n    verify(fieldRange).addEventListener(\"input\", handleInputFilter);\n    verify(fieldRange).addEventListener(\"change\", handleChangeFilter);\n    return () => {\n      if (fieldColor) {\n        fieldColor.removeEventListener(\"input\", handleInputFilter);\n        fieldColor.removeEventListener(\"change\", handleChangeFilter);\n      }\n      if (fieldRange) {\n        fieldRange.removeEventListener(\"input\", handleInputFilter);\n        fieldRange.removeEventListener(\"change\", handleChangeFilter);\n      }\n    };\n  }, [inputColor, inputRange, inputFilter, setFilter, filter]);\n}","import styles from './FileImgButton.module.css';\nimport { IconDefinition } from '@fortawesome/fontawesome-svg-core';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { useRef, useState } from 'react';\nimport { connect } from 'react-redux';\nimport Modal from '../../../../modal/Modal';\nimport { useBackgroungImg } from '../useBackgroungImg';\nimport { AppDispatch, RootState } from '../../../../../store/store';\nimport {\n  inputBackgroundImg,\n  setBackgroundImg,\n  setCanvasSize\n} from '../../../../../store/actionCreators/canvasActionCreators';\nimport { ViewModelBgImg } from '../../../../../store/types';\n\ntype NavButtonProps = {\n  label: string,\n  title: string,\n  icon: IconDefinition,\n  inputBackgroundImg: (width: number, height: number, src: string) => void,\n  setBackgroundImg: (src: string) => void,\n  setCanvasSize: (width: number, height: number) => void,\n  bgImg: ViewModelBgImg | null,\n}\n\nfunction AddImgButton(props: NavButtonProps): any {\n\n  const inputFile = useRef<HTMLInputElement>(null);\n\n  let [isModal, setModal] = useState(false);\n  const onClose = () => setModal(false);\n\n  useBackgroungImg(inputFile, props.setBackgroundImg, props.inputBackgroundImg, setModal);\n\n  const bg = props.bgImg ?? {\n    width: 0,\n    height: 0,\n    src: '',\n  }\n\n  const onAcceptStretch = () => {\n    props.setBackgroundImg(bg.src);\n    props.setCanvasSize(bg.width, bg.height);\n    onClose();\n  }\n  const onAcceptCrop = () => {\n    props.setBackgroundImg(bg.src);\n    onClose();\n  }\n\n  const content =\n    <>\n      <p>Исходное изображение больше размера холста</p>\n    </>\n\n  const footer =\n    <>\n      <button onClick={onAcceptStretch}>Растянуть холст</button>\n      <button onClick={onAcceptCrop}>Обрезать изображение</button>\n      <button onClick={onClose}>Отмена</button>\n    </>\n\n  return (\n    <>\n      <Modal\n        visible={isModal}\n        title=\"Выберите действие\"\n        content={content}\n        footer={footer}\n        onClose={onClose}\n      />\n      <button className={styles.button} title={props.title}>\n        <label htmlFor=\"input-file-bg-img\" className={styles.icon}>\n          <FontAwesomeIcon icon={props.icon} />\n        </label>\n        <input\n          className={styles.inputFile}\n          type=\"file\"\n          id=\"input-file-bg-img\"\n          ref={inputFile}\n        />\n        {props.label !== '' &&\n          <label className={styles.button__text}\n            htmlFor=\"input-file-bg-img\">\n            {props.label}\n          </label>\n        }\n      </button>\n    </>\n  );\n};\n\nconst mapStateToProps = (state: RootState) => ({\n  bgImg: state.viewModel.bgImg,\n})\n\nconst mapDispatchToProps = (dispatch: AppDispatch) => {\n  return {\n    inputBackgroundImg: (width: number, height: number, src: string) => dispatch(inputBackgroundImg(width, height, src)),\n    setBackgroundImg: (src: string) => dispatch(setBackgroundImg(src)),\n    setCanvasSize: (width: number, height: number) => dispatch(setCanvasSize(width, height)),\n  }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(AddImgButton);","import { RefObject, useEffect } from \"react\";\r\nimport { getImgInformationFromFile } from '../../../../utils/files';\r\nimport { verify } from \"../../../../utils/permisions\";\r\nimport { store } from \"../../../../store/store\";\r\nimport { Size } from \"../../../../store/types\";\r\n\r\nexport function useBackgroungImg(\r\n  inputFile: RefObject<HTMLElement>,\r\n  setBackgroundImg: (src: string) => void,\r\n  inputBackgroundImg: (width: number, height: number, src: string) => void,\r\n  setModal: (state: boolean) => void\r\n) {\r\n\r\n  useEffect(() => {\r\n\r\n    const canvasSize: Size = {\r\n      width: store.getState().canvas.width,\r\n      height: store.getState().canvas.height,\r\n    };\r\n\r\n    const fieldFile = inputFile.current;\r\n    async function handlerChange(event: Event): Promise<void> {\r\n      const target = event.target as HTMLInputElement;\r\n      const files = target.files as FileList;\r\n      const imgInfo = await getImgInformationFromFile(files[0]);\r\n\r\n      if ((canvasSize.width < imgInfo.width) || (canvasSize.height < imgInfo.height)) {\r\n        inputBackgroundImg(imgInfo.width, imgInfo.height, imgInfo.src)\r\n        setModal(true);\r\n      } else {\r\n        setBackgroundImg(imgInfo.src);\r\n      }\r\n\r\n      target.value = '';\r\n    }\r\n\r\n\r\n    verify(fieldFile).addEventListener(\"change\", handlerChange);\r\n    return () => {\r\n      if (fieldFile) fieldFile.removeEventListener(\"change\", handlerChange);\r\n    };\r\n  }, [inputFile, setBackgroundImg, inputBackgroundImg, setModal]);\r\n}","import styles from './Button.module.css';\nimport { IconDefinition } from '@fortawesome/fontawesome-svg-core';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { ForwardedRef, forwardRef } from 'react';\nimport { connect } from 'react-redux';\n\ntype ButtonProps = {\n  label: string,\n  title: string,\n  icon: IconDefinition,\n}\n\nconst Button = forwardRef((props: ButtonProps, ref: ForwardedRef<HTMLButtonElement>) => (\n  <button\n    className={styles.button}\n    ref={ref}\n    title={props.title}\n    style={{ textAlign: props.label === '' ? 'center' : 'left' }}\n  >\n    <FontAwesomeIcon icon={props.icon} />\n    {props.label !== '' &&\n      <span className={styles.button_text}>{props.label}</span>\n    }\n  </button>\n));\n\nexport default connect(null, null, null, { forwardRef: true })(Button);","import styles from './ToolbarBackground.module.css';\r\nimport { faDownload, faGlobe, faRetweet } from '@fortawesome/free-solid-svg-icons'\r\nimport ColorPicker from '../colorPicker/ColorPicker';\r\nimport FileImgButton from './FileImgButton/FileImgButton';\r\nimport Button from '../button/Button';\r\nimport { RefObject, useRef } from 'react';\r\nimport { useBackgroungColor } from './useBackgroungColor';\r\nimport { AppDispatch, RootState } from '../../../../store/store';\r\nimport { inputBackgroundColor, resetBackground, setBackgroundColor } from '../../../../store/actionCreators/canvasActionCreators';\r\nimport { connect } from 'react-redux';\r\nimport { Background as BackgroundType } from '../../../../store/types';\r\n\r\ntype ToolbarBackgroundProps = {\r\n  resetBackground: () => void,\r\n  inputBackgroundColor: (color: string) => void,\r\n  setBackgroundColor: (color: string) => void,\r\n  background: BackgroundType,\r\n}\r\n\r\nfunction ToolbarBackground(props: ToolbarBackgroundProps) {\r\n\r\n  const inputColor = useRef<HTMLInputElement>(null);\r\n  const buttonReset = useRef<HTMLButtonElement>(null);\r\n\r\n  useBackgroungColor(\r\n    props.resetBackground,\r\n    props.inputBackgroundColor,\r\n    props.setBackgroundColor,\r\n    props.background,\r\n    inputColor,\r\n    buttonReset\r\n  );\r\n\r\n  return (\r\n    <div className={styles.toolbar}>\r\n      <div className={styles.toolbar__row}>\r\n        <div className={styles.toolbar__col1}>\r\n          <div className={styles.button_container}>\r\n            <FileImgButton\r\n              label=\"C компьютера\"\r\n              title=\"C компьютера\"\r\n              icon={faDownload}\r\n            />\r\n            <Button\r\n              label=\"Из Pixels\"\r\n              title=\"Из Pixels\"\r\n              icon={faGlobe}\r\n            />\r\n          </div>\r\n        </div>\r\n        <div className={styles.toolbar__col2}>\r\n          <div className={styles.colorPickerBox}>\r\n            <ColorPicker ref={inputColor as RefObject<HTMLInputElement>} />\r\n          </div>\r\n          <Button\r\n            label=\"Сброс\"\r\n            title=\"Сброс\"\r\n            icon={faRetweet}\r\n            ref={buttonReset as RefObject<HTMLButtonElement>}\r\n          />\r\n        </div>\r\n      </div>\r\n      <label className={styles.toolbar__label}>Фон</label>\r\n    </div>\r\n  );\r\n}\r\n\r\nconst mapStateToProps = (state: RootState) => ({\r\n  background: state.canvas.background,\r\n})\r\n\r\n\r\nconst mapDispatchToProps = (dispatch: AppDispatch) => {\r\n  return {\r\n    resetBackground: () => dispatch(resetBackground()),\r\n    inputBackgroundColor: (color: string) => dispatch(inputBackgroundColor(color)),\r\n    setBackgroundColor: (color: string) => dispatch(setBackgroundColor(color)),\r\n  }\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(ToolbarBackground);\r\n","import { useEffect, RefObject } from 'react';\r\nimport { Background as BackgroundType } from '../../../../store/types';\r\nimport { verify } from '../../../../utils/permisions';\r\n\r\nexport function useBackgroungColor(\r\n  resetBackground: () => void,\r\n  inputBackgroundColor: (color: string) => void,\r\n  setBackgroundColor: (color: string) => void,\r\n  background: BackgroundType,\r\n  inputColor: RefObject<HTMLInputElement>,\r\n  buttonReset: RefObject<HTMLButtonElement>): void {\r\n\r\n  useEffect(() => {\r\n\r\n    const input = inputColor.current;\r\n    const button = buttonReset.current;\r\n\r\n    function handlerClickResetColor(): void {\r\n      resetBackground();\r\n    }\r\n  \r\n    function handlerInputColor(event: Event): void {\r\n      const inputColor = event.target as HTMLInputElement;\r\n      inputBackgroundColor(inputColor.value);\r\n    }\r\n  \r\n    function handleerChangeColor(event: Event): void {\r\n      const inputColor = event.target as HTMLInputElement;\r\n      const color: string = inputColor.value;\r\n      setBackgroundColor(color);\r\n    }\r\n\r\n\r\n    verify(input).addEventListener(\"input\", handlerInputColor);\r\n    verify(input).addEventListener(\"change\", handleerChangeColor);\r\n    verify(button).addEventListener(\"click\", handlerClickResetColor);\r\n    return () => {\r\n      if (input) {\r\n        input.removeEventListener(\"input\", handlerInputColor);\r\n        input.removeEventListener(\"change\", handleerChangeColor);\r\n      }\r\n      if (button) button.removeEventListener(\"click\", handlerClickResetColor);\r\n\r\n    };\r\n  }, [resetBackground, inputBackgroundColor, setBackgroundColor, background, inputColor, buttonReset]);\r\n\r\n  // изменение цвета input на белый при сбросе фона\r\n  useEffect(() => {\r\n    const input = inputColor.current;\r\n    verify(input).value = background.color ? background.color : '#ffffff';\r\n  }, [inputColor, background]);\r\n\r\n\r\n}","import styles from './ToolbarArea.module.css';\nimport { faEraser } from '@fortawesome/free-solid-svg-icons'\nimport Button from '../button/Button';\nimport { connect } from 'react-redux';\nimport { AppDispatch } from '../../../../store/store';\nimport { deleteAreaSelection, resetAreaSelection } from '../../../../store/actionCreators/canvasActionCreators';\nimport { useDeleteArea } from './useDeleteArea';\nimport { useRef } from 'react';\n\ntype ToolbarAreaProps = {\n  deleteAreaSelection: () => void,\n  resetAreaSelection: () => void,\n}\n\nfunction ToolbarArea(props: ToolbarAreaProps) {\n\n  let buttonDelete = useRef<HTMLButtonElement>(null); \n\n  useDeleteArea(buttonDelete, props.deleteAreaSelection, props.resetAreaSelection);\n\n  return (\n    <div className={styles.toolbar}>\n      {/* <Button\n        label=\"Выделение\"\n        title=\"Выделение\"\n        icon={faVectorSquare}\n      /> */}\n      <Button\n        ref={buttonDelete}\n        label=\"Удаление\"\n        title=\"Удаление\"\n        icon={faEraser}\n      />\n\n      {/* <button onClick={() => {\n        props.deleteAreaSelection();\n        props.resetAreaSelection();\n      }}>УДАЛИТЬ</button> */}\n      <label className={styles.toolbar__label}>Область</label>\n    </div>\n  );\n}\n\nconst mapDispatchToProps = (dispatch: AppDispatch) => {\n  return {\n    deleteAreaSelection: () => dispatch(deleteAreaSelection()),\n    resetAreaSelection: () => dispatch(resetAreaSelection()),\n  }\n}\n\nexport default connect(null, mapDispatchToProps)(ToolbarArea);\n","import { RefObject, useEffect } from \"react\"\nimport { verify } from \"../../../../utils/permisions\";\n\nexport function useDeleteArea(\n  buttonDelete: RefObject<HTMLButtonElement>,\n  deleteAreaSelection: () => void,\n  resetAreaSelection: () => void) {\n\n    useEffect(() => {\n\n      const button = buttonDelete.current;\n\n      function handleClickButton() {\n        deleteAreaSelection();\n        resetAreaSelection();\n      }\n      function handleMousedownButton(event: MouseEvent) {\n        event.preventDefault();\n      }\n  \n  \n      verify(button).addEventListener(\"click\", handleClickButton);\n      verify(button).addEventListener(\"mousedown\", handleMousedownButton);\n      return () => {\n        if (button) button.removeEventListener(\"click\", handleClickButton);\n        if (button) button.removeEventListener(\"mousedown\", handleMousedownButton);\n      };\n    }, [buttonDelete, deleteAreaSelection, resetAreaSelection]);\n  }","import { store } from '../store';\n\nexport function setSelectedBlock(id: string) {\n  return {\n    type: 'SET_SELECTED_BLOCK',\n    id: id,\n  }\n}\n\nexport function resetSelectedBlock() {\n  return {\n    type: 'RESET_SELECTED_BLOCK',\n  }\n}\n\nexport function setSizeBlock(width: number, height: number) {\n  return {\n    type: 'SET_SIZE_BLOCK',\n    id: store.getState().selectBlock,\n    width: width,\n    height: height,\n  }\n}\n\nexport function deleteBlock() {\n  return {\n    type: 'DELETE_BLOCK',\n    id: store.getState().selectBlock,\n  }\n}\n\nexport function setPositionBlock(x: number, y: number) {\n  return {\n    type: 'SET_POSITION_BLOCK',\n    id: store.getState().selectBlock,\n    x: x,\n    y: y,\n  }\n}\n\nexport function shiftUpBlock() {\n  return {\n    type: 'SHIFT_UP_BLOCK',\n    id: store.getState().selectBlock,\n  }\n}\n\nexport function shiftDownBlock() {\n  return {\n    type: 'SHIFT_DOWN_BLOCK',\n    id: store.getState().selectBlock,\n  }\n}\n\nexport function clickOnText() {\n  return {\n    type: 'CLICK_ON_TEXT',\n    id: store.getState().selectBlock,\n  }\n}\n\nexport function blurOnText() {\n  return {\n    type: 'BLUR_ON_TEXT',\n  }\n}\n","import styles from './ToolbarObject.module.css';\nimport { faArrowUp, faArrowDown, faTrash } from '@fortawesome/free-solid-svg-icons'\nimport Button from '../button/Button';\nimport { useBlockLevel } from './useBlockLevel';\nimport { useBlockDelete } from './useBlockDelete';\nimport { RefObject, useRef } from 'react';\nimport { connect } from 'react-redux';\nimport { AppDispatch } from '../../../../store/store';\nimport { deleteBlock, shiftDownBlock, shiftUpBlock } from '../../../../store/actionCreators/blockActionCreators';\n\ntype ToolbarObjectProps = {\n  shiftUpBlock: () => void,\n  shiftDownBlock: () => void,\n  deleteBlock: () => void,\n}\n\nfunction ToolbarObject(props: ToolbarObjectProps) {\n  const buttonUp = useRef<HTMLButtonElement>(null);\n  const buttonDown = useRef<HTMLButtonElement>(null);\n  const buttonDelete = useRef<HTMLButtonElement>(null);\n  useBlockLevel(buttonUp, buttonDown, props.shiftUpBlock, props.shiftDownBlock);\n  useBlockDelete(buttonDelete, props.deleteBlock);\n  return (\n    <div className={styles.toolbar}>\n      <div className={styles.toolbar__row}>\n        <div>\n          <div className={styles.button_container}>\n            <Button\n              ref={buttonUp as RefObject<HTMLButtonElement>}\n              label=\"\"\n              title=\"Переместить вперед\"\n              icon={faArrowUp}\n            />\n            <Button\n              ref={buttonDown as RefObject<HTMLButtonElement>}\n              label=\"\"\n              title=\"Переместить назад\"\n              icon={faArrowDown}\n            />\n          </div>\n        </div>\n        <div className={styles.toolbar__col}>\n          <Button\n            ref={buttonDelete as RefObject<HTMLButtonElement>}\n            label=\"Удалить\"\n            title=\"Удалить\"\n            icon={faTrash}\n          />\n        </div>\n      </div>\n      <label className={styles.toolbar__label}>Объекты</label>\n    </div>\n  );\n}\n\nconst mapDispatchToProps = (dispatch: AppDispatch) => {\n  return {\n    shiftUpBlock: () => dispatch(shiftUpBlock()),\n    shiftDownBlock: () => dispatch(shiftDownBlock()),\n    deleteBlock: () => dispatch(deleteBlock()),\n  }\n}\n\nexport default connect(null, mapDispatchToProps)(ToolbarObject);\n","import { RefObject, useEffect } from 'react';\nimport { verify } from '../../../../utils/permisions';\n\nexport function useBlockLevel(\n  buttonUp: RefObject<HTMLButtonElement>,\n  buttonDown: RefObject<HTMLButtonElement>,\n  shiftUpBlock: () => void,\n  shiftDownBlock: () => void): void {\n\n  useEffect(() => {\n\n    const btnUp = buttonUp.current;\n    const btnDown = buttonDown.current;\n\n    function handlerClickShiftUp(event: Event): void {\n      event.preventDefault();\n      shiftUpBlock();\n    }\n  \n    function handlerClickShiftDown(event: Event): void {\n      event.preventDefault();\n      shiftDownBlock();\n    }\n\n\n    verify(btnUp).addEventListener(\"click\", handlerClickShiftUp);\n    verify(btnDown).addEventListener(\"click\", handlerClickShiftDown);\n    return () => {\n      if (btnUp) btnUp.removeEventListener(\"click\", handlerClickShiftUp);\n      if (btnDown) btnDown.removeEventListener(\"click\", handlerClickShiftDown);\n    };\n  }, [buttonUp, buttonDown, shiftUpBlock, shiftDownBlock]);\n}\n\n\n","import { RefObject, useEffect } from 'react';\r\nimport { verify } from '../../../../utils/permisions';\r\n\r\nexport function useBlockDelete(buttonDelete: RefObject<HTMLButtonElement>, deleteBlock: () => void): void {\r\n\r\n  useEffect(() => {\r\n\r\n    const button = buttonDelete.current;\r\n\r\n    function handlerClickDelete(): void {\r\n      deleteBlock();\r\n    }\r\n\r\n    function handlerKeydown(event: KeyboardEvent): void {\r\n      if (event.code === 'Delete') {\r\n        deleteBlock();\r\n      }\r\n    }\r\n\r\n    \r\n    verify(button).addEventListener(\"click\", handlerClickDelete);\r\n    document.addEventListener(\"keydown\", handlerKeydown);\r\n    return () => {\r\n      if (button) button.removeEventListener(\"click\", handlerClickDelete);\r\n      document.removeEventListener(\"keydown\", handlerKeydown);\r\n    };\r\n  }, [buttonDelete, deleteBlock]);\r\n}\r\n\r\n\r\n","import styles from './ToolbarCanvas.module.css';\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\r\nimport { faTimes } from '@fortawesome/free-solid-svg-icons'\r\nimport { useRef } from 'react';\r\nimport { useStateCanvasSize } from './useStateCanvasSize';\r\nimport { connect } from 'react-redux';\r\nimport { inputCanvasSize, setCanvasSize } from '../../../../store/actionCreators/canvasActionCreators';\r\nimport { AppDispatch, RootState } from '../../../../store/store';\r\n\r\ntype ToolbarCanvasProps = {\r\n  inputCanvasSize: (width: number, height: number) => void,\r\n  setCanvasSize: (width: number, height: number) => void,\r\n  width: number,\r\n  height: number,\r\n}\r\n\r\nfunction ToolbarCanvas(props: ToolbarCanvasProps) {\r\n\r\n  const inputWidth = useRef<HTMLInputElement>(null);\r\n  const inputHeight = useRef<HTMLInputElement>(null);\r\n  useStateCanvasSize(\r\n    inputWidth,\r\n    inputHeight,\r\n    props.inputCanvasSize,\r\n    props.setCanvasSize,\r\n    props.width,\r\n    props.height,\r\n  );\r\n\r\n  return (\r\n    <div className={styles.toolbar}>\r\n      <div className={styles.toolbar__row}>\r\n        <input type=\"number\" className={styles.input_number} min=\"0\"\r\n          ref={inputWidth}\r\n        />\r\n        <FontAwesomeIcon icon={faTimes} className={styles.label} />\r\n        <input type=\"number\" className={styles.input_number} min=\"0\"\r\n          ref={inputHeight}\r\n        />\r\n      </div>\r\n\r\n      <label className={styles.toolbar__label}>Холст</label>\r\n    </div>\r\n  );\r\n}\r\n\r\nconst mapStateToProps = (state: RootState) => ({\r\n  width: state.canvas.width,\r\n  height: state.canvas.height,\r\n})\r\n\r\nconst mapDispatchToProps = (dispatch: AppDispatch) => {\r\n  return {\r\n    inputCanvasSize: (width: number, height: number) => dispatch(inputCanvasSize(width, height)),\r\n    setCanvasSize: (width: number, height: number) => dispatch(setCanvasSize(width, height)),\r\n  }\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(ToolbarCanvas);\r\n","import { RefObject, useEffect } from 'react';\nimport { verify } from '../../../../utils/permisions';\n\nexport function useStateCanvasSize(\n  inputWidth: RefObject<HTMLInputElement>,\n  inputHeight: RefObject<HTMLInputElement>,\n  inputCanvasSize: (width: number, height: number) => void,\n  setCanvasSize: (width: number, height: number) => void,\n  width: number,\n  height: number\n  ): void {\n\n  useEffect(() => {\n    const fieldWidth = inputWidth.current;\n    const fieldHeight = inputHeight.current;\n\n    verify(fieldWidth).value = String(width);\n    verify(fieldHeight).value = String(height);\n\n    function handleChangeSize(): void {\n      if (fieldWidth && fieldHeight) {\n        const width: number = Number(fieldWidth.value);\n        const height: number = Number(fieldHeight.value);\n        inputCanvasSize(width, height);\n      }\n    }\n\n    function handleBlurSize(): void {\n      if (fieldWidth && fieldHeight) {\n        const width: number = Number(fieldWidth.value);\n        const height: number = Number(fieldHeight.value);\n        setCanvasSize(width, height);\n      }\n    }\n\n\n    verify(fieldWidth).addEventListener(\"change\", handleChangeSize);\n    verify(fieldWidth).addEventListener(\"blur\", handleBlurSize);\n    verify(fieldHeight).addEventListener(\"change\", handleChangeSize);\n    verify(fieldHeight).addEventListener(\"blur\", handleBlurSize);\n    return () => {\n      if (fieldWidth) {\n        fieldWidth.removeEventListener(\"change\", handleChangeSize);\n        fieldWidth.removeEventListener(\"blur\", handleBlurSize);\n      }\n      if (fieldHeight) {\n        fieldHeight.removeEventListener(\"change\", handleChangeSize);\n        fieldHeight.removeEventListener(\"blur\", handleBlurSize);\n      }\n    };\n  }, [inputWidth, inputHeight, inputCanvasSize, setCanvasSize, width, height]);\n}","import styles from './Toolbar.module.css';\nimport ToolbarText from './toolbarText/ToolbarText';\nimport ToolbarImg from './toolbarImg/ToolbarImg';\nimport ToolbarFilter from './toolbarFilter/ToolbarFilter';\nimport ToolbarBackground from './toolbarBackground/ToolbarBackground';\nimport ToolbarArea from './toolbarArea/ToolbarArea';\nimport ToolbarObject from './toolbarObject/ToolbarObject';\nimport ToolbarCanvas from './toolbarCanvas/ToolbarCanvas';\nimport { connect } from 'react-redux';\n\nfunction Toolbar() {\n  return (\n    <div className={styles.toolbar}>\n      <ToolbarText />\n      <ToolbarImg />\n      <ToolbarBackground />\n      <ToolbarArea />\n      <ToolbarFilter />\n      <ToolbarObject />\n      <ToolbarCanvas />\n    </div>\n  );\n}\n\nexport default connect()(Toolbar);\n","import { connect } from 'react-redux';\nimport styles from './Header.module.css';\nimport Navbar from './navbar/Navbar';\nimport Toolbar from './toolbar/Toolbar';\n\nfunction Header() {\n\n  return (\n    <header className={styles.header}>\n      <div className={styles.panel}>\n        <Navbar />\n        <Toolbar />\n      </div>\n    </header >\n  );\n}\n\nexport default connect()(Header);\n","import { useEffect, RefObject } from 'react';\nimport { store } from '../../store/store';\nimport { verify } from '../../utils/permisions';\n\nexport function useStateBlock(\n  blockId: string,\n  block: RefObject<HTMLElement>,\n  setSelectedBlock: (id: string) => void,\n  resetSelectedBlock: () => void,\n): void {\n\n  useEffect(() => {\n\n    const currentBlock = block.current;\n\n    function handleMousedownBlock(): void {\n      if (store.getState().selectBlock !== blockId) {\n        setTimeout(() => {\n          setSelectedBlock(blockId);\n        });\n      }\n    }\n\n    function handleClickDocument(event: Event): void {\n      const isDefPrev: boolean = event.defaultPrevented;\n      const isSelectedID: boolean = store.getState().selectBlock === blockId;\n      if (!isDefPrev && isSelectedID && (event.target !== currentBlock)) {\n        resetSelectedBlock();\n      }\n    }\n\n\n    document.addEventListener(\"click\", handleClickDocument);\n    verify(currentBlock).addEventListener(\"mousedown\", handleMousedownBlock);\n    return () => {\n      if (currentBlock) currentBlock.removeEventListener(\"mousedown\", handleMousedownBlock);\n      document.removeEventListener(\"click\", handleClickDocument);\n    };\n  }, [blockId, block, setSelectedBlock, resetSelectedBlock]);\n}","import { useEffect, RefObject } from 'react';\r\nimport { Position } from '../../store/types';\r\nimport { verify } from '../../utils/permisions';\r\n\r\nexport function useDragAndDrop(\r\n  block: RefObject<HTMLElement>,\r\n  defPos: Position,\r\n  setPositionBlock: (x: number, y: number) => void\r\n): void {\r\n\r\n\r\n  useEffect(() => {\r\n\r\n    const currentBlock = block.current;\r\n\r\n    let startPos: Position;\r\n\r\n    function handleMousedown(event: MouseEvent): void {\r\n      // event.preventDefault();\r\n      startPos = {\r\n        x: event.pageX,\r\n        y: event.pageY,\r\n      };\r\n      document.addEventListener(\"mousemove\", handleMouseMove);\r\n      document.addEventListener(\"mouseup\", handleMouseUp);\r\n    }\r\n  \r\n    let newPos: Position;\r\n\r\n    function handleMouseMove(event: MouseEvent): void {\r\n      if (!event.defaultPrevented) {\r\n        event.preventDefault();\r\n        const delta = {\r\n          x: event.pageX - startPos.x,\r\n          y: event.pageY - startPos.y\r\n        }\r\n        newPos = {\r\n          x: defPos.x + delta.x,\r\n          y: defPos.y + delta.y\r\n        }\r\n        verify(currentBlock).style.left = String(newPos.x) + 'px';\r\n        verify(currentBlock).style.top = String(newPos.y) + 'px';\r\n      }\r\n    }\r\n  \r\n    function handleMouseUp(): void {\r\n      if (newPos) {\r\n        setPositionBlock(newPos.x, newPos.y);\r\n      }\r\n      document.removeEventListener(\"mousemove\", handleMouseMove);\r\n      document.removeEventListener(\"mouseup\", handleMouseUp);\r\n    }\r\n  \r\n\r\n    verify(currentBlock).addEventListener(\"mousedown\", handleMousedown);\r\n    return () => {\r\n      if (currentBlock) currentBlock.removeEventListener(\"mousedown\", handleMousedown);\r\n    };\r\n  }, [block, defPos, setPositionBlock]);\r\n}","import { useEffect, RefObject } from 'react';\nimport { Position, Size } from '../../store/types';\nimport { verify } from '../../utils/permisions';\n\nexport function useResize(\n  setSizeBlock: (width: number, height: number) => void,\n  setPositionBlock: (x: number, y: number) => void,\n  LT: RefObject<HTMLElement>,\n  RT: RefObject<HTMLElement>,\n  LB: RefObject<HTMLElement>,\n  RB: RefObject<HTMLElement>,\n  block: RefObject<HTMLElement>,\n  defPos: Position,\n  defSize: Size\n): void {\n\n\n  useEffect(() => {\n\n    const currentBlock = block.current;\n    const pointLT = LT;\n    const pointRT = RT;\n    const pointLB = LB;\n    const pointRB = RB;\n\n    let startPos: Position;\n    let point: string;\n\n    function handleMousedown(event: MouseEvent): void {\n      event.preventDefault();\n      switch (event.target) {\n        case pointLT.current:\n          point = 'LT';\n          break;\n        case pointRT.current:\n          point = 'RT';\n          break;\n        case pointLB.current:\n          point = 'LB';\n          break;\n        case pointRB.current:\n          point = 'RB';\n          break;\n      }\n\n      startPos = {\n        x: event.pageX + (5 - event.offsetX),\n        y: event.pageY + (5 - event.offsetY)\n      };\n\n      document.addEventListener(\"mousemove\", handleMouseMove);\n      document.addEventListener(\"mouseup\", handleMouseUp);\n    }\n\n    let newWidth: number = defSize.width;\n    let newHeight: number = defSize.height;\n    let prevWidth: number = defSize.width;\n    let prevHeight: number = defSize.height;\n    let newPos: Position;\n\n    function handleMouseMove(event: MouseEvent): void {\n      event.preventDefault();\n      const delta = {\n        x: event.pageX - startPos.x,\n        y: event.pageY - startPos.y,\n      }\n\n      // перемещение при изменении размеров\n      let moving: Position = { x: 0, y: 0 };\n      switch (point) {\n        case 'LT':\n          [newWidth, newHeight] = calculateSize({ x: -delta.x, y: -delta.y }, prevWidth, prevHeight);\n          moving = { x: defSize.width - newWidth, y: defSize.height - newHeight };\n          break;\n        case 'RT':\n          [newWidth, newHeight] = calculateSize({ x: delta.x, y: -delta.y }, prevWidth, prevHeight);\n          moving = { x: 0, y: defSize.height - newHeight };\n          break;\n        case 'LB':\n          [newWidth, newHeight] = calculateSize({ x: -delta.x, y: delta.y }, prevWidth, prevHeight);\n          moving = { x: defSize.width - newWidth, y: 0 };\n          break;\n        case 'RB':\n          [newWidth, newHeight] = calculateSize(delta, prevWidth, prevHeight);\n          break;\n      }\n\n      verify(currentBlock).style.width = String(newWidth) + 'px';\n      verify(currentBlock).style.height = String(newHeight) + 'px';\n\n      newPos = {\n        x: defPos.x + moving.x,\n        y: defPos.y + moving.y\n      }\n\n      verify(currentBlock).style.left = String(newPos.x) + 'px';\n      verify(currentBlock).style.top = String(newPos.y) + 'px';\n\n      prevWidth = newWidth;\n      prevHeight = newHeight;\n    }\n\n    function calculateSize(delta: Position, prevWidth: number, prevHeight: number) {\n      if ((delta.x / prevWidth) < (delta.y / prevHeight)) {\n        newHeight = defSize.height + delta.y;\n        newHeight = newHeight < 20 ? 20 : newHeight;\n        newWidth = (prevWidth * newHeight) / prevHeight;\n      } else {\n        newWidth = defSize.width + delta.x;\n        newWidth = newWidth < 20 ? 20 : newWidth;\n        newHeight = (prevHeight * newWidth) / prevWidth;\n      }\n      return [newWidth, newHeight];\n    }\n\n    function handleMouseUp(): void {\n      setSizeBlock(newWidth, newHeight);\n      if (newPos) {\n        setPositionBlock(newPos.x, newPos.y);\n      }\n      document.removeEventListener(\"mousemove\", handleMouseMove);\n      document.removeEventListener(\"mouseup\", handleMouseUp);\n    }\n\n    \n    verify(pointLT.current).addEventListener(\"mousedown\", handleMousedown);\n    verify(pointRT.current).addEventListener(\"mousedown\", handleMousedown);\n    verify(pointLB.current).addEventListener(\"mousedown\", handleMousedown);\n    verify(pointRB.current).addEventListener(\"mousedown\", handleMousedown);\n    return () => {\n      if (pointLT.current) pointLT.current.removeEventListener(\"mousedown\", handleMousedown);\n      if (pointRT.current) pointRT.current.removeEventListener(\"mousedown\", handleMousedown);\n      if (pointLB.current) pointLB.current.removeEventListener(\"mousedown\", handleMousedown);\n      if (pointRB.current) pointRB.current.removeEventListener(\"mousedown\", handleMousedown);\n    };\n  }, [setSizeBlock, setPositionBlock, LT, RT, LB, RB, block, defPos, defSize]);\n}","import styles from './Img.module.css';\r\nimport { Img as ImgType } from '../../../store/types';\r\nimport { useRef } from 'react';\r\nimport { useStateBlock } from '../useStateBlock';\r\nimport { useDragAndDrop } from '../useDragAndDrop';\r\nimport { useResize } from '../useResize';\r\nimport { connect } from 'react-redux';\r\nimport { resetSelectedBlock, setPositionBlock, setSelectedBlock, setSizeBlock } from '../../../store/actionCreators/blockActionCreators';\r\nimport { AppDispatch, RootState } from '../../../store/store';\r\n\r\ntype ImgProps = {\r\n  img: ImgType,\r\n  selectBlock: string | null,\r\n  setSizeBlock: (width: number, height: number) => void,\r\n  setPositionBlock: (x: number, y: number) => void,\r\n  setSelectedBlock: (id: string) => void,\r\n  resetSelectedBlock: () => void,\r\n}\r\n\r\nfunction Img(props: ImgProps) {\r\n  const img: ImgType = props.img;\r\n  let src: string = '';\r\n  if (img.src) {\r\n    src = img.src;\r\n  }\r\n  const imgStyle = getStyle(img);\r\n  const imgBlock = useRef<HTMLImageElement>(null);\r\n\r\n\r\n  const pointLT = useRef<HTMLDivElement>(null);\r\n  const pointRT = useRef<HTMLDivElement>(null);\r\n  const pointLB = useRef<HTMLDivElement>(null);\r\n  const pointRB = useRef<HTMLDivElement>(null);\r\n\r\n  useStateBlock(props.img.id, imgBlock, props.setSelectedBlock, props.resetSelectedBlock);\r\n  useDragAndDrop(imgBlock, { x: img.x, y: img.y }, props.setPositionBlock);\r\n  useResize(\r\n    props.setSizeBlock,\r\n    props.setPositionBlock,\r\n    pointLT,\r\n    pointRT,\r\n    pointLB,\r\n    pointRB,\r\n    imgBlock,\r\n    { x: img.x, y: img.y },\r\n    { width: img.width, height: img.height }\r\n  );\r\n\r\n  const select: string = props.img.id === props.selectBlock ? styles.selected : '';\r\n\r\n  return (\r\n    <div\r\n      className={styles.block + ' ' + select}\r\n      style={imgStyle}\r\n      ref={imgBlock}\r\n      onDragStart={(e) => e.preventDefault() }\r\n    >\r\n      <div className={styles.pointTopLeft} ref={pointLT}></div>\r\n      <div className={styles.pointTopRight} ref={pointRT}></div>\r\n      <img src={src}\r\n        alt=''\r\n        className={styles.img}\r\n      />\r\n      <div className={styles.pointBottomLeft} ref={pointLB}></div>\r\n      <div className={styles.pointBottomRight} ref={pointRB}></div>\r\n    </div>\r\n  );\r\n}\r\n\r\nconst mapStateToProps = (state: RootState) => ({\r\n  selectBlock: state.selectBlock,\r\n})\r\n\r\nconst mapDispatchToProps = (dispatch: AppDispatch) => {\r\n  return {\r\n    setPositionBlock: (x: number, y: number) => dispatch(setPositionBlock(x, y)),\r\n    setSizeBlock: (width: number, height: number) => dispatch(setSizeBlock(width, height)),\r\n    setSelectedBlock: (id: string) => dispatch(setSelectedBlock(id)),\r\n    resetSelectedBlock: () => dispatch(resetSelectedBlock()),\r\n  }\r\n}\r\n\r\nfunction getStyle(img: ImgType) {\r\n  return {\r\n    width: img.width,\r\n    height: img.height,\r\n    left: img.x,\r\n    top: img.y,\r\n  };\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(Img);\r\n","import styles from './Text.module.css';\r\nimport { Text as TextType } from '../../../store/types';\r\nimport { useRef } from 'react';\r\nimport { useStateBlock } from '../useStateBlock';\r\nimport { useDragAndDrop } from '../useDragAndDrop';\r\nimport { connect } from 'react-redux';\r\nimport { clickOnText, deleteBlock, resetSelectedBlock, setPositionBlock, setSelectedBlock } from '../../../store/actionCreators/blockActionCreators';\r\nimport { AppDispatch, RootState } from '../../../store/store';\r\nimport { useEditText } from './useEditText';\r\nimport { setBoldText, setItalicText, setTextInTextBlock, setUnderlineText } from '../../../store/actionCreators/textBlockActionCreators';\r\n\r\ntype TextProps = {\r\n  text: TextType,\r\n  color: string | null,\r\n  size: number | null,\r\n  selectBlock: string | null,\r\n  setPositionBlock: (x: number, y: number) => void,\r\n  setSelectedBlock: (id: string) => void,\r\n  resetSelectedBlock: () => void,\r\n  setTextInTextBlock: (text: string) => void,\r\n  clickOnText: () => void,\r\n  deleteBlock: () => void,\r\n  setBoldText: (isBold: boolean) => void,\r\n  setItalicText: (isItalic: boolean) => void,\r\n  setUnderlineText: (isUnderline: boolean) => void,\r\n}\r\n\r\nfunction Text(props: TextProps) {\r\n  const text: TextType = props.text;\r\n\r\n  const textBlock = useRef<HTMLDivElement>(null);\r\n  useStateBlock(props.text.id, textBlock, props.setSelectedBlock, props.resetSelectedBlock);\r\n  useDragAndDrop(textBlock, { x: text.x, y: text.y }, props.setPositionBlock);\r\n\r\n  useEditText(\r\n    textBlock,\r\n    text.bold,\r\n    text.italic,\r\n    text.underline,\r\n    props.setTextInTextBlock,\r\n    props.clickOnText,\r\n    props.deleteBlock,\r\n    props.setBoldText,\r\n    props.setItalicText,\r\n    props.setUnderlineText,\r\n  );\r\n\r\n  const select: string = props.text.id === props.selectBlock ? styles.selected : '';\r\n  let textStyle = getStyle(text);\r\n  textStyle = {\r\n    ...textStyle,\r\n    color: props.color && select !== '' ? props.color : textStyle.color,\r\n    fontSize: props.size && select !== '' ? props.size : textStyle.fontSize,\r\n  }\r\n\r\n  return (\r\n    <div style={textStyle}\r\n      contentEditable={false}\r\n      suppressContentEditableWarning={true}\r\n      onDragStart={(e) => e.preventDefault()}\r\n      ref={textBlock}\r\n      className={styles.block + ' ' + select}\r\n      dangerouslySetInnerHTML={{ __html: text.text }}\r\n    >\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction getStyle(text: TextType) {\r\n  return {\r\n    left: text.x,\r\n    top: text.y,\r\n    color: text.color,\r\n    fontSize: text.size,\r\n    fontWeight: text.bold ? 700 : 400,\r\n    textDecoration: text.underline ? 'underline' : 'none',\r\n    fontStyle: text.italic ? 'italic' : 'normal',\r\n    fontFamily: text.fontFamily,\r\n  };\r\n}\r\n\r\nconst mapStateToProps = (state: RootState) => ({\r\n  selectBlock: state.selectBlock,\r\n  color: state.viewModel.text.tempColor,\r\n  size: state.viewModel.text.tempSize,\r\n})\r\n\r\nconst mapDispatchToProps = (dispatch: AppDispatch) => {\r\n  return {\r\n    setPositionBlock: (x: number, y: number) => dispatch(setPositionBlock(x, y)),\r\n    setSelectedBlock: (id: string) => dispatch(setSelectedBlock(id)),\r\n    resetSelectedBlock: () => dispatch(resetSelectedBlock()),\r\n    setTextInTextBlock: (text: string) => dispatch(setTextInTextBlock(text)),\r\n    clickOnText: () => dispatch(clickOnText()),\r\n    deleteBlock: () => dispatch(deleteBlock()),\r\n    setBoldText: (isBold: boolean) => dispatch(setBoldText(isBold)),\r\n    setItalicText: (isItalic: boolean) => dispatch(setItalicText(isItalic)),\r\n    setUnderlineText: (isUnderline: boolean) => dispatch(setUnderlineText(isUnderline)),\r\n  }\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(Text);\r\n","import { RefObject, useEffect } from \"react\";\nimport { verify } from \"../../../utils/permisions\";\n\nexport function useEditText(\n  block: RefObject<HTMLDivElement>,\n  bold: boolean,\n  italic: boolean,\n  underline: boolean,\n  setTextIncurrentBlock: (text: string) => void,\n  clickOnText: () => void,\n  deleteBlock: () => void,\n  setBoldText: (isBold: boolean) => void,\n  setItalicText: (isItalic: boolean) => void,\n  setUnderlineText: (isUnderline: boolean) => void,\n) {\n\n  useEffect(() => {\n\n    const currentBlock = block.current;\n\n    function handleClickBlock() {\n      setTimeout(() => {\n        clickOnText();\n      });\n    }\n\n    function handleDblclickBlock() {\n      verify(currentBlock).setAttribute(\"contenteditable\", \"true\")\n      verify(currentBlock).focus();\n    }\n\n    function handleBlur() {\n      if (currentBlock) {\n        currentBlock.setAttribute(\"contenteditable\", \"false\")\n        const content: string = currentBlock.innerHTML;\n        console.log(content)\n        if (content === '<div><br></div>') {\n          deleteBlock();\n        } else {\n          setTextIncurrentBlock(currentBlock.innerHTML);\n        }\n      }\n    }\n\n    function handleMouseMove(event: Event) {\n      if (verify(currentBlock).getAttribute('contenteditable') === 'true') {\n        event.stopImmediatePropagation();\n      }\n    }\n\n    function handlerKeydown(event: KeyboardEvent): void {\n      if (event.code === 'Escape') {\n        if (verify(currentBlock).getAttribute('contenteditable') === 'true') {\n          verify(currentBlock).setAttribute(\"contenteditable\", \"false\")\n          setTextIncurrentBlock(verify(currentBlock).innerHTML)\n        }\n      }\n      if (event.code === 'Delete') {\n        event.stopImmediatePropagation();\n      }\n      if (event.code === 'KeyB' && (event.ctrlKey || event.metaKey)) {\n        setBoldText(!bold)\n      }\n      if (event.code === 'KeyI' && (event.ctrlKey || event.metaKey)) {\n        setItalicText(!italic)\n      }\n      if (event.code === 'KeyU' && (event.ctrlKey || event.metaKey)) {\n        setUnderlineText(!underline)\n      }\n    }\n\n    function handlerPaste(event: any) {\n      event.preventDefault();\n      const text = event.clipboardData.getData(\"text/plain\");\n      document.execCommand(\"insertHTML\", false, text);\n    }\n\n    function handlerInput(event: Event) {\n      if (currentBlock) {\n        if (currentBlock.innerHTML[0] !== '<' || currentBlock.innerHTML === '<br>') {\n          currentBlock.innerHTML = `<div>${currentBlock.innerText}<br></div>`;\n          currentBlock.focus();\n        }\n      }\n    }\n\n\n    verify(currentBlock).addEventListener(\"mousedown\", handleClickBlock);\n    verify(currentBlock).addEventListener(\"dblclick\", handleDblclickBlock);\n    verify(currentBlock).addEventListener(\"blur\", handleBlur);\n    document.addEventListener(\"mousemove\", handleMouseMove);\n    verify(currentBlock).addEventListener(\"keydown\", handlerKeydown);\n    verify(currentBlock).addEventListener(\"paste\", handlerPaste);\n    verify(currentBlock).addEventListener(\"input\", handlerInput);\n    return () => {\n      if (currentBlock) {\n        currentBlock.removeEventListener(\"mousedown\", handleClickBlock);\n        currentBlock.removeEventListener(\"dblclick\", handleDblclickBlock);\n        currentBlock.addEventListener(\"blur\", handleBlur);\n        currentBlock.removeEventListener(\"keydown\", handlerKeydown);\n        currentBlock.removeEventListener(\"paste\", handlerPaste);\n        currentBlock.removeEventListener(\"input\", handlerInput);\n      }\n      document.removeEventListener(\"mousemove\", handleMouseMove);\n    };\n  }, [\n    block, bold, italic, underline, setTextIncurrentBlock, clickOnText,\n    deleteBlock, setBoldText, setItalicText, setUnderlineText\n  ]);\n}","import styles from './ArtObj.module.css';\r\nimport { ArtObj as ArtObjType } from '../../../store/types';\r\nimport { useRef } from 'react';\r\nimport { useStateBlock } from '../useStateBlock';\r\nimport { useDragAndDrop } from '../useDragAndDrop';\r\nimport { useResize } from '../useResize';\r\nimport { resetSelectedBlock, setPositionBlock, setSelectedBlock, setSizeBlock } from '../../../store/actionCreators/blockActionCreators';\r\nimport { connect } from 'react-redux';\r\nimport { AppDispatch, RootState } from '../../../store/store';\r\n\r\ntype ArtObjProps = {\r\n  artObj: ArtObjType,\r\n  selectBlock: string | null,\r\n  setSizeBlock: (width: number, height: number) => void,\r\n  setPositionBlock: (x: number, y: number) => void,\r\n  setSelectedBlock: (id: string) => void,\r\n  resetSelectedBlock: () => void,\r\n}\r\n\r\nfunction ArtObj(props: ArtObjProps) {\r\n  const artObj: ArtObjType = props.artObj;\r\n  const artObjBlock = useRef<HTMLDivElement>(null);\r\n  const artObjStyle = getStyle(artObj);\r\n\r\n  const pointLT = useRef<HTMLDivElement>(null);\r\n  const pointRT = useRef<HTMLDivElement>(null);\r\n  const pointLB = useRef<HTMLDivElement>(null);\r\n  const pointRB = useRef<HTMLDivElement>(null);\r\n\r\n  useStateBlock(props.artObj.id, artObjBlock, props.setSelectedBlock, props.resetSelectedBlock);\r\n  useDragAndDrop(artObjBlock, { x: artObj.x, y: artObj.y }, props.setPositionBlock);\r\n  useResize(\r\n    props.setSizeBlock,\r\n    props.setPositionBlock,\r\n    pointLT,\r\n    pointRT,\r\n    pointLB,\r\n    pointRB,\r\n    artObjBlock,\r\n    { x: artObj.x, y: artObj.y },\r\n    { width: artObj.width, height: artObj.height }\r\n  );\r\n  \r\n  const select: string = props.artObj.id === props.selectBlock ? styles.selected : '';\r\n\r\n  return (\r\n    <div\r\n      className={styles.block + ' ' + select}\r\n      style={artObjStyle}\r\n      ref={artObjBlock}\r\n      onDragStart={(e) => e.preventDefault() }\r\n    >\r\n      <div className={styles.pointTopLeft} ref={pointLT}></div>\r\n      <div className={styles.pointTopRight} ref={pointRT}></div>\r\n      <img src={artObj.src}\r\n        alt=''\r\n        className={styles.img}\r\n      />\r\n      <div className={styles.pointBottomLeft} ref={pointLB}></div>\r\n      <div className={styles.pointBottomRight} ref={pointRB}></div>\r\n    </div>\r\n  );\r\n}\r\n\r\nconst mapStateToProps = (state: RootState) => ({\r\n  selectBlock: state.selectBlock,\r\n})\r\n\r\nconst mapDispatchToProps = (dispatch: AppDispatch) => {\r\n  return {\r\n    setPositionBlock: (x: number, y: number) => dispatch(setPositionBlock(x, y)),\r\n    setSizeBlock: (width: number, height: number) => dispatch(setSizeBlock(width, height)),\r\n    setSelectedBlock: (id: string) => dispatch(setSelectedBlock(id)),\r\n    resetSelectedBlock: () => dispatch(resetSelectedBlock()),\r\n  }\r\n}\r\n\r\nfunction getStyle(artObj: ArtObjType) {\r\n  return {\r\n    width: artObj.width,\r\n    height: artObj.height,\r\n    left: artObj.x,\r\n    top: artObj.y,\r\n  };\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(ArtObj);\r\n","import styles from './Filter.module.css';\nimport { Canvas as CanvasType, Filter as FilterType } from '../../../store/types';\nimport { connect } from 'react-redux';\nimport { RootState } from '../../../store/store';\n\ntype FilterProps = {\n  canvas: CanvasType\n  filter: FilterType | null,\n}\n\nfunction Filter(props: FilterProps) {\n  const canvas: CanvasType = props.canvas;\n\n  let color: string = '';\n  let opacity: number = 0;\n  if (props.filter) {\n    color = props.filter.color;\n    opacity = props.filter.opacity;\n  } else {\n    color = canvas.filter.color;\n    opacity = canvas.filter.opacity;\n  }\n\n  const filterStyle = {\n    background: color,\n    opacity: opacity,\n  };\n\n  return (\n    <div className={styles.filter} style={filterStyle} id=\"filter\"></div>\n  );\n}\n\nfunction mapStateToProps(state: RootState) {\n  return {\n    canvas: state.canvas,\n    filter: state.viewModel.filter,\n  }\n};\n\nexport default connect(mapStateToProps)(Filter);","import styles from './DeleteArea.module.css';\nimport { ReactElement } from 'react';\nimport { Area, Canvas as CanvasType } from '../../../store/types';\nimport { connect } from 'react-redux';\nimport { RootState } from '../../../store/store';\n\ntype DeleteAreaProps = { canvas: CanvasType }\n\nfunction DeleteArea(props: DeleteAreaProps) {\n  const canvas: CanvasType = props.canvas;\n\n  let listBlock: ReactElement[] = [];\n  canvas.deleteArea.forEach((block: Area, index: number) => {\n    const DeleteAreaStyle = {\n      width: block.width as number,\n      height: block.height as number,\n      left: block.x as number,\n      top: block.y as number,\n    };\n\n    listBlock.push(\n    <div className={styles.deleteArea}\n      key={index}\n      style={DeleteAreaStyle}>\n    </div>);\n  });\n\n  return (\n    <>\n      {listBlock}\n    </>\n  );\n}\n\nfunction mapStateToProps(state: RootState) {\n  return {\n    canvas: state.canvas,\n  }\n};\n\nexport default connect(mapStateToProps)(DeleteArea);\n\n\n\n","import styles from './AreaSelection.module.css';\nimport { Area } from '../../../store/types';\nimport { connect } from 'react-redux';\nimport { AppDispatch } from '../../../store/store';\nimport { useDragAndDrop } from '../useDragAndDrop';\nimport { areaSelection, resetAreaSelection, setPositionAreaSelection } from '../../../store/actionCreators/canvasActionCreators';\nimport { ForwardedRef, forwardRef, RefObject } from 'react';\n\ntype AreaSelectionProps = {\n  area: Area,\n  areaSelection: (x: number, y: number, width: number, height: number) => void,\n  resetAreaSelection: () => void,\n  setPositionAreaSelection: (x: number, y: number) => void,\n}\n\n  const AreaSelection = forwardRef((props: AreaSelectionProps, ref: ForwardedRef<HTMLDivElement>) => {\n\n  let areaSelectionStyle = {};\n\n\n  areaSelectionStyle = {\n    left: props.area.x,\n    top: props.area.y,\n    width: props.area.width - 2,\n    height: props.area.height - 2,\n  }\n  useDragAndDrop(ref as RefObject<HTMLElement>, { x: props.area.x, y: props.area.y }, props.setPositionAreaSelection);\n\n  return (\n    <div className={styles.areaSelection} style={areaSelectionStyle} ref={ref}></div>\n  );\n});\n\nconst mapDispatchToProps = (dispatch: AppDispatch) => {\n  return {\n    areaSelection: (x: number, y: number, width: number, height: number) => dispatch(areaSelection(x, y, width, height)),\n    resetAreaSelection: () => dispatch(resetAreaSelection()),\n    setPositionAreaSelection: (x: number, y: number) => dispatch(setPositionAreaSelection(x, y)),\n  }\n}\n\nexport default connect(null, mapDispatchToProps, null, { forwardRef: true })(AreaSelection);\n\n\n\n","import styles from './Canvas.module.css';\r\nimport { ReactElement, useRef } from 'react';\r\nimport Img from './img/Img'\r\nimport Text from './text/Text'\r\nimport ArtObj from './artObj/ArtObj'\r\nimport Filter from './filter/Filter'\r\nimport DeleteArea from './deleteArea/DeleteArea'\r\nimport { Area, Block as BlockType, Canvas as CanvasType, Size } from '../../store/types';\r\nimport { connect } from 'react-redux';\r\nimport { AppDispatch, RootState } from '../../store/store';\r\nimport { BlockTypes } from '../../store/types';\r\nimport AreaSelection from './areaSelection/AreaSelection';\r\nimport { areaSelection, resetAreaSelection } from '../../store/actionCreators/canvasActionCreators';\r\nimport { useAreaSelection } from './useAreaSelection';\r\n\r\ntype CanvasProps = {\r\n  canvas: CanvasType,\r\n  area: Area | null,\r\n  bgColor: string | null,\r\n  canvasSize: Size | null,\r\n  areaSelection: (x: number, y: number, width: number, height: number) => void,\r\n  resetAreaSelection: () => void,\r\n}\r\n\r\nfunction Canvas(props: CanvasProps) {\r\n  const canvasStyle = getStyle(props.canvas, props.bgColor, props.canvasSize);\r\n  const listBlock: ReactElement[] = getListBlock(props.canvas.listBlock);\r\n\r\n  const canvas = useRef<HTMLDivElement>(null);\r\n  const area = useRef<HTMLDivElement>(null);\r\n  useAreaSelection(canvas, area, props.areaSelection, props.resetAreaSelection);\r\n\r\n  return (\r\n    <div id=\"canvas\" className={styles.canvas} style={canvasStyle} ref={canvas}>\r\n      {props.area &&\r\n        <AreaSelection area={props.area} ref={area}/>\r\n      }\r\n      {props.canvas.deleteArea &&\r\n        <DeleteArea />\r\n      }\r\n      <Filter />\r\n      {listBlock}\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction mapStateToProps(state: RootState) {\r\n  return {\r\n    canvas: state.canvas,\r\n    area: state.viewModel.areaSelection,\r\n    bgColor: state.viewModel.bgColor,\r\n    canvasSize: state.viewModel.canvasSize,\r\n  }\r\n};\r\n\r\nconst mapDispatchToProps = (dispatch: AppDispatch) => {\r\n  return {\r\n    areaSelection: (x: number, y: number, width: number, height: number) => dispatch(areaSelection(x, y, width, height)),\r\n    resetAreaSelection: () => dispatch(resetAreaSelection()),\r\n  }\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(Canvas);\r\n\r\n\r\nfunction getListBlock(listBlock: BlockType[]): ReactElement[] {\r\n  let newListBlock: ReactElement[] = [];\r\n  listBlock.forEach((block: BlockType) => {\r\n    switch (block.type) {\r\n      case BlockTypes.text:\r\n        newListBlock.push(<Text text={block}\r\n          key={block.id} />);\r\n        break;\r\n      case BlockTypes.img:\r\n        newListBlock.push(<Img img={block}\r\n          key={block.id} />);\r\n        break;\r\n      case BlockTypes.artObj:\r\n        newListBlock.push(<ArtObj artObj={block}\r\n          key={block.id} />);\r\n        break;\r\n    }\r\n  });\r\n  return newListBlock;\r\n}\r\n\r\nfunction getStyle(canvas: CanvasType, bgColor: string | null, canvasSize: Size | null) {\r\n  let background: string = '#fff';\r\n\r\n  if (bgColor) {\r\n    background = bgColor;\r\n  } else {\r\n    if (canvas.background.color) {\r\n      background = canvas.background.color;\r\n    } else if (canvas.background.src) {\r\n      background = 'url(' + canvas.background.src + ')';\r\n    }\r\n  }\r\n\r\n  let width: number = 0;\r\n  let height: number = 0;\r\n  if (canvasSize) {\r\n    width = canvasSize.width;\r\n    height = canvasSize.height;\r\n  } else {\r\n    width = canvas.width;\r\n    height = canvas.height;\r\n  }\r\n\r\n  return {\r\n    width: width,\r\n    height: height,\r\n    background: background,\r\n  };\r\n}","import { useEffect, RefObject } from 'react';\nimport { Position } from '../../store/types';\nimport { verify } from '../../utils/permisions';\n\nexport function useAreaSelection(\n  canvas: RefObject<HTMLDivElement>,\n  area: RefObject<HTMLDivElement>,\n  areaSelection: (x: number, y: number, width: number, height: number) => void,\n  resetAreaSelection: () => void): void {\n\n  useEffect(() => {\n\n    const field = canvas.current;\n    const selectArea = area.current;\n\n    let startPos: Position;\n    let startOffsetPos: Position;\n\n    const div: HTMLDivElement = document.createElement(\"div\");\n    div.style.position = 'absolute';\n    div.style.zIndex = '1';\n    div.style.pointerEvents = 'none';\n\n    function handleMousedown(event: MouseEvent): void {\n      \n      if (!event.defaultPrevented && event.target === field) {\n        startPos = {\n          x: event.pageX,\n          y: event.pageY,\n        };\n\n        startOffsetPos = {\n          x: event.offsetX,\n          y: event.offsetY,\n        };\n\n        document.addEventListener(\"mousemove\", handleMouseMove);\n        document.addEventListener(\"mouseup\", handleMouseUp);\n\n        div.style.border = '1px dashed red';\n        div.style.width = '0px';\n        div.style.height = '0px';\n\n        div.style.left = event.offsetX + 'px';\n        div.style.top = event.offsetY + 'px';\n        if (field) field.appendChild(div);\n      }\n    }\n\n\n    function handleMouseMove(event: MouseEvent): void {\n\n      if (!event.defaultPrevented) {\n\n        const delta = {\n          x: Math.abs(event.pageX - startPos.x),\n          y: Math.abs(event.pageY - startPos.y)\n        }\n\n        let moving: Position = { x: 0, y: 0 };\n\n        if (startPos.x >= event.pageX && startPos.y >= event.pageY) { // левый верхний\n          moving = { x: -delta.x, y: -delta.y };\n        } else if (startPos.x <= event.pageX && startPos.y >= event.pageY) { // правый верхний\n          moving = { x: 0, y: -delta.y };\n        } else if (startPos.x >= event.pageX && startPos.y <= event.pageY) { // левый нижний\n          moving = { x: -delta.x, y: 0 };\n        }\n\n        div.style.width = delta.x + 'px';\n        div.style.height = delta.y + 'px';\n\n        div.style.left = startOffsetPos.x + moving.x + 'px';\n        div.style.top = startOffsetPos.y + moving.y + 'px';\n      }\n    }\n\n    function handleMouseUp(): void {\n\n      if (div.offsetWidth > 2 && div.offsetHeight > 2) {\n        areaSelection(div.offsetLeft, div.offsetTop, div.offsetWidth, div.offsetHeight);\n      }\n      div.remove();\n\n      document.removeEventListener(\"mousemove\", handleMouseMove);\n      document.removeEventListener(\"mouseup\", handleMouseUp);\n\n    }\n\n    function handleMousedownDocument(event: Event): void {\n      if (!event.defaultPrevented && area.current) {\n        event.preventDefault();\n        if (area.current !== event.target) {\n          resetAreaSelection();\n        }\n      }\n    }\n\n    function handleMousedownArea(event: MouseEvent) {\n      event.preventDefault();\n    }\n\n    \n    verify(field).addEventListener(\"mousedown\", handleMousedown);\n    if (selectArea) selectArea.addEventListener(\"mousedown\", handleMousedownArea);\n    document.addEventListener(\"mousedown\", handleMousedownDocument);\n    return () => {\n      if (field) field.removeEventListener(\"mousedown\", handleMousedown);\n      if (selectArea) selectArea.removeEventListener(\"mousedown\", handleMousedownArea);\n      document.removeEventListener(\"mousedown\", handleMousedownDocument);\n    };\n  }, [canvas, area, areaSelection, resetAreaSelection]);\n}","import styles from './CardMaker.module.css';\r\nimport Header from './header/Header';\r\nimport Canvas from './canvas/Canvas';\r\nimport { connect } from 'react-redux';\r\n\r\nfunction CardMaker() {\r\n  return (\r\n    <>\r\n      <Header />\r\n      <main className={styles.main}>\r\n        <Canvas />\r\n      </main>\r\n    </>\r\n  );\r\n}\r\n\r\nexport default connect()(CardMaker);\r\n","import './index.css';\r\nimport React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport CardMaker from './cardMaker/CardMaker';\r\nimport { store } from './store/store';\r\nimport { Provider } from 'react-redux';\r\n\r\nstore.subscribe(() => {\r\n  // console.log(store.getState());\r\n});\r\n\r\nReactDOM.render(\r\n\r\n  <React.StrictMode>\r\n    <Provider store={store}>\r\n      <CardMaker />\r\n    </Provider>\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n"],"sourceRoot":""}